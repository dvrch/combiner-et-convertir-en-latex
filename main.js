/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

"use strict";var K=Object.defineProperty;var At=Object.getOwnPropertyDescriptor;var Ot=Object.getOwnPropertyNames;var Lt=Object.prototype.hasOwnProperty;var Nt=(t,e)=>{for(var n in e)K(t,n,{get:e[n],enumerable:!0})},Pt=(t,e,n,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of Ot(e))!Lt.call(t,r)&&r!==n&&K(t,r,{get:()=>e[r],enumerable:!(o=At(e,r))||o.enumerable});return t};var Dt=t=>Pt(K({},"__esModule",{value:!0}),t);var se={};Nt(se,{default:()=>X});module.exports=Dt(se);var Ct=require("obsidian");function T(){}function Y(t){return t()}function V(){return Object.create(null)}function M(t){t.forEach(Y)}function W(t){return typeof t=="function"}function N(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}function lt(t){return Object.keys(t).length===0}var Q=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;var H=class t{_listeners="WeakMap"in Q?new WeakMap:void 0;_observer=void 0;options;constructor(e){this.options=e}observe(e,n){return this._listeners.set(e,n),this._getObserver().observe(e,this.options),()=>{this._listeners.delete(e),this._observer.unobserve(e)}}_getObserver(){return this._observer??(this._observer=new ResizeObserver(e=>{for(let n of e)t.entries.set(n.target,n),this._listeners.get(n.target)?.(n)}))}};H.entries="WeakMap"in Q?new WeakMap:void 0;var at=!1;function ut(){at=!0}function ft(){at=!1}function Z(t,e,n){t.insertBefore(e,n||null)}function z(t){t.parentNode&&t.parentNode.removeChild(t)}function pt(t){return document.createElement(t)}function tt(t,e,n){n==null?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function dt(t){return Array.from(t.childNodes)}function ht(t){let e={};return t.childNodes.forEach(n=>{e[n.slot||"default"]=!0}),e}var R;function A(t){R=t}var j=[];var _t=[],q=[],gt=[],Gt=Promise.resolve(),nt=!1;function xt(){nt||(nt=!0,Gt.then(U))}function G(t){q.push(t)}var et=new Set,B=0;function U(){if(B!==0)return;let t=R;do{try{for(;B<j.length;){let e=j[B];B++,A(e),Vt(e.$$)}}catch(e){throw j.length=0,B=0,e}for(A(null),j.length=0,B=0;_t.length;)_t.pop()();for(let e=0;e<q.length;e+=1){let n=q[e];et.has(n)||(et.add(n),n())}q.length=0}while(j.length);for(;gt.length;)gt.pop()();nt=!1,et.clear(),A(t)}function Vt(t){if(t.fragment!==null){t.update(),M(t.before_update);let e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(G)}}function $t(t){let e=[],n=[];q.forEach(o=>t.indexOf(o)===-1?e.push(o):n.push(o)),n.forEach(o=>o()),q=e}var Wt=new Set;function J(t,e){t&&t.i&&(Wt.delete(t),t.i(e))}var Ut=["allowfullscreen","allowpaymentrequest","async","autofocus","autoplay","checked","controls","default","defer","disabled","formnovalidate","hidden","inert","ismap","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","selected"],Jt=new Set([...Ut]);function Yt(t,e,n){let{fragment:o,after_update:r}=t.$$;o&&o.m(e,n),G(()=>{let i=t.$$.on_mount.map(Y).filter(W);t.$$.on_destroy?t.$$.on_destroy.push(...i):M(i),t.$$.on_mount=[]}),r.forEach(G)}function Qt(t,e){let n=t.$$;n.fragment!==null&&($t(n.after_update),M(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function Zt(t,e){t.$$.dirty[0]===-1&&(j.push(t),xt(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function P(t,e,n,o,r,i,m=null,_=[-1]){let h=R;A(t);let a=t.$$={fragment:null,ctx:[],props:i,update:T,not_equal:r,bound:V(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(h?h.$$.context:[])),callbacks:V(),dirty:_,skip_bound:!1,root:e.target||h.$$.root};m&&m(a.root);let k=!1;if(a.ctx=n?n(t,e.props||{},(b,y,...$)=>{let g=$.length?$[0]:y;return a.ctx&&r(a.ctx[b],a.ctx[b]=g)&&(!a.skip_bound&&a.bound[b]&&a.bound[b](g),k&&Zt(t,b)),y}):[],a.update(),k=!0,M(a.before_update),a.fragment=o?o(a.ctx):!1,e.target){if(e.hydrate){ut();let b=dt(e.target);a.fragment&&a.fragment.l(b),b.forEach(z)}else a.fragment&&a.fragment.c();e.intro&&J(t.$$.fragment),Yt(t,e.target,e.anchor),ft(),U()}A(h)}var te;typeof HTMLElement=="function"&&(te=class extends HTMLElement{$$ctor;$$s;$$c;$$cn=!1;$$d={};$$r=!1;$$p_d={};$$l={};$$l_u=new Map;constructor(t,e,n){super(),this.$$ctor=t,this.$$s=e,n&&this.attachShadow({mode:"open"})}addEventListener(t,e,n){if(this.$$l[t]=this.$$l[t]||[],this.$$l[t].push(e),this.$$c){let o=this.$$c.$on(t,e);this.$$l_u.set(e,o)}super.addEventListener(t,e,n)}removeEventListener(t,e,n){if(super.removeEventListener(t,e,n),this.$$c){let o=this.$$l_u.get(e);o&&(o(),this.$$l_u.delete(e))}if(this.$$l[t]){let o=this.$$l[t].indexOf(e);o>=0&&this.$$l[t].splice(o,1)}}async connectedCallback(){if(this.$$cn=!0,!this.$$c){let t=function(r){return()=>{let i;return{c:function(){i=pt("slot"),r!=="default"&&tt(i,"name",r)},m:function(h,a){Z(h,i,a)},d:function(h){h&&z(i)}}}};if(await Promise.resolve(),!this.$$cn||this.$$c)return;let e={},n=ht(this);for(let r of this.$$s)r in n&&(e[r]=[t(r)]);for(let r of this.attributes){let i=this.$$g_p(r.name);i in this.$$d||(this.$$d[i]=rt(i,r.value,this.$$p_d,"toProp"))}for(let r in this.$$p_d)!(r in this.$$d)&&this[r]!==void 0&&(this.$$d[r]=this[r],delete this[r]);this.$$c=new this.$$ctor({target:this.shadowRoot||this,props:{...this.$$d,$$slots:e,$$scope:{ctx:[]}}});let o=()=>{this.$$r=!0;for(let r in this.$$p_d)if(this.$$d[r]=this.$$c.$$.ctx[this.$$c.$$.props[r]],this.$$p_d[r].reflect){let i=rt(r,this.$$d[r],this.$$p_d,"toAttribute");i==null?this.removeAttribute(this.$$p_d[r].attribute||r):this.setAttribute(this.$$p_d[r].attribute||r,i)}this.$$r=!1};this.$$c.$$.after_update.push(o),o();for(let r in this.$$l)for(let i of this.$$l[r]){let m=this.$$c.$on(r,i);this.$$l_u.set(i,m)}this.$$l={}}}attributeChangedCallback(t,e,n){this.$$r||(t=this.$$g_p(t),this.$$d[t]=rt(t,n,this.$$p_d,"toProp"),this.$$c?.$set({[t]:this.$$d[t]}))}disconnectedCallback(){this.$$cn=!1,Promise.resolve().then(()=>{!this.$$cn&&this.$$c&&(this.$$c.$destroy(),this.$$c=void 0)})}$$g_p(t){return Object.keys(this.$$p_d).find(e=>this.$$p_d[e].attribute===t||!this.$$p_d[e].attribute&&e.toLowerCase()===t)||t}});function rt(t,e,n,o){let r=n[t]?.type;if(e=r==="Boolean"&&typeof e!="boolean"?e!=null:e,!o||!n[t])return e;if(o==="toAttribute")switch(r){case"Object":case"Array":return e==null?null:JSON.stringify(e);case"Boolean":return e?"":null;case"Number":return e??null;default:return e}else switch(r){case"Object":case"Array":return e&&JSON.parse(e);case"Boolean":return e;case"Number":return e!=null?+e:e;default:return e}}var E=class{$$=void 0;$$set=void 0;$destroy(){Qt(this,1),this.$destroy=T}$on(e,n){if(!W(n))return T;let o=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return o.push(n),()=>{let r=o.indexOf(n);r!==-1&&o.splice(r,1)}}$set(e){this.$$set&&!lt(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}};var bt="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(bt);var ur=require("obsidian");var Qn=require("obsidian");function ee(t){return t=t.replace(/^(#+)([^\n]*)/gm,(e,n,o)=>`${n}${o}-comb`),t=t.replace(/\^(\w+)$/gm,(e,n)=>`^${n}-comb`),t}function ne(t,e,n){let{app:o}=e,{basePath:r}=e,{config:i=null}=e,{combinedFileName:m=""}=e,_=new Set,h="",a=new Set,k={};function b(l,x){let s=[],d=[],F=x.split(`
`);for(let p of F){let O=p.match(/^(#+)\s*(.*)$/);if(O){let L=O[2].trim().replace(/\s+/g,"-").toLowerCase()+"-comb";s.push(L)}let C=p.match(/\^(\w+)-comb$/);C&&d.push(C[1]+"-comb")}k[l.toLowerCase()]={file:l,sections:s,blocks:d}}async function y(l){let x=/!\[\[([^\]#|^]+)(?:(#)([^\]|]+))?(?:(\^)([^\]|]+))?(?:\|([^\]]+))?\]\]/g,s=l,d;for(;(d=x.exec(l))!==null;){let F=d[0],p=d[1].trim(),O=d[2],C=d[3],L=d[4],I=d[5];if(/\.(png|jpg|jpeg|gif|svg|bmp|webp)$/i.test(p)){let v=`%% EMBED IMAGE: ${p} %%
`;s=s.replace(F,v+F);continue}if(!_.has(p)){_.add(p),a.add(p.toLowerCase());try{let v=o.metadataCache.getFirstLinkpathDest(p,"");if(v){let S=await o.vault.read(v);(!S||S.trim()==="")&&(S=`<!-- Contenu vide ou non trouv\xE9 pour '${p}' -->`);let w=ee(S);b(p,w),w=await c(w,v.parent?.path||"");let D=`^${p}-comb
`,St=`%% EMBED START: ${p} %%
`,Mt=`
%% EMBED END: ${p} %%`;s=s.replace(F,D+St+w+Mt)}else s=s.replace(F,`![[${p}]]`)}catch{s=s.replace(F,`![[${p}]]`)}finally{_.delete(p)}}}return s}async function $(l){let x=/\[\[([^\]#|^]+)(?:(#)([^\]|]+))?(?:(\^)([^\]|]+))?(?:\|([^\]]+))?\]\]/g,s=l,d;for(;(d=x.exec(l))!==null;){let F=d[0],p=d[1].trim(),O=d[2],C=d[3],L=d[4],I=d[5],v=d[6];if(/\.(png|jpg|jpeg|gif|svg|bmp|webp)$/i.test(p))continue;let S=k[p.toLowerCase()];if(S){if(!O&&!L){let w=`^${p}-comb`,D=v||p;s=s.replace(F,`[[${m}#${w}|${D}]]`);continue}if(O&&C){let w=C.replace(/\s+/g,"-").toLowerCase()+"-comb";if(S.sections.includes(w)){let D=v||C;s=s.replace(F,`[[${m}#${w}|${D}]]`);continue}}if(L&&I){let w="^"+I+"-comb";if(S.blocks.includes(I+"-comb")){let D=v||I;s=s.replace(F,`[[${m}#${w}|${D}]]`);continue}}}}return s}async function g(l){let x=/!\[\[([^\]#|^]+)(?:(#)([^\]|]+))?(?:\|([^\]]+))?\]\]/g,s=l,d;for(;(d=x.exec(l))!==null;){let F=d[0],p=d[1].trim(),O=d[2],C=d[3],L=d[4];/\.(png|jpg|jpeg|gif|svg|bmp|webp)$/i.test(p)&&(p=p.replace(/\.md$/i,""));try{let v=o.metadataCache.getFirstLinkpathDest(p,"");if(v){let w=`![[${v.path.replace(/\\/g,"/")}`;O&&C&&(w+=`#${C}`),L&&(w+=`|${L}`),w+="]]",s=s.replace(F,w)}else s=s.replace(F,`![[${p}]]`)}catch{s=s.replace(F,`![[${p}]]`)}}return s}async function c(l,x){let s=l;return s=await y(s),s=await $(s),s=await g(s),s=s,s}async function u(l){h="Traitement des liens...",_.clear();try{let x=await c(l,r);return h="Traitement termin\xE9",x}catch(x){throw h="Erreur lors du traitement",x}}function f(){_.clear(),h=""}return t.$$set=l=>{"app"in l&&n(0,o=l.app),"basePath"in l&&n(1,r=l.basePath),"config"in l&&n(2,i=l.config),"combinedFileName"in l&&n(3,m=l.combinedFileName)},[o,r,i,m,u,f]}var ot=class extends E{constructor(e){super(),P(this,e,ne,null,N,{app:0,basePath:1,config:2,combinedFileName:3,processMarkdown:4,resetState:5})}get processMarkdown(){return this.$$.ctx[4]}get resetState(){return this.$$.ctx[5]}},yt=ot;var wt=require("obsidian");function re(t,e,n){let{app:o}=e,{config:r=null}=e,i="";async function m(c,u){let f=1,l=r?.combinedFilePrefix||"",x=r?.combinedFileSuffix||"-combined",s=`${l}${c}${x}.md`;for(;await o.vault.adapter.exists(`${u}/${s}`);)s=`${l}${c}${x}-${f}.md`,f++;return s}function _(){let c=o.workspace.getActiveFile();return!c||c.extension!=="md"||!c.parent?(o.workspace.trigger("notice","Aucun fichier Markdown valide s\xE9lectionn\xE9."),null):c}async function h(c){let u=c.parent?.path||"",f=c.basename,l=await m(f,u),x=`${u}/${l}`;return{originalFile:c,newFileName:l,parentPath:u,fullPath:x}}async function a(c,u){i="Cr\xE9ation du fichier...";try{await o.vault.create(c.fullPath,u),i="Fichier cr\xE9\xE9 avec succ\xE8s";let f=o.vault.getAbstractFileByPath(c.fullPath);if(f&&f instanceof wt.TFile)return f;throw new Error("Impossible de r\xE9cup\xE9rer le fichier cr\xE9\xE9")}catch(f){throw i="Erreur lors de la cr\xE9ation du fichier",f}}async function k(c){if(!(r&&r.openFileAfterCreation===!1))try{await o.workspace.getLeaf("split","vertical").openFile(c),o.workspace.trigger("notice",`Fichier combin\xE9 ouvert : ${c.name}`)}catch(u){o.workspace.trigger("notice",`Erreur lors de l'ouverture du fichier : ${u}`)}}async function b(c){i="Lecture du fichier original...";try{let u=await o.vault.read(c);return i="Fichier lu avec succ\xE8s",u}catch(u){throw i="Erreur lors de la lecture du fichier",u}}async function y(){i="D\xE9but du processus...";let c=_();if(!c)return null;try{let u=await b(c),f=await h(c);return{originalContent:u,fileInfo:f,activeFile:c}}catch(u){let f=u instanceof Error?u.message:String(u);throw o.workspace.trigger("notice",`Erreur : ${f}`),i="Erreur : "+f,u}}async function $(c,u){try{let f=await a(c,u);return await k(f),f}catch(f){let l=f instanceof Error?f.message:String(f);throw o.workspace.trigger("notice",`Erreur lors de la cr\xE9ation du fichier combin\xE9 : ${l}`),f}}function g(){i=""}return t.$$set=c=>{"app"in c&&n(0,o=c.app),"config"in c&&n(1,r=c.config)},[o,r,y,$,g]}var it=class extends E{constructor(e){super(),P(this,e,re,null,N,{app:0,config:1,handleFileCombination:2,finalizeFileCreation:3,resetFileStatus:4})}get handleFileCombination(){return this.$$.ctx[2]}get finalizeFileCreation(){return this.$$.ctx[3]}get resetFileStatus(){return this.$$.ctx[4]}},Ft=it;function vt(t){let e=[];return(t.maxRecursionDepth<1||t.maxRecursionDepth>50)&&e.push("La profondeur de r\xE9cursion doit \xEAtre entre 1 et 50"),t.combinedFileSuffix.length>50&&e.push("Le suffixe du fichier ne peut pas d\xE9passer 50 caract\xE8res"),{isValid:e.length===0,errors:e}}function oe(t,e,n){let o={processEmbeddedLinks:!0,processInternalLinks:!0,processImages:!0,processExternalLinks:!1,combinedFilePrefix:"",combinedFileSuffix:"-combined",showNotifications:!0,openFileAfterCreation:!0,maxRecursionDepth:10,preserveOriginalLinks:!0},r={...o},i="";async function m(y){i="Chargement de la configuration...";try{let $=await y.loadData();return $?r={...o,...$}:r={...o},i="Configuration charg\xE9e",r}catch($){return i="Erreur lors du chargement de la configuration",console.error("Erreur de chargement de configuration:",$),o}}async function _(y,$){i="Sauvegarde de la configuration...";try{await y.saveData($),r={...$},i="Configuration sauvegard\xE9e"}catch(g){throw i="Erreur lors de la sauvegarde de la configuration",console.error("Erreur de sauvegarde de configuration:",g),g}}async function h(y,$){let g={...r,...$};await _(y,g)}async function a(y){await _(y,o)}function k(){return{...r}}function b(){i=""}return[m,_,h,a,k,vt,b]}var st=class extends E{constructor(e){super(),P(this,e,oe,null,N,{loadConfig:0,saveConfig:1,updateConfig:2,resetConfig:3,getCurrentConfig:4,validateConfig:5,resetConfigStatus:6})}get loadConfig(){return this.$$.ctx[0]}get saveConfig(){return this.$$.ctx[1]}get updateConfig(){return this.$$.ctx[2]}get resetConfig(){return this.$$.ctx[3]}get getCurrentConfig(){return this.$$.ctx[4]}get validateConfig(){return vt}get resetConfigStatus(){return this.$$.ctx[6]}},kt=st;function ie(t,e,n){let{plugin:o}=e,r,i,m,_=!1,h="Pr\xEAt",a=null;async function k(){m=new kt({target:document.createElement("div"),props:{}}),a=await m.loadConfig(o)}async function b(){if(_)return;let{app:g}=o;_=!0,h="Initialisation...";try{await k(),r=new yt({target:document.createElement("div"),props:{app:g,basePath:"",config:a}}),i=new Ft({target:document.createElement("div"),props:{app:g,config:a}});let c=await i.handleFileCombination();if(!c){h="Aucun fichier valide s\xE9lectionn\xE9";return}let{originalContent:u,fileInfo:f,activeFile:l}=c;r.$set({basePath:f.parentPath}),h="Traitement du contenu...";let x=await r.processMarkdown(u);h="Cr\xE9ation du fichier final...",await i.finalizeFileCreation(f,x),h="Termin\xE9 avec succ\xE8s !",a.showNotifications&&g.workspace.trigger("notice",`Fichier combin\xE9 cr\xE9\xE9 : ${f.newFileName}`)}catch(c){let u=c instanceof Error?c.message:String(c);a?.showNotifications&&g.workspace.trigger("notice",`Erreur lors de la combinaison : ${u}`),h="Erreur : "+u}finally{_=!1,r&&r.$destroy(),i&&i.$destroy(),m&&m.$destroy()}}function y(){_=!1,h="Pr\xEAt",r&&r.resetState(),i&&i.resetFileStatus(),m&&m.resetConfigStatus()}function $(){return a}return t.$$set=g=>{"plugin"in g&&n(0,o=g.plugin)},[o,b,y,$]}var ct=class extends E{constructor(e){super(),P(this,e,ie,null,N,{plugin:0,combineFiles:1,resetState:2,getConfig:3})}get combineFiles(){return this.$$.ctx[1]}get resetState(){return this.$$.ctx[2]}get getConfig(){return this.$$.ctx[3]}},Et=ct;var X=class extends Ct.Plugin{appView=null;async onload(){this.addCommand({id:"combine-markdown-files",name:"Combiner les fichiers Markdown avec les embeds",callback:()=>this.combineMarkdownFiles()}),this.addRibbonIcon("link","Combiner les fichiers Markdown",()=>{this.combineMarkdownFiles()}),this.appView=new Et({target:document.createElement("div"),props:{plugin:this}})}async combineMarkdownFiles(){this.appView&&await this.appView.combineFiles()}onunload(){this.appView?.$destroy(),this.appView=null}};

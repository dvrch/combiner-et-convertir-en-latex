/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

"use strict";var H=Object.defineProperty;var Et=Object.getOwnPropertyDescriptor;var Ct=Object.getOwnPropertyNames;var St=Object.prototype.hasOwnProperty;var Mt=(t,e)=>{for(var r in e)H(t,r,{get:e[r],enumerable:!0})},Ot=(t,e,r,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of Ct(e))!St.call(t,n)&&n!==r&&H(t,n,{get:()=>e[n],enumerable:!(o=Et(e,n))||o.enumerable});return t};var At=t=>Ot(H({},"__esModule",{value:!0}),t);var ne={};Mt(ne,{default:()=>W});module.exports=At(ne);var vt=require("obsidian");function O(){}function U(t){return t()}function B(){return Object.create(null)}function k(t){t.forEach(U)}function q(t){return typeof t=="function"}function C(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}function ot(t){return Object.keys(t).length===0}var J=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;var z=class t{_listeners="WeakMap"in J?new WeakMap:void 0;_observer=void 0;options;constructor(e){this.options=e}observe(e,r){return this._listeners.set(e,r),this._getObserver().observe(e,this.options),()=>{this._listeners.delete(e),this._observer.unobserve(e)}}_getObserver(){return this._observer??(this._observer=new ResizeObserver(e=>{for(let r of e)t.entries.set(r.target,r),this._listeners.get(r.target)?.(r)}))}};z.entries="WeakMap"in J?new WeakMap:void 0;var it=!1;function st(){it=!0}function ct(){it=!1}function X(t,e,r){t.insertBefore(e,r||null)}function j(t){t.parentNode&&t.parentNode.removeChild(t)}function lt(t){return document.createElement(t)}function K(t,e,r){r==null?t.removeAttribute(e):t.getAttribute(e)!==r&&t.setAttribute(e,r)}function at(t){return Array.from(t.childNodes)}function ut(t){let e={};return t.childNodes.forEach(r=>{e[r.slot||"default"]=!0}),e}var P;function E(t){P=t}var A=[];var pt=[],L=[],dt=[],Rt=Promise.resolve(),Q=!1;function ht(){Q||(Q=!0,Rt.then(G))}function I(t){L.push(t)}var Y=new Set,D=0;function G(){if(D!==0)return;let t=P;do{try{for(;D<A.length;){let e=A[D];D++,E(e),Bt(e.$$)}}catch(e){throw A.length=0,D=0,e}for(E(null),A.length=0,D=0;pt.length;)pt.pop()();for(let e=0;e<L.length;e+=1){let r=L[e];Y.has(r)||(Y.add(r),r())}L.length=0}while(A.length);for(;dt.length;)dt.pop()();Q=!1,Y.clear(),E(t)}function Bt(t){if(t.fragment!==null){t.update(),k(t.before_update);let e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(I)}}function _t(t){let e=[],r=[];L.forEach(o=>t.indexOf(o)===-1?e.push(o):r.push(o)),r.forEach(o=>o()),L=e}var qt=new Set;function V(t,e){t&&t.i&&(qt.delete(t),t.i(e))}var Gt=["allowfullscreen","allowpaymentrequest","async","autofocus","autoplay","checked","controls","default","defer","disabled","formnovalidate","hidden","inert","ismap","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","selected"],Vt=new Set([...Gt]);function Ut(t,e,r){let{fragment:o,after_update:n}=t.$$;o&&o.m(e,r),I(()=>{let c=t.$$.on_mount.map(U).filter(q);t.$$.on_destroy?t.$$.on_destroy.push(...c):k(c),t.$$.on_mount=[]}),n.forEach(I)}function Jt(t,e){let r=t.$$;r.fragment!==null&&(_t(r.after_update),k(r.on_destroy),r.fragment&&r.fragment.d(e),r.on_destroy=r.fragment=null,r.ctx=[])}function Xt(t,e){t.$$.dirty[0]===-1&&(A.push(t),ht(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function S(t,e,r,o,n,c,d=null,h=[-1]){let p=P;E(t);let u=t.$$={fragment:null,ctx:[],props:c,update:O,not_equal:n,bound:B(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(p?p.$$.context:[])),callbacks:B(),dirty:h,skip_bound:!1,root:e.target||p.$$.root};d&&d(u.root);let v=!1;if(u.ctx=r?r(t,e.props||{},($,x,...g)=>{let _=g.length?g[0]:x;return u.ctx&&n(u.ctx[$],u.ctx[$]=_)&&(!u.skip_bound&&u.bound[$]&&u.bound[$](_),v&&Xt(t,$)),x}):[],u.update(),v=!0,k(u.before_update),u.fragment=o?o(u.ctx):!1,e.target){if(e.hydrate){st();let $=at(e.target);u.fragment&&u.fragment.l($),$.forEach(j)}else u.fragment&&u.fragment.c();e.intro&&V(t.$$.fragment),Ut(t,e.target,e.anchor),ct(),G()}E(p)}var Kt;typeof HTMLElement=="function"&&(Kt=class extends HTMLElement{$$ctor;$$s;$$c;$$cn=!1;$$d={};$$r=!1;$$p_d={};$$l={};$$l_u=new Map;constructor(t,e,r){super(),this.$$ctor=t,this.$$s=e,r&&this.attachShadow({mode:"open"})}addEventListener(t,e,r){if(this.$$l[t]=this.$$l[t]||[],this.$$l[t].push(e),this.$$c){let o=this.$$c.$on(t,e);this.$$l_u.set(e,o)}super.addEventListener(t,e,r)}removeEventListener(t,e,r){if(super.removeEventListener(t,e,r),this.$$c){let o=this.$$l_u.get(e);o&&(o(),this.$$l_u.delete(e))}if(this.$$l[t]){let o=this.$$l[t].indexOf(e);o>=0&&this.$$l[t].splice(o,1)}}async connectedCallback(){if(this.$$cn=!0,!this.$$c){let t=function(n){return()=>{let c;return{c:function(){c=lt("slot"),n!=="default"&&K(c,"name",n)},m:function(p,u){X(p,c,u)},d:function(p){p&&j(c)}}}};if(await Promise.resolve(),!this.$$cn||this.$$c)return;let e={},r=ut(this);for(let n of this.$$s)n in r&&(e[n]=[t(n)]);for(let n of this.attributes){let c=this.$$g_p(n.name);c in this.$$d||(this.$$d[c]=Z(c,n.value,this.$$p_d,"toProp"))}for(let n in this.$$p_d)!(n in this.$$d)&&this[n]!==void 0&&(this.$$d[n]=this[n],delete this[n]);this.$$c=new this.$$ctor({target:this.shadowRoot||this,props:{...this.$$d,$$slots:e,$$scope:{ctx:[]}}});let o=()=>{this.$$r=!0;for(let n in this.$$p_d)if(this.$$d[n]=this.$$c.$$.ctx[this.$$c.$$.props[n]],this.$$p_d[n].reflect){let c=Z(n,this.$$d[n],this.$$p_d,"toAttribute");c==null?this.removeAttribute(this.$$p_d[n].attribute||n):this.setAttribute(this.$$p_d[n].attribute||n,c)}this.$$r=!1};this.$$c.$$.after_update.push(o),o();for(let n in this.$$l)for(let c of this.$$l[n]){let d=this.$$c.$on(n,c);this.$$l_u.set(c,d)}this.$$l={}}}attributeChangedCallback(t,e,r){this.$$r||(t=this.$$g_p(t),this.$$d[t]=Z(t,r,this.$$p_d,"toProp"),this.$$c?.$set({[t]:this.$$d[t]}))}disconnectedCallback(){this.$$cn=!1,Promise.resolve().then(()=>{!this.$$cn&&this.$$c&&(this.$$c.$destroy(),this.$$c=void 0)})}$$g_p(t){return Object.keys(this.$$p_d).find(e=>this.$$p_d[e].attribute===t||!this.$$p_d[e].attribute&&e.toLowerCase()===t)||t}});function Z(t,e,r,o){let n=r[t]?.type;if(e=n==="Boolean"&&typeof e!="boolean"?e!=null:e,!o||!r[t])return e;if(o==="toAttribute")switch(n){case"Object":case"Array":return e==null?null:JSON.stringify(e);case"Boolean":return e?"":null;case"Number":return e??null;default:return e}else switch(n){case"Object":case"Array":return e&&JSON.parse(e);case"Boolean":return e;case"Number":return e!=null?+e:e;default:return e}}var w=class{$$=void 0;$$set=void 0;$destroy(){Jt(this,1),this.$destroy=O}$on(e,r){if(!q(r))return O;let o=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return o.push(r),()=>{let n=o.indexOf(r);n!==-1&&o.splice(n,1)}}$set(e){this.$$set&&!ot(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}};var mt="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(mt);var sr=require("obsidian");var Jn=require("obsidian");function Yt(t){return t=t.replace(/^(#+)([^\n]*)/gm,(e,r,o)=>`${r}${o}-comb`),t=t.replace(/\^(\w+)$/gm,(e,r)=>`^${r}-comb`),t}function Qt(t,e,r){let{app:o}=e,{basePath:n}=e,{config:c=null}=e,d=new Set,h="",p=new Set;async function u(s){let l=/!\[\[([^\]#|^]+)(?:(#)([^\]|]+))?(?:(\^)([^\]|]+))?(?:\|([^\]]+))?\]\]/g,i=s,a;for(;(a=l.exec(s))!==null;){let m=a[0],f=a[1].trim(),R=a[2],M=a[3],T=a[4],N=a[5];if(/\.(png|jpg|jpeg|gif|svg|bmp|webp)$/i.test(f)){let b=`%% EMBED IMAGE: ${f} %%
`;i=i.replace(m,b+m);continue}if(!d.has(f)){d.add(f),p.add(f.toLowerCase());try{let b=o.metadataCache.getFirstLinkpathDest(f,"");if(b){let F=await o.vault.read(b);(!F||F.trim()==="")&&(F=`<!-- Contenu vide ou non trouv\xE9 pour '${f}' -->`);let y=Yt(F);y=await x(y,b.parent?.path||"");let Ft=`%% EMBED START: ${f} %%
`,kt=`
%% EMBED END: ${f} %%`;i=i.replace(m,Ft+y+kt)}else i=i.replace(m,`![[${f}]]`)}catch{i=i.replace(m,`![[${f}]]`)}finally{d.delete(f)}}}return i}async function v(s){let l=/\[\[([^\]#|^]+)(?:(#)([^\]|]+))?(?:(\^)([^\]|]+))?(?:\|([^\]]+))?\]\]/g,i=s,a;for(;(a=l.exec(s))!==null;){let m=a[0],f=a[1].trim(),R=a[2],M=a[3],T=a[4],N=a[5],b=a[6];if(!/\.(png|jpg|jpeg|gif|svg|bmp|webp)$/i.test(f)&&p.has(f.toLowerCase())){if(R&&M){let F=M.replace(/\s+/g,"-").toLowerCase()+"-comb",y=b||M;i=i.replace(m,`[${y}](#${F})`);continue}if(T&&N){let F=N+"-comb",y=b||N;i=i.replace(m,`[${y}](#${F})`);continue}}}return i}async function $(s){let l=/!\[\[([^\]#|^]+)(?:(#)([^\]|]+))?(?:\|([^\]]+))?\]\]/g,i=s,a;for(;(a=l.exec(s))!==null;){let m=a[0],f=a[1].trim(),R=a[2],M=a[3],T=a[4];/\.(png|jpg|jpeg|gif|svg|bmp|webp)$/i.test(f)&&(f=f.replace(/\.md$/i,""));try{let b=o.metadataCache.getFirstLinkpathDest(f,"");if(b){let y=`![[${b.path.replace(/\\/g,"/")}`;R&&M&&(y+=`#${M}`),T&&(y+=`|${T}`),y+="]]",i=i.replace(m,y)}else i=i.replace(m,`![[${f}]]`)}catch{i=i.replace(m,`![[${f}]]`)}}return i}async function x(s,l){let i=s;return i=await u(i),i=await v(i),i=await $(i),i=i,i}async function g(s){h="Traitement des liens...",d.clear();try{let l=await x(s,n);return h="Traitement termin\xE9",l}catch(l){throw h="Erreur lors du traitement",l}}function _(){d.clear(),h=""}return t.$$set=s=>{"app"in s&&r(0,o=s.app),"basePath"in s&&r(1,n=s.basePath),"config"in s&&r(2,c=s.config)},[o,n,c,g,_]}var tt=class extends w{constructor(e){super(),S(this,e,Qt,null,C,{app:0,basePath:1,config:2,processMarkdown:3,resetState:4})}get processMarkdown(){return this.$$.ctx[3]}get resetState(){return this.$$.ctx[4]}},gt=tt;var xt=require("obsidian");function Zt(t,e,r){let{app:o}=e,{config:n=null}=e,c="";async function d(s,l){let i=1,a=n?.combinedFilePrefix||"",m=n?.combinedFileSuffix||"-combined",f=`${a}${s}${m}.md`;for(;await o.vault.adapter.exists(`${l}/${f}`);)f=`${a}${s}${m}-${i}.md`,i++;return f}function h(){let s=o.workspace.getActiveFile();return!s||s.extension!=="md"||!s.parent?(o.workspace.trigger("notice","Aucun fichier Markdown valide s\xE9lectionn\xE9."),null):s}async function p(s){let l=s.parent?.path||"",i=s.basename,a=await d(i,l),m=`${l}/${a}`;return{originalFile:s,newFileName:a,parentPath:l,fullPath:m}}async function u(s,l){c="Cr\xE9ation du fichier...";try{await o.vault.create(s.fullPath,l),c="Fichier cr\xE9\xE9 avec succ\xE8s";let i=o.vault.getAbstractFileByPath(s.fullPath);if(i&&i instanceof xt.TFile)return i;throw new Error("Impossible de r\xE9cup\xE9rer le fichier cr\xE9\xE9")}catch(i){throw c="Erreur lors de la cr\xE9ation du fichier",i}}async function v(s){if(!(n&&n.openFileAfterCreation===!1))try{await o.workspace.getLeaf("split","vertical").openFile(s),o.workspace.trigger("notice",`Fichier combin\xE9 ouvert : ${s.name}`)}catch(l){o.workspace.trigger("notice",`Erreur lors de l'ouverture du fichier : ${l}`)}}async function $(s){c="Lecture du fichier original...";try{let l=await o.vault.read(s);return c="Fichier lu avec succ\xE8s",l}catch(l){throw c="Erreur lors de la lecture du fichier",l}}async function x(){c="D\xE9but du processus...";let s=h();if(!s)return null;try{let l=await $(s),i=await p(s);return{originalContent:l,fileInfo:i,activeFile:s}}catch(l){let i=l instanceof Error?l.message:String(l);throw o.workspace.trigger("notice",`Erreur : ${i}`),c="Erreur : "+i,l}}async function g(s,l){try{let i=await u(s,l);return await v(i),i}catch(i){let a=i instanceof Error?i.message:String(i);throw o.workspace.trigger("notice",`Erreur lors de la cr\xE9ation du fichier combin\xE9 : ${a}`),i}}function _(){c=""}return t.$$set=s=>{"app"in s&&r(0,o=s.app),"config"in s&&r(1,n=s.config)},[o,n,x,g,_]}var et=class extends w{constructor(e){super(),S(this,e,Zt,null,C,{app:0,config:1,handleFileCombination:2,finalizeFileCreation:3,resetFileStatus:4})}get handleFileCombination(){return this.$$.ctx[2]}get finalizeFileCreation(){return this.$$.ctx[3]}get resetFileStatus(){return this.$$.ctx[4]}},$t=et;function bt(t){let e=[];return(t.maxRecursionDepth<1||t.maxRecursionDepth>50)&&e.push("La profondeur de r\xE9cursion doit \xEAtre entre 1 et 50"),t.combinedFileSuffix.length>50&&e.push("Le suffixe du fichier ne peut pas d\xE9passer 50 caract\xE8res"),{isValid:e.length===0,errors:e}}function te(t,e,r){let o={processEmbeddedLinks:!0,processInternalLinks:!0,processImages:!0,processExternalLinks:!1,combinedFilePrefix:"",combinedFileSuffix:"-combined",showNotifications:!0,openFileAfterCreation:!0,maxRecursionDepth:10,preserveOriginalLinks:!0},n={...o},c="";async function d(x){c="Chargement de la configuration...";try{let g=await x.loadData();return g?n={...o,...g}:n={...o},c="Configuration charg\xE9e",n}catch(g){return c="Erreur lors du chargement de la configuration",console.error("Erreur de chargement de configuration:",g),o}}async function h(x,g){c="Sauvegarde de la configuration...";try{await x.saveData(g),n={...g},c="Configuration sauvegard\xE9e"}catch(_){throw c="Erreur lors de la sauvegarde de la configuration",console.error("Erreur de sauvegarde de configuration:",_),_}}async function p(x,g){let _={...n,...g};await h(x,_)}async function u(x){await h(x,o)}function v(){return{...n}}function $(){c=""}return[d,h,p,u,v,bt,$]}var nt=class extends w{constructor(e){super(),S(this,e,te,null,C,{loadConfig:0,saveConfig:1,updateConfig:2,resetConfig:3,getCurrentConfig:4,validateConfig:5,resetConfigStatus:6})}get loadConfig(){return this.$$.ctx[0]}get saveConfig(){return this.$$.ctx[1]}get updateConfig(){return this.$$.ctx[2]}get resetConfig(){return this.$$.ctx[3]}get getCurrentConfig(){return this.$$.ctx[4]}get validateConfig(){return bt}get resetConfigStatus(){return this.$$.ctx[6]}},yt=nt;function ee(t,e,r){let{plugin:o}=e,n,c,d,h=!1,p="Pr\xEAt",u=null;async function v(){d=new yt({target:document.createElement("div"),props:{}}),u=await d.loadConfig(o)}async function $(){if(h)return;let{app:_}=o;h=!0,p="Initialisation...";try{await v(),n=new gt({target:document.createElement("div"),props:{app:_,basePath:"",config:u}}),c=new $t({target:document.createElement("div"),props:{app:_,config:u}});let s=await c.handleFileCombination();if(!s){p="Aucun fichier valide s\xE9lectionn\xE9";return}let{originalContent:l,fileInfo:i,activeFile:a}=s;n.$set({basePath:i.parentPath}),p="Traitement du contenu...";let m=await n.processMarkdown(l);p="Cr\xE9ation du fichier final...",await c.finalizeFileCreation(i,m),p="Termin\xE9 avec succ\xE8s !",u.showNotifications&&_.workspace.trigger("notice",`Fichier combin\xE9 cr\xE9\xE9 : ${i.newFileName}`)}catch(s){let l=s instanceof Error?s.message:String(s);u?.showNotifications&&_.workspace.trigger("notice",`Erreur lors de la combinaison : ${l}`),p="Erreur : "+l}finally{h=!1,n&&n.$destroy(),c&&c.$destroy(),d&&d.$destroy()}}function x(){h=!1,p="Pr\xEAt",n&&n.resetState(),c&&c.resetFileStatus(),d&&d.resetConfigStatus()}function g(){return u}return t.$$set=_=>{"plugin"in _&&r(0,o=_.plugin)},[o,$,x,g]}var rt=class extends w{constructor(e){super(),S(this,e,ee,null,C,{plugin:0,combineFiles:1,resetState:2,getConfig:3})}get combineFiles(){return this.$$.ctx[1]}get resetState(){return this.$$.ctx[2]}get getConfig(){return this.$$.ctx[3]}},wt=rt;var W=class extends vt.Plugin{appView=null;async onload(){this.addCommand({id:"combine-markdown-files",name:"Combiner les fichiers Markdown avec les embeds",callback:()=>this.combineMarkdownFiles()}),this.addRibbonIcon("link","Combiner les fichiers Markdown",()=>{this.combineMarkdownFiles()}),this.appView=new wt({target:document.createElement("div"),props:{plugin:this}})}async combineMarkdownFiles(){this.appView&&await this.appView.combineFiles()}onunload(){this.appView?.$destroy(),this.appView=null}};

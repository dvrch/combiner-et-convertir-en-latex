/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

"use strict";var W=Object.defineProperty;var Ft=Object.getOwnPropertyDescriptor;var kt=Object.getOwnPropertyNames;var Et=Object.prototype.hasOwnProperty;var Ct=(e,t)=>{for(var r in t)W(e,r,{get:t[r],enumerable:!0})},St=(e,t,r,o)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of kt(t))!Et.call(e,n)&&n!==r&&W(e,n,{get:()=>t[n],enumerable:!(o=Ft(t,n))||o.enumerable});return e};var Mt=e=>St(W({},"__esModule",{value:!0}),e);var oe={};Ct(oe,{default:()=>G});module.exports=Mt(oe);var wt=require("obsidian");function A(){}function H(e){return e()}function R(){return Object.create(null)}function k(e){e.forEach(H)}function q(e){return typeof e=="function"}function M(e,t){return e!=e?t==t:e!==t||e&&typeof e=="object"||typeof e=="function"}function rt(e){return Object.keys(e).length===0}var U=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;var B=class e{_listeners="WeakMap"in U?new WeakMap:void 0;_observer=void 0;options;constructor(t){this.options=t}observe(t,r){return this._listeners.set(t,r),this._getObserver().observe(t,this.options),()=>{this._listeners.delete(t),this._observer.unobserve(t)}}_getObserver(){return this._observer??(this._observer=new ResizeObserver(t=>{for(let r of t)e.entries.set(r.target,r),this._listeners.get(r.target)?.(r)}))}};B.entries="WeakMap"in U?new WeakMap:void 0;var ot=!1;function it(){ot=!0}function st(){ot=!1}function J(e,t,r){e.insertBefore(t,r||null)}function I(e){e.parentNode&&e.parentNode.removeChild(e)}function ct(e){return document.createElement(e)}function X(e,t,r){r==null?e.removeAttribute(t):e.getAttribute(t)!==r&&e.setAttribute(t,r)}function lt(e){return Array.from(e.childNodes)}function at(e){let t={};return e.childNodes.forEach(r=>{t[r.slot||"default"]=!0}),t}var N;function E(e){N=e}var P=[];var ft=[],T=[],pt=[],It=Promise.resolve(),Y=!1;function dt(){Y||(Y=!0,It.then(z))}function j(e){T.push(e)}var K=new Set,D=0;function z(){if(D!==0)return;let e=N;do{try{for(;D<P.length;){let t=P[D];D++,E(t),jt(t.$$)}}catch(t){throw P.length=0,D=0,t}for(E(null),P.length=0,D=0;ft.length;)ft.pop()();for(let t=0;t<T.length;t+=1){let r=T[t];K.has(r)||(K.add(r),r())}T.length=0}while(P.length);for(;pt.length;)pt.pop()();Y=!1,K.clear(),E(e)}function jt(e){if(e.fragment!==null){e.update(),k(e.before_update);let t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(j)}}function ht(e){let t=[],r=[];T.forEach(o=>e.indexOf(o)===-1?t.push(o):r.push(o)),r.forEach(o=>o()),T=t}var Rt=new Set;function V(e,t){e&&e.i&&(Rt.delete(e),e.i(t))}var Bt=["allowfullscreen","allowpaymentrequest","async","autofocus","autoplay","checked","controls","default","defer","disabled","formnovalidate","hidden","inert","ismap","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","selected"],zt=new Set([...Bt]);function Wt(e,t,r){let{fragment:o,after_update:n}=e.$$;o&&o.m(t,r),j(()=>{let i=e.$$.on_mount.map(H).filter(q);e.$$.on_destroy?e.$$.on_destroy.push(...i):k(i),e.$$.on_mount=[]}),n.forEach(j)}function Ht(e,t){let r=e.$$;r.fragment!==null&&(ht(r.after_update),k(r.on_destroy),r.fragment&&r.fragment.d(t),r.on_destroy=r.fragment=null,r.ctx=[])}function Ut(e,t){e.$$.dirty[0]===-1&&(P.push(e),dt(),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function O(e,t,r,o,n,i,f=null,d=[-1]){let p=N;E(e);let a=e.$$={fragment:null,ctx:[],props:i,update:A,not_equal:n,bound:R(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(p?p.$$.context:[])),callbacks:R(),dirty:d,skip_bound:!1,root:t.target||p.$$.root};f&&f(a.root);let y=!1;if(a.ctx=r?r(e,t.props||{},(x,$,...g)=>{let u=g.length?g[0]:$;return a.ctx&&n(a.ctx[x],a.ctx[x]=u)&&(!a.skip_bound&&a.bound[x]&&a.bound[x](u),y&&Ut(e,x)),$}):[],a.update(),y=!0,k(a.before_update),a.fragment=o?o(a.ctx):!1,t.target){if(t.hydrate){it();let x=lt(t.target);a.fragment&&a.fragment.l(x),x.forEach(I)}else a.fragment&&a.fragment.c();t.intro&&V(e.$$.fragment),Wt(e,t.target,t.anchor),st(),z()}E(p)}var Jt;typeof HTMLElement=="function"&&(Jt=class extends HTMLElement{$$ctor;$$s;$$c;$$cn=!1;$$d={};$$r=!1;$$p_d={};$$l={};$$l_u=new Map;constructor(e,t,r){super(),this.$$ctor=e,this.$$s=t,r&&this.attachShadow({mode:"open"})}addEventListener(e,t,r){if(this.$$l[e]=this.$$l[e]||[],this.$$l[e].push(t),this.$$c){let o=this.$$c.$on(e,t);this.$$l_u.set(t,o)}super.addEventListener(e,t,r)}removeEventListener(e,t,r){if(super.removeEventListener(e,t,r),this.$$c){let o=this.$$l_u.get(t);o&&(o(),this.$$l_u.delete(t))}if(this.$$l[e]){let o=this.$$l[e].indexOf(t);o>=0&&this.$$l[e].splice(o,1)}}async connectedCallback(){if(this.$$cn=!0,!this.$$c){let e=function(n){return()=>{let i;return{c:function(){i=ct("slot"),n!=="default"&&X(i,"name",n)},m:function(p,a){J(p,i,a)},d:function(p){p&&I(i)}}}};if(await Promise.resolve(),!this.$$cn||this.$$c)return;let t={},r=at(this);for(let n of this.$$s)n in r&&(t[n]=[e(n)]);for(let n of this.attributes){let i=this.$$g_p(n.name);i in this.$$d||(this.$$d[i]=Q(i,n.value,this.$$p_d,"toProp"))}for(let n in this.$$p_d)!(n in this.$$d)&&this[n]!==void 0&&(this.$$d[n]=this[n],delete this[n]);this.$$c=new this.$$ctor({target:this.shadowRoot||this,props:{...this.$$d,$$slots:t,$$scope:{ctx:[]}}});let o=()=>{this.$$r=!0;for(let n in this.$$p_d)if(this.$$d[n]=this.$$c.$$.ctx[this.$$c.$$.props[n]],this.$$p_d[n].reflect){let i=Q(n,this.$$d[n],this.$$p_d,"toAttribute");i==null?this.removeAttribute(this.$$p_d[n].attribute||n):this.setAttribute(this.$$p_d[n].attribute||n,i)}this.$$r=!1};this.$$c.$$.after_update.push(o),o();for(let n in this.$$l)for(let i of this.$$l[n]){let f=this.$$c.$on(n,i);this.$$l_u.set(i,f)}this.$$l={}}}attributeChangedCallback(e,t,r){this.$$r||(e=this.$$g_p(e),this.$$d[e]=Q(e,r,this.$$p_d,"toProp"),this.$$c?.$set({[e]:this.$$d[e]}))}disconnectedCallback(){this.$$cn=!1,Promise.resolve().then(()=>{!this.$$cn&&this.$$c&&(this.$$c.$destroy(),this.$$c=void 0)})}$$g_p(e){return Object.keys(this.$$p_d).find(t=>this.$$p_d[t].attribute===e||!this.$$p_d[t].attribute&&t.toLowerCase()===e)||e}});function Q(e,t,r,o){let n=r[e]?.type;if(t=n==="Boolean"&&typeof t!="boolean"?t!=null:t,!o||!r[e])return t;if(o==="toAttribute")switch(n){case"Object":case"Array":return t==null?null:JSON.stringify(t);case"Boolean":return t?"":null;case"Number":return t??null;default:return t}else switch(n){case"Object":case"Array":return t&&JSON.parse(t);case"Boolean":return t;case"Number":return t!=null?+t:t;default:return t}}var b=class{$$=void 0;$$set=void 0;$destroy(){Ht(this,1),this.$destroy=A}$on(t,r){if(!q(r))return A;let o=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return o.push(r),()=>{let n=o.indexOf(r);n!==-1&&o.splice(n,1)}}$set(t){this.$$set&&!rt(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}};var _t="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(_t);var lr=require("obsidian");var Kn=require("obsidian");function Xt(e,t){if(!e||!t)return t;let r=e.split("/").filter(a=>a),o=t.split("/").filter(a=>a),n=0;for(let a=0;a<Math.min(r.length,o.length)&&r[a]===o[a];a++)n++;let i=r.length-n,f=o.slice(n);if(i===0&&f.length===0)return"./";let d="../".repeat(i),p=f.join("/");return d+p}function Kt(e,t){let r=e.split(`
`),o=t.trim().toLowerCase().replace(/[-_\s]+/g,""),n=!1,i=[],f=0,d=!1;for(let p of r){let a=p.match(/^(#+)\s*(.*)$/);if(a){let y=a[1].length;a[2].trim().toLowerCase().replace(/[-_\s]+/g,"")===o?(n=!0,f=y,i.push(p),d=!0):n&&y<=f&&(n=!1)}n&&i.push(p)}return d&&i.length>0?i.join(`
`):`<!-- Section '${t}' non trouv\xE9e, insertion du contenu complet de la note -->
`+e}function Yt(e,t){let r=e.split(`
`),o=new RegExp(`\\s\\^${t}$`);for(let n=0;n<r.length;n++)if(o.test(r[n]))return r[n].replace(o,"").trim();return""}function Qt(e){let t=e.split(`
`),r=[],o=t.findIndex(i=>i.trim().startsWith("=this.caption"));o!==-1&&r.push(t[o]);let n=t.findIndex(i=>i.trim().startsWith("|"));if(n===-1)return"<!-- Table markdown non trouv\xE9 -->";for(let i=n;i<t.length&&t[i].trim()!=="";i++)r.push(t[i]);return r.join(`
`)}function Zt(e){let t=e.split(`
`),r=[];for(let o=0;o<t.length;o++)t[o].includes("![[")&&(o>0&&t[o-1].trim().startsWith("caption")&&r.push(t[o-1]),r.push(t[o]));return r.length===0?"<!-- Figure/image non trouv\xE9e -->":r.join(`
`)}function te(e,t,r){let{app:o}=t,{basePath:n}=t,{config:i=null}=t,f=new Set,d="";async function p(u){let l=/!\[\[([^\]#|^]+)(?:(#)([^\]|]+))?(?:(\^)([^\]|]+))?(?:\|([^\]]+))?\]\]/g,s=u,c;for(;(c=l.exec(u))!==null;){let h=c[0],_=c[1].trim(),w=c[2],C=c[3],L=c[4],v=c[5];if(!f.has(_)){f.add(_);try{let F=o.metadataCache.getFirstLinkpathDest(_,"");if(F){let m=await o.vault.read(F),S=F.basename;/^table__block_/i.test(S)?m=Qt(m):/^figure__block_/i.test(S)?m=Zt(m):w&&C?m=Kt(m,C):L&&v&&(m=Yt(m,v)),(!m||m.trim()==="")&&(m=`<!-- Contenu vide ou non trouv\xE9 pour '${_}' -->`);let vt=await x(m,F.parent?.path||"");s=s.replace(h,vt)}else s=s.replace(h,`<!-- Linked file not found: ${_} -->`)}catch{s=s.replace(h,`<!-- Error: Could not process ${_} -->`)}finally{f.delete(_)}}}return s}async function a(u){let l=/\[\[([^\]#|^]+)(?:(#)([^\]|]+))?(?:(\^)([^\]|]+))?(?:\|([^\]]+))?\]\]/g,s=u,c;for(;(c=l.exec(u))!==null;){let h=c[0],_=c[1].trim(),w=c[2],C=c[3],L=c[4],v=c[5],F=c[6];try{let m=o.metadataCache.getFirstLinkpathDest(_,"");if(m){let S=`[[${m.basename}`;w&&C?S+=`#${C}`:L&&v&&(S+=`^${v}`),F&&(S+=`|${F}`),S+="]]",s=s.replace(h,S)}else s=s.replace(h,`<!-- Link not found: ${_} -->${h}`)}catch{s=s.replace(h,`<!-- Error processing link: ${_} -->${h}`)}}return s}async function y(u){let l=/!\[\[([^\]#|^]+)(?:(#)([^\]|]+))?(?:\|([^\]]+))?\]\]/g,s=u,c;for(;(c=l.exec(u))!==null;){let h=c[0],_=c[1].trim(),w=c[2],C=c[3],L=c[4];try{let v=o.metadataCache.getFirstLinkpathDest(_,"");if(v){let m=`![[${Xt(n,v.path)}`;w&&C&&(m+=`#${C}`),L&&(m+=`|${L}`),m+="]]",s=s.replace(h,m)}else s=s.replace(h,`<!-- Image not found: ${_} -->`)}catch{s=s.replace(h,`<!-- Error processing image: ${_} -->`)}}return s}async function x(u,l){let s=u;return s=await p(s),s=await a(s),s=await y(s),s=s,s}async function $(u){d="Traitement des liens...",f.clear();try{let l=await x(u,n);return d="Traitement termin\xE9",l}catch(l){throw d="Erreur lors du traitement",l}}function g(){f.clear(),d=""}return e.$$set=u=>{"app"in u&&r(0,o=u.app),"basePath"in u&&r(1,n=u.basePath),"config"in u&&r(2,i=u.config)},[o,n,i,$,g]}var Z=class extends b{constructor(t){super(),O(this,t,te,null,M,{app:0,basePath:1,config:2,processMarkdown:3,resetState:4})}get processMarkdown(){return this.$$.ctx[3]}get resetState(){return this.$$.ctx[4]}},mt=Z;var xt=require("obsidian");function ee(e,t,r){let{app:o}=t,{config:n=null}=t,i="";async function f(l,s){let c=1,h=n?.combinedFilePrefix||"",_=n?.combinedFileSuffix||"-combined",w=`${h}${l}${_}.md`;for(;await o.vault.adapter.exists(`${s}/${w}`);)w=`${h}${l}${_}-${c}.md`,c++;return w}function d(){let l=o.workspace.getActiveFile();return!l||l.extension!=="md"||!l.parent?(o.workspace.trigger("notice","Aucun fichier Markdown valide s\xE9lectionn\xE9."),null):l}async function p(l){let s=l.parent?.path||"",c=l.basename,h=await f(c,s),_=`${s}/${h}`;return{originalFile:l,newFileName:h,parentPath:s,fullPath:_}}async function a(l,s){i="Cr\xE9ation du fichier...";try{await o.vault.create(l.fullPath,s),i="Fichier cr\xE9\xE9 avec succ\xE8s";let c=o.vault.getAbstractFileByPath(l.fullPath);if(c&&c instanceof xt.TFile)return c;throw new Error("Impossible de r\xE9cup\xE9rer le fichier cr\xE9\xE9")}catch(c){throw i="Erreur lors de la cr\xE9ation du fichier",c}}async function y(l){if(!(n&&n.openFileAfterCreation===!1))try{await o.workspace.getLeaf("split","vertical").openFile(l),o.workspace.trigger("notice",`Fichier combin\xE9 ouvert : ${l.name}`)}catch(s){o.workspace.trigger("notice",`Erreur lors de l'ouverture du fichier : ${s}`)}}async function x(l){i="Lecture du fichier original...";try{let s=await o.vault.read(l);return i="Fichier lu avec succ\xE8s",s}catch(s){throw i="Erreur lors de la lecture du fichier",s}}async function $(){i="D\xE9but du processus...";let l=d();if(!l)return null;try{let s=await x(l),c=await p(l);return{originalContent:s,fileInfo:c,activeFile:l}}catch(s){let c=s instanceof Error?s.message:String(s);throw o.workspace.trigger("notice",`Erreur : ${c}`),i="Erreur : "+c,s}}async function g(l,s){try{let c=await a(l,s);return await y(c),c}catch(c){let h=c instanceof Error?c.message:String(c);throw o.workspace.trigger("notice",`Erreur lors de la cr\xE9ation du fichier combin\xE9 : ${h}`),c}}function u(){i=""}return e.$$set=l=>{"app"in l&&r(0,o=l.app),"config"in l&&r(1,n=l.config)},[o,n,$,g,u]}var tt=class extends b{constructor(t){super(),O(this,t,ee,null,M,{app:0,config:1,handleFileCombination:2,finalizeFileCreation:3,resetFileStatus:4})}get handleFileCombination(){return this.$$.ctx[2]}get finalizeFileCreation(){return this.$$.ctx[3]}get resetFileStatus(){return this.$$.ctx[4]}},gt=tt;function $t(e){let t=[];return(e.maxRecursionDepth<1||e.maxRecursionDepth>50)&&t.push("La profondeur de r\xE9cursion doit \xEAtre entre 1 et 50"),e.combinedFileSuffix.length>50&&t.push("Le suffixe du fichier ne peut pas d\xE9passer 50 caract\xE8res"),{isValid:t.length===0,errors:t}}function ne(e,t,r){let o={processEmbeddedLinks:!0,processInternalLinks:!0,processImages:!0,processExternalLinks:!1,combinedFilePrefix:"",combinedFileSuffix:"-combined",showNotifications:!0,openFileAfterCreation:!0,maxRecursionDepth:10,preserveOriginalLinks:!0},n={...o},i="";async function f($){i="Chargement de la configuration...";try{let g=await $.loadData();return g?n={...o,...g}:n={...o},i="Configuration charg\xE9e",n}catch(g){return i="Erreur lors du chargement de la configuration",console.error("Erreur de chargement de configuration:",g),o}}async function d($,g){i="Sauvegarde de la configuration...";try{await $.saveData(g),n={...g},i="Configuration sauvegard\xE9e"}catch(u){throw i="Erreur lors de la sauvegarde de la configuration",console.error("Erreur de sauvegarde de configuration:",u),u}}async function p($,g){let u={...n,...g};await d($,u)}async function a($){await d($,o)}function y(){return{...n}}function x(){i=""}return[f,d,p,a,y,$t,x]}var et=class extends b{constructor(t){super(),O(this,t,ne,null,M,{loadConfig:0,saveConfig:1,updateConfig:2,resetConfig:3,getCurrentConfig:4,validateConfig:5,resetConfigStatus:6})}get loadConfig(){return this.$$.ctx[0]}get saveConfig(){return this.$$.ctx[1]}get updateConfig(){return this.$$.ctx[2]}get resetConfig(){return this.$$.ctx[3]}get getCurrentConfig(){return this.$$.ctx[4]}get validateConfig(){return $t}get resetConfigStatus(){return this.$$.ctx[6]}},yt=et;function re(e,t,r){let{plugin:o}=t,n,i,f,d=!1,p="Pr\xEAt",a=null;async function y(){f=new yt({target:document.createElement("div"),props:{}}),a=await f.loadConfig(o)}async function x(){if(d)return;let{app:u}=o;d=!0,p="Initialisation...";try{await y(),n=new mt({target:document.createElement("div"),props:{app:u,basePath:"",config:a}}),i=new gt({target:document.createElement("div"),props:{app:u,config:a}});let l=await i.handleFileCombination();if(!l){p="Aucun fichier valide s\xE9lectionn\xE9";return}let{originalContent:s,fileInfo:c,activeFile:h}=l;n.$set({basePath:c.parentPath}),p="Traitement du contenu...";let _=await n.processMarkdown(s);p="Cr\xE9ation du fichier final...",await i.finalizeFileCreation(c,_),p="Termin\xE9 avec succ\xE8s !",a.showNotifications&&u.workspace.trigger("notice",`Fichier combin\xE9 cr\xE9\xE9 : ${c.newFileName}`)}catch(l){let s=l instanceof Error?l.message:String(l);a?.showNotifications&&u.workspace.trigger("notice",`Erreur lors de la combinaison : ${s}`),p="Erreur : "+s}finally{d=!1,n&&n.$destroy(),i&&i.$destroy(),f&&f.$destroy()}}function $(){d=!1,p="Pr\xEAt",n&&n.resetState(),i&&i.resetFileStatus(),f&&f.resetConfigStatus()}function g(){return a}return e.$$set=u=>{"plugin"in u&&r(0,o=u.plugin)},[o,x,$,g]}var nt=class extends b{constructor(t){super(),O(this,t,re,null,M,{plugin:0,combineFiles:1,resetState:2,getConfig:3})}get combineFiles(){return this.$$.ctx[1]}get resetState(){return this.$$.ctx[2]}get getConfig(){return this.$$.ctx[3]}},bt=nt;var G=class extends wt.Plugin{appView=null;async onload(){this.addCommand({id:"combine-markdown-files",name:"Combiner les fichiers Markdown avec les embeds",callback:()=>this.combineMarkdownFiles()}),this.addRibbonIcon("link","Combiner les fichiers Markdown",()=>{this.combineMarkdownFiles()}),this.appView=new bt({target:document.createElement("div"),props:{plugin:this}})}async combineMarkdownFiles(){this.appView&&await this.appView.combineFiles()}onunload(){this.appView?.$destroy(),this.appView=null}};

/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

"use strict";var R=Object.defineProperty;var _t=Object.getOwnPropertyDescriptor;var ht=Object.getOwnPropertyNames;var mt=Object.prototype.hasOwnProperty;var xt=(e,t)=>{for(var n in t)R(e,n,{get:t[n],enumerable:!0})},$t=(e,t,n,o)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of ht(t))!mt.call(e,r)&&r!==n&&R(e,r,{get:()=>t[r],enumerable:!(o=_t(t,r))||o.enumerable});return e};var gt=e=>$t(R({},"__esModule",{value:!0}),e);var Gt={};xt(Gt,{default:()=>P});module.exports=gt(Gt);var L=require("obsidian");function _(){}function I(e){return e()}function A(){return Object.create(null)}function m(e){e.forEach(I)}function N(e){return typeof e=="function"}function X(e,t){return e!=e?t==t:e!==t||e&&typeof e=="object"||typeof e=="function"}function K(e){return Object.keys(e).length===0}var B=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;var D=class e{_listeners="WeakMap"in B?new WeakMap:void 0;_observer=void 0;options;constructor(t){this.options=t}observe(t,n){return this._listeners.set(t,n),this._getObserver().observe(t,this.options),()=>{this._listeners.delete(t),this._observer.unobserve(t)}}_getObserver(){return this._observer??(this._observer=new ResizeObserver(t=>{for(let n of t)e.entries.set(n.target,n),this._listeners.get(n.target)?.(n)}))}};D.entries="WeakMap"in B?new WeakMap:void 0;var Y=!1;function Q(){Y=!0}function Z(){Y=!1}function h(e,t){e.appendChild(t)}function tt(e,t,n){let o=et(e);if(!o.getElementById(t)){let r=$("style");r.id=t,r.textContent=n,wt(o,r)}}function et(e){if(!e)return document;let t=e.getRootNode?e.getRootNode():e.ownerDocument;return t&&t.host?t:e.ownerDocument}function wt(e,t){return h(e.head||e,t),t.sheet}function E(e,t,n){e.insertBefore(t,n||null)}function b(e){e.parentNode&&e.parentNode.removeChild(e)}function $(e){return document.createElement(e)}function S(e){return document.createTextNode(e)}function nt(){return S(" ")}function z(e,t,n,o){return e.addEventListener(t,n,o),()=>e.removeEventListener(t,n,o)}function g(e,t,n){n==null?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function rt(e){return Array.from(e.childNodes)}function G(e,t){t=""+t,e.data!==t&&(e.data=t)}function ot(e){let t={};return e.childNodes.forEach(n=>{t[n.slot||"default"]=!0}),t}var w;function x(e){w=e}var y=[];var st=[],F=[],ct=[],Ot=Promise.resolve(),W=!1;function lt(){W||(W=!0,Ot.then(T))}function O(e){F.push(e)}var V=new Set,v=0;function T(){if(v!==0)return;let e=w;do{try{for(;v<y.length;){let t=y[v];v++,x(t),Mt(t.$$)}}catch(t){throw y.length=0,v=0,t}for(x(null),y.length=0,v=0;st.length;)st.pop()();for(let t=0;t<F.length;t+=1){let n=F[t];V.has(n)||(V.add(n),n())}F.length=0}while(y.length);for(;ct.length;)ct.pop()();W=!1,V.clear(),x(e)}function Mt(e){if(e.fragment!==null){e.update(),m(e.before_update);let t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(O)}}function ut(e){let t=[],n=[];F.forEach(o=>e.indexOf(o)===-1?t.push(o):n.push(o)),n.forEach(o=>o()),F=t}var Ct=new Set;function j(e,t){e&&e.i&&(Ct.delete(e),e.i(t))}var Nt=["allowfullscreen","allowpaymentrequest","async","autofocus","autoplay","checked","controls","default","defer","disabled","formnovalidate","hidden","inert","ismap","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","selected"],Dt=new Set([...Nt]);function Pt(e,t,n){let{fragment:o,after_update:r}=e.$$;o&&o.m(t,n),O(()=>{let i=e.$$.on_mount.map(I).filter(N);e.$$.on_destroy?e.$$.on_destroy.push(...i):m(i),e.$$.on_mount=[]}),r.forEach(O)}function Lt(e,t){let n=e.$$;n.fragment!==null&&(ut(n.after_update),m(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function qt(e,t){e.$$.dirty[0]===-1&&(y.push(e),lt(),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function at(e,t,n,o,r,i,u=null,l=[-1]){let c=w;x(e);let s=e.$$={fragment:null,ctx:[],props:i,update:_,not_equal:r,bound:A(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(c?c.$$.context:[])),callbacks:A(),dirty:l,skip_bound:!1,root:t.target||c.$$.root};u&&u(s.root);let f=!1;if(s.ctx=n?n(e,t.props||{},(a,p,...d)=>{let C=d.length?d[0]:p;return s.ctx&&r(s.ctx[a],s.ctx[a]=C)&&(!s.skip_bound&&s.bound[a]&&s.bound[a](C),f&&qt(e,a)),p}):[],s.update(),f=!0,m(s.before_update),s.fragment=o?o(s.ctx):!1,t.target){if(t.hydrate){Q();let a=rt(t.target);s.fragment&&s.fragment.l(a),a.forEach(b)}else s.fragment&&s.fragment.c();t.intro&&j(e.$$.fragment),Pt(e,t.target,t.anchor),Z(),T()}x(c)}var Rt;typeof HTMLElement=="function"&&(Rt=class extends HTMLElement{$$ctor;$$s;$$c;$$cn=!1;$$d={};$$r=!1;$$p_d={};$$l={};$$l_u=new Map;constructor(e,t,n){super(),this.$$ctor=e,this.$$s=t,n&&this.attachShadow({mode:"open"})}addEventListener(e,t,n){if(this.$$l[e]=this.$$l[e]||[],this.$$l[e].push(t),this.$$c){let o=this.$$c.$on(e,t);this.$$l_u.set(t,o)}super.addEventListener(e,t,n)}removeEventListener(e,t,n){if(super.removeEventListener(e,t,n),this.$$c){let o=this.$$l_u.get(t);o&&(o(),this.$$l_u.delete(t))}if(this.$$l[e]){let o=this.$$l[e].indexOf(t);o>=0&&this.$$l[e].splice(o,1)}}async connectedCallback(){if(this.$$cn=!0,!this.$$c){let e=function(r){return()=>{let i;return{c:function(){i=$("slot"),r!=="default"&&g(i,"name",r)},m:function(c,s){E(c,i,s)},d:function(c){c&&b(i)}}}};if(await Promise.resolve(),!this.$$cn||this.$$c)return;let t={},n=ot(this);for(let r of this.$$s)r in n&&(t[r]=[e(r)]);for(let r of this.attributes){let i=this.$$g_p(r.name);i in this.$$d||(this.$$d[i]=H(i,r.value,this.$$p_d,"toProp"))}for(let r in this.$$p_d)!(r in this.$$d)&&this[r]!==void 0&&(this.$$d[r]=this[r],delete this[r]);this.$$c=new this.$$ctor({target:this.shadowRoot||this,props:{...this.$$d,$$slots:t,$$scope:{ctx:[]}}});let o=()=>{this.$$r=!0;for(let r in this.$$p_d)if(this.$$d[r]=this.$$c.$$.ctx[this.$$c.$$.props[r]],this.$$p_d[r].reflect){let i=H(r,this.$$d[r],this.$$p_d,"toAttribute");i==null?this.removeAttribute(this.$$p_d[r].attribute||r):this.setAttribute(this.$$p_d[r].attribute||r,i)}this.$$r=!1};this.$$c.$$.after_update.push(o),o();for(let r in this.$$l)for(let i of this.$$l[r]){let u=this.$$c.$on(r,i);this.$$l_u.set(i,u)}this.$$l={}}}attributeChangedCallback(e,t,n){this.$$r||(e=this.$$g_p(e),this.$$d[e]=H(e,n,this.$$p_d,"toProp"),this.$$c?.$set({[e]:this.$$d[e]}))}disconnectedCallback(){this.$$cn=!1,Promise.resolve().then(()=>{!this.$$cn&&this.$$c&&(this.$$c.$destroy(),this.$$c=void 0)})}$$g_p(e){return Object.keys(this.$$p_d).find(t=>this.$$p_d[t].attribute===e||!this.$$p_d[t].attribute&&t.toLowerCase()===e)||e}});function H(e,t,n,o){let r=n[e]?.type;if(t=r==="Boolean"&&typeof t!="boolean"?t!=null:t,!o||!n[e])return t;if(o==="toAttribute")switch(r){case"Object":case"Array":return t==null?null:JSON.stringify(t);case"Boolean":return t?"":null;case"Number":return t??null;default:return t}else switch(r){case"Object":case"Array":return t&&JSON.parse(t);case"Boolean":return t;case"Number":return t!=null?+t:t;default:return t}}var M=class{$$=void 0;$$set=void 0;$destroy(){Lt(this,1),this.$destroy=_}$on(t,n){if(!N(n))return _;let o=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return o.push(n),()=>{let r=o.indexOf(n);r!==-1&&o.splice(r,1)}}$set(t){this.$$set&&!K(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}};var ft="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(ft);function It(e){tt(e,"svelte-qci2vx",".combiner-app.svelte-qci2vx{width:100%;padding:10px;background:var(--background-secondary);border-radius:5px;margin:10px 0}.status-bar.svelte-qci2vx{display:flex;justify-content:space-between;align-items:center;gap:10px}.status.svelte-qci2vx{font-size:14px;color:var(--text-muted)}.combine-btn.svelte-qci2vx{background:var(--interactive-accent);color:var(--text-on-accent);border:none;padding:8px 16px;border-radius:4px;cursor:pointer;font-size:14px;transition:background-color 0.2s}.combine-btn.svelte-qci2vx:hover:not(:disabled){background:var(--interactive-accent-hover)}.combine-btn.svelte-qci2vx:disabled{opacity:0.6;cursor:not-allowed}")}function Bt(e){let t,n,o,r,i,u,l,c=e[1]?"Traitement...":"Combiner le fichier actuel",s,f,a;return{c(){t=$("div"),n=$("div"),o=$("span"),r=S("Status: "),i=S(e[0]),u=nt(),l=$("button"),s=S(c),g(o,"class","status svelte-qci2vx"),g(l,"class","combine-btn svelte-qci2vx"),l.disabled=e[1],g(n,"class","status-bar svelte-qci2vx"),g(t,"class","combiner-app svelte-qci2vx")},m(p,d){E(p,t,d),h(t,n),h(n,o),h(o,r),h(o,i),h(n,u),h(n,l),h(l,s),f||(a=z(l,"click",e[2]),f=!0)},p(p,[d]){d&1&&G(i,p[0]),d&2&&c!==(c=p[1]?"Traitement...":"Combiner le fichier actuel")&&G(s,c),d&2&&(l.disabled=p[1])},i:_,o:_,d(p){p&&b(t),f=!1,a()}}}function zt(e,t,n){let{plugin:o}=t,r="Pr\xEAt",i=!1;async function u(){if(!i){n(1,i=!0),n(0,r="Traitement en cours...");try{await o.combineMarkdownFiles(),n(0,r="Termin\xE9 !")}catch(l){n(0,r="Erreur : "+l.message)}finally{n(1,i=!1)}}}return e.$$set=l=>{"plugin"in l&&n(3,o=l.plugin)},[r,i,u,o]}var U=class extends M{constructor(t){super(),at(this,t,zt,Bt,X,{plugin:3},It)}},pt=U;var P=class extends L.Plugin{appView=null;async onload(){this.addCommand({id:"combine-markdown-files",name:"Combiner les fichiers Markdown avec les embeds",callback:()=>this.combineMarkdownFiles()}),this.appView=new pt({target:document.body,props:{plugin:this}})}async combineMarkdownFiles(){let{app:t}=this,n=t.workspace.getActiveFile();if(!n||n.extension!=="md"||!n.parent){t.workspace.trigger("notice","Aucun fichier Markdown valide s\xE9lectionn\xE9.");return}t.workspace.trigger("notice",`Combinaison de ${n.name}...`);try{let o=await t.vault.read(n),r=await this.processMarkdown(o,t),i=n.parent.path,u=n.basename,l=await this.getUniqueFileName(t,u,i),c=`${i}/${l}`;await t.vault.create(c,r),t.workspace.trigger("notice",`Fichier combin\xE9 cr\xE9\xE9 : ${c}`);let s=t.vault.getAbstractFileByPath(c);s&&s instanceof L.TFile&&await t.workspace.getLeaf("split","vertical").openFile(s)}catch(o){let r=o instanceof Error?o.message:String(o);t.workspace.trigger("notice",`Erreur lors de la cr\xE9ation du fichier combin\xE9 : ${r}`)}}async processMarkdown(t,n){let o=new Set,r=this;async function i(u){let l=/!\[\[([^\]#|^]+)(?:(#)([^\]|]+))?(?:(\^)([^\]|]+))?(?:\|([^\]]+))?\]\]/g,c=u,s;for(;(s=l.exec(u))!==null;){let f=s[0],a=s[1].trim(),p=s[2],d=s[3],C=s[4],J=s[5];if(!o.has(a)){o.add(a);try{let q=n.metadataCache.getFirstLinkpathDest(a,"");if(q){let k=await n.vault.read(q);p&&d?k=r.extractSection(k,d):C&&J&&(k=r.extractBlock(k,J));let dt=await i(k);c=c.replace(f,dt)}else c=c.replace(f,`<!-- Linked file not found: ${a} -->`)}catch{c=c.replace(f,`<!-- Error: Could not process ${a} -->`)}finally{o.delete(a)}}}return c}return await i(t)}extractSection(t,n){let o=t.split(`
`),r=new RegExp(`^#+\\s*${n}$`),i=!1,u=[],l=0;for(let c of o){let s=c.match(/^(#+)\s*(.*)$/);if(s){let f=s[1].length;r.test(c)?(i=!0,l=f,u.push(c)):i&&f<=l&&(i=!1)}i&&u.push(c)}return u.join(`
`)}extractBlock(t,n){let o=t.split(`
`),r=new RegExp(`\\s\\^${n}$`);for(let i=0;i<o.length;i++)if(r.test(o[i]))return o[i].replace(r,"").trim();return""}async getUniqueFileName(t,n,o){let r=1,i=`${n}-combined.md`;for(;await t.vault.adapter.exists(`${o}/${i}`);)i=`${n}-combined-${r}.md`,r++;return i}onunload(){this.appView?.$destroy(),this.appView=null}};

/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

"use strict";var pt=Object.defineProperty;var Vt=Object.getOwnPropertyDescriptor;var Jt=Object.getOwnPropertyNames;var Xt=Object.prototype.hasOwnProperty;var Kt=(e,t)=>{for(var n in t)pt(e,n,{get:t[n],enumerable:!0})},Yt=(e,t,n,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of Jt(t))!Xt.call(e,o)&&o!==n&&pt(e,o,{get:()=>t[o],enumerable:!(r=Vt(t,o))||r.enumerable});return e};var Qt=e=>Yt(pt({},"__esModule",{value:!0}),e);var Ae={};Kt(Ae,{default:()=>at});module.exports=Qt(Ae);var H=require("obsidian");function T(){}function dt(e){return e()}function Q(){return Object.create(null)}function k(e){e.forEach(dt)}function Z(e){return typeof e=="function"}function tt(e,t){return e!=e?t==t:e!==t||e&&typeof e=="object"||typeof e=="function"}function Et(e){return Object.keys(e).length===0}var ht=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;var et=class e{_listeners="WeakMap"in ht?new WeakMap:void 0;_observer=void 0;options;constructor(t){this.options=t}observe(t,n){return this._listeners.set(t,n),this._getObserver().observe(t,this.options),()=>{this._listeners.delete(t),this._observer.unobserve(t)}}_getObserver(){return this._observer??(this._observer=new ResizeObserver(t=>{for(let n of t)e.entries.set(n.target,n),this._listeners.get(n.target)?.(n)}))}};et.entries="WeakMap"in ht?new WeakMap:void 0;var St=!1;function Ct(){St=!0}function Mt(){St=!1}function D(e,t){e.appendChild(t)}function At(e,t,n){let r=Dt(e);if(!r.getElementById(t)){let o=O("style");o.id=t,o.textContent=n,ee(r,o)}}function Dt(e){if(!e)return document;let t=e.getRootNode?e.getRootNode():e.ownerDocument;return t&&t.host?t:e.ownerDocument}function ee(e,t){return D(e.head||e,t),t.sheet}function V(e,t,n){e.insertBefore(t,n||null)}function N(e){e.parentNode&&e.parentNode.removeChild(e)}function O(e){return document.createElement(e)}function ne(e){return document.createTextNode(e)}function nt(){return ne(" ")}function ot(e,t,n,r){return e.addEventListener(t,n,r),()=>e.removeEventListener(t,n,r)}function I(e,t,n){n==null?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function Lt(e){return Array.from(e.childNodes)}function _t(e,t){e.value=t??""}function Ot(e){let t={};return e.childNodes.forEach(n=>{t[n.slot||"default"]=!0}),t}var R;function L(e){R=e}var P=[];var rt=[],q=[],Nt=[],le=Promise.resolve(),xt=!1;function Pt(){xt||(xt=!0,le.then(it))}function J(e){q.push(e)}var mt=new Set,B=0;function it(){if(B!==0)return;let e=R;do{try{for(;B<P.length;){let t=P[B];B++,L(t),ae(t.$$)}}catch(t){throw P.length=0,B=0,t}for(L(null),P.length=0,B=0;rt.length;)rt.pop()();for(let t=0;t<q.length;t+=1){let n=q[t];mt.has(n)||(mt.add(n),n())}q.length=0}while(P.length);for(;Nt.length;)Nt.pop()();xt=!1,mt.clear(),L(e)}function ae(e){if(e.fragment!==null){e.update(),k(e.before_update);let t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(J)}}function jt(e){let t=[],n=[];q.forEach(r=>e.indexOf(r)===-1?t.push(r):n.push(r)),n.forEach(r=>r()),q=t}var st=new Set,ue;function G(e,t){e&&e.i&&(st.delete(e),e.i(t))}function ct(e,t,n,r){if(e&&e.o){if(st.has(e))return;st.add(e),ue.c.push(()=>{st.delete(e),r&&(n&&e.d(1),r())}),e.o(t)}else r&&r()}var fe=["allowfullscreen","allowpaymentrequest","async","autofocus","autoplay","checked","controls","default","defer","disabled","formnovalidate","hidden","inert","ismap","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","selected"],pe=new Set([...fe]);function It(e){e&&e.c()}function bt(e,t,n){let{fragment:r,after_update:o}=e.$$;r&&r.m(t,n),J(()=>{let s=e.$$.on_mount.map(dt).filter(Z);e.$$.on_destroy?e.$$.on_destroy.push(...s):k(s),e.$$.on_mount=[]}),o.forEach(J)}function $t(e,t){let n=e.$$;n.fragment!==null&&(jt(n.after_update),k(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function _e(e,t){e.$$.dirty[0]===-1&&(P.push(e),Pt(),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function lt(e,t,n,r,o,s,_=null,F=[-1]){let f=R;L(e);let c=e.$$={fragment:null,ctx:[],props:s,update:T,not_equal:o,bound:Q(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(f?f.$$.context:[])),callbacks:Q(),dirty:F,skip_bound:!1,root:t.target||f.$$.root};_&&_(c.root);let d=!1;if(c.ctx=n?n(e,t.props||{},(m,A,...$)=>{let E=$.length?$[0]:A;return c.ctx&&o(c.ctx[m],c.ctx[m]=E)&&(!c.skip_bound&&c.bound[m]&&c.bound[m](E),d&&_e(e,m)),A}):[],c.update(),d=!0,k(c.before_update),c.fragment=r?r(c.ctx):!1,t.target){if(t.hydrate){Ct();let m=Lt(t.target);c.fragment&&c.fragment.l(m),m.forEach(N)}else c.fragment&&c.fragment.c();t.intro&&G(e.$$.fragment),bt(e,t.target,t.anchor),Mt(),it()}L(f)}var me;typeof HTMLElement=="function"&&(me=class extends HTMLElement{$$ctor;$$s;$$c;$$cn=!1;$$d={};$$r=!1;$$p_d={};$$l={};$$l_u=new Map;constructor(e,t,n){super(),this.$$ctor=e,this.$$s=t,n&&this.attachShadow({mode:"open"})}addEventListener(e,t,n){if(this.$$l[e]=this.$$l[e]||[],this.$$l[e].push(t),this.$$c){let r=this.$$c.$on(e,t);this.$$l_u.set(t,r)}super.addEventListener(e,t,n)}removeEventListener(e,t,n){if(super.removeEventListener(e,t,n),this.$$c){let r=this.$$l_u.get(t);r&&(r(),this.$$l_u.delete(t))}if(this.$$l[e]){let r=this.$$l[e].indexOf(t);r>=0&&this.$$l[e].splice(r,1)}}async connectedCallback(){if(this.$$cn=!0,!this.$$c){let e=function(o){return()=>{let s;return{c:function(){s=O("slot"),o!=="default"&&I(s,"name",o)},m:function(f,c){V(f,s,c)},d:function(f){f&&N(s)}}}};if(await Promise.resolve(),!this.$$cn||this.$$c)return;let t={},n=Ot(this);for(let o of this.$$s)o in n&&(t[o]=[e(o)]);for(let o of this.attributes){let s=this.$$g_p(o.name);s in this.$$d||(this.$$d[s]=gt(s,o.value,this.$$p_d,"toProp"))}for(let o in this.$$p_d)!(o in this.$$d)&&this[o]!==void 0&&(this.$$d[o]=this[o],delete this[o]);this.$$c=new this.$$ctor({target:this.shadowRoot||this,props:{...this.$$d,$$slots:t,$$scope:{ctx:[]}}});let r=()=>{this.$$r=!0;for(let o in this.$$p_d)if(this.$$d[o]=this.$$c.$$.ctx[this.$$c.$$.props[o]],this.$$p_d[o].reflect){let s=gt(o,this.$$d[o],this.$$p_d,"toAttribute");s==null?this.removeAttribute(this.$$p_d[o].attribute||o):this.setAttribute(this.$$p_d[o].attribute||o,s)}this.$$r=!1};this.$$c.$$.after_update.push(r),r();for(let o in this.$$l)for(let s of this.$$l[o]){let _=this.$$c.$on(o,s);this.$$l_u.set(s,_)}this.$$l={}}}attributeChangedCallback(e,t,n){this.$$r||(e=this.$$g_p(e),this.$$d[e]=gt(e,n,this.$$p_d,"toProp"),this.$$c?.$set({[e]:this.$$d[e]}))}disconnectedCallback(){this.$$cn=!1,Promise.resolve().then(()=>{!this.$$cn&&this.$$c&&(this.$$c.$destroy(),this.$$c=void 0)})}$$g_p(e){return Object.keys(this.$$p_d).find(t=>this.$$p_d[t].attribute===e||!this.$$p_d[t].attribute&&t.toLowerCase()===e)||e}});function gt(e,t,n,r){let o=n[e]?.type;if(t=o==="Boolean"&&typeof t!="boolean"?t!=null:t,!r||!n[e])return t;if(r==="toAttribute")switch(o){case"Object":case"Array":return t==null?null:JSON.stringify(t);case"Boolean":return t?"":null;case"Number":return t??null;default:return t}else switch(o){case"Object":case"Array":return t&&JSON.parse(t);case"Boolean":return t;case"Number":return t!=null?+t:t;default:return t}}var j=class{$$=void 0;$$set=void 0;$destroy(){$t(this,1),this.$destroy=T}$on(t,n){if(!Z(n))return T;let r=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return r.push(n),()=>{let o=r.indexOf(n);o!==-1&&r.splice(o,1)}}$set(t){this.$$set&&!Et(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}};var Rt="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(Rt);var Lo=require("obsidian");var So=require("obsidian");function Ee(e,t,n){let{app:r}=t,{basePath:o}=t,{settings:s}=t,{config:_=null}=t,{combinedFileName:F=""}=t,f=new Set,c="",d=new Set,m={},A=new Set;function $(l,g){let i=[],p=[],b=g.split(`
`);for(let a of b){let S=a.match(/^(#+)\s*(.*)$/);if(S){let h=S[2].trim().replace(/_/g,"-").replace(/\s+/g,"-").toLowerCase();i.push(h)}let x=a.match(/\^([\w-]+)$/);x&&p.push(x[1])}m[l.toLowerCase()]={file:l,sections:i,blocks:p}}async function E(l){let g=/!\[\[([^\]#|^]+)(?:(#)([^\]|]+))?(?:(\^)([^\]|]+))?(?:\|([^\]]+))?\]\]/g,i=l,p;for(;(p=g.exec(l))!==null;){let b=p[0],a=p[1].trim(),S=p[2],x=p[3],h=p[4],C=p[5];if(/\.(png|jpg|jpeg|gif|svg|bmp|webp)$/i.test(a)){let v=`%% EMBED IMAGE: ${a} %%
`;i=i.replace(b,v+b);continue}if(!f.has(a)){f.add(a),d.add(a.toLowerCase());try{let v=r.metadataCache.getFirstLinkpathDest(a,"");if(v){let y=await r.vault.read(v);(!y||y.trim()==="")&&(y=`<!-- Contenu vide ou non trouv\xE9 pour '${a}' -->`);let u=y;$(a,u),u=await kt(u,v.parent?.path||"");let X=`^${a.replace(/_/g,"-")}`,z=`%% EMBED START: [${a}] %% ${X}
`,K=`
%% EMBED END: ${a} %%`;i=i.replace(b,z+u+K)}else i=i.replace(b,`![[${a}]]`)}catch{i=i.replace(b,`![[${a}]]`)}finally{f.delete(a)}}}return i}async function W(l){let g=/\[\[([^\]#|^/]+)(?:(#)([^\]|]+))?(?:(\^)([^\]|]+))?(?:\|([^\]]+))?\]\]/g,i=l.split(`
`),p=!1,b=-1,a=[];for(let x=0;x<i.length;x++)/^(```|~~~)/.test(i[x].trim())&&(p?(p=!1,a.push({start:b,end:x})):(p=!0,b=x));let S=[];for(let x=0;x<i.length;x++){let h=i[x],C,v=!1;for(let y of a)if(x>=y.start&&x<=y.end){v=!0;break}if(v){S.push(h);continue}for(;(C=g.exec(h))!==null;){let y=C[0],u=C[1].trim(),X=C[2],z=C[3],K=C[4],Y=C[5],U=C[6];if(/\.(png|jpg|jpeg|gif|svg|bmp|webp)$/i.test(u))continue;let ut=m[u.toLowerCase()];if(ut){if(!X&&!K){let w=`^${u.replace(/_/g,"-")}`,M=U||u;h=h.replace(y,`[[#${w}|${M}]]`);continue}if(X&&z){let w=z.replace(/_/g,"-").replace(/\s+/g,"-").toLowerCase();if(ut.sections.includes(w)){let M=U||z;h=h.replace(y,`[[#${w}|${M}]]`);continue}}if(K&&Y){let w="^"+Y.replace(/_/g,"-");if(ut.blocks.includes(Y.replace(/_/g,"-"))){let M=U||Y;h=h.replace(y,`[[#${w}|${M}]]`);continue}}}if(s.useHiddenEmbeds&&!d.has(u.toLowerCase())&&!A.has(u.toLowerCase()))try{let w=r.metadataCache.getFirstLinkpathDest(u,"");if(w){let M=await r.vault.read(w);(!M||M.trim()==="")&&(M=`<!-- Contenu vide ou non trouv\xE9 pour '${u}' -->`);let Ut=`%%
%% EMBED HIDDEN START: [[${u}]] %%
${M}
%% EMBED HIDDEN END %%
%%`;S.push(Ut),A.add(u.toLowerCase())}}catch{}let ft=r.metadataCache.getFirstLinkpathDest(u,"");if(ft&&!ft.path.startsWith("http")&&!ft.path.startsWith("/")){let w=U||u;h=h.replace(y,`[[${u}|${w}]]`)}else{let w=U||u;h=h.replace(y,`[[${u}|${w}]]`)}}g.lastIndex=0,S.push(h)}return S.join(`
`)}async function Gt(l){let g=/!\[\[([^\]#|^]+)(?:(#)([^\]|]+))?(?:\|([^\]]+))?\]\]/g,i=l,p;for(;(p=g.exec(l))!==null;){let b=p[0],a=p[1].trim(),S=p[2],x=p[3],h=p[4];/\.(png|jpg|jpeg|gif|svg|bmp|webp)$/i.test(a)&&(a=a.replace(/\.md$/i,""));try{let v=r.metadataCache.getFirstLinkpathDest(a,"");if(v){let u=`![[${v.path.replace(/\\/g,"/")}`;S&&x&&(u+=`#${x}`),h&&(u+=`|${h}`),u+="]]",i=i.replace(b,u)}else i=i.replace(b,`![[${a}]]`)}catch{i=i.replace(b,`![[${a}]]`)}}return i}async function kt(l,g){let i=l;return i=await E(i),i=await W(i),i=await Gt(i),i=i,i}function Ht(l){return l.replace(/\[\[([^\]#|^/]+)#\^([\w-]+)(?:\|([^\]]+))?\]\]/g,(g,i,p,b)=>d.has(i.toLowerCase())?b?`[[#^${p}|${b}]]`:`[[#^${p}]]`:g)}async function Wt(l){c="Traitement des liens...",f.clear(),d.clear(),A.clear(),m={};try{let g=await kt(l,o);return g=Ht(g),c="Traitement termin\xE9",g}catch(g){throw c="Erreur lors du traitement",g}}function zt(){f.clear(),c="",d.clear(),A.clear(),m={}}return e.$$set=l=>{"app"in l&&n(0,r=l.app),"basePath"in l&&n(1,o=l.basePath),"settings"in l&&n(2,s=l.settings),"config"in l&&n(3,_=l.config),"combinedFileName"in l&&n(4,F=l.combinedFileName)},[r,o,s,_,F,Wt,zt]}var yt=class extends j{constructor(t){super(),lt(this,t,Ee,null,tt,{app:0,basePath:1,settings:2,config:3,combinedFileName:4,processMarkdown:5,resetState:6})}get processMarkdown(){return this.$$.ctx[5]}get resetState(){return this.$$.ctx[6]}},Bt=yt;function Se(e){At(e,"svelte-v99t9y",".combiner-app.svelte-v99t9y{padding:1rem}textarea.svelte-v99t9y{width:100%;height:400px;margin-top:1rem}")}function Ce(e){let t,n,r,o,s,_,F,f,c,d,m,A={app:e[0],settings:e[1],basePath:"",config:null,combinedFileName:""};return o=new Bt({props:A}),e[5](o),{c(){t=O("div"),n=O("h1"),n.textContent="Markdown Combiner",r=nt(),It(o.$$.fragment),s=nt(),_=O("button"),_.textContent="Combine Active Note",F=nt(),f=O("textarea"),f.readOnly=!0,I(f,"class","svelte-v99t9y"),I(t,"class","combiner-app svelte-v99t9y")},m($,E){V($,t,E),D(t,n),D(t,r),bt(o,t,null),D(t,s),D(t,_),D(t,F),D(t,f),_t(f,e[3]),c=!0,d||(m=[ot(_,"click",e[4]),ot(f,"input",e[6])],d=!0)},p($,[E]){let W={};E&1&&(W.app=$[0]),E&2&&(W.settings=$[1]),o.$set(W),E&8&&_t(f,$[3])},i($){c||(G(o.$$.fragment,$),c=!0)},o($){ct(o.$$.fragment,$),c=!1},d($){$&&N(t),e[5](null),$t(o),d=!1,k(m)}}}function Me(e,t,n){let{app:r}=t,{settings:o}=t,s,_="";async function F(){if(s){let d=r.workspace.getActiveFile();if(d){let m=await r.vault.read(d);n(3,_=await s.processMarkdown(m))}}}function f(d){rt[d?"unshift":"push"](()=>{s=d,n(2,s)})}function c(){_=this.value,n(3,_)}return e.$$set=d=>{"app"in d&&n(0,r=d.app),"settings"in d&&n(1,o=d.settings)},[r,o,s,_,F,f,c]}var wt=class extends j{constructor(t){super(),lt(this,t,Me,Ce,tt,{app:0,settings:1},Se)}},qt=wt;var vt={useHiddenEmbeds:!0};var at=class extends H.Plugin{settings=vt;view;async onload(){await this.loadSettings(),this.addSettingTab(new Ft(this.app,this)),this.addRibbonIcon("dice","Combine Notes",()=>{this.activateView()}),this.addCommand({id:"open-combiner-view",name:"Open Combiner",callback:()=>{this.activateView()}})}async onunload(){this.view}activateView(){let t=this.app.workspace.getRightLeaf(!1);t&&t.view.containerEl.children[1]&&(this.view=new qt({target:t.view.containerEl.children[1],props:{app:this.app,settings:this.settings}}),this.app.workspace.revealLeaf(t))}async loadSettings(){this.settings=Object.assign({},vt,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}},Ft=class extends H.PluginSettingTab{plugin;constructor(t,n){super(t,n),this.plugin=n}display(){let{containerEl:t}=this;t.empty(),t.createEl("h2",{text:"Settings for Combiner Plugin."}),new H.Setting(t).setName("Use Hidden Embeds").setDesc("If enabled, internal links to notes not already embedded will be added as hidden comment blocks.").addToggle(n=>n.setValue(this.plugin.settings.useHiddenEmbeds).onChange(async r=>{this.plugin.settings.useHiddenEmbeds=r,await this.plugin.saveSettings()}))}};

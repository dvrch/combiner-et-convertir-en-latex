/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

"use strict";var G=Object.defineProperty;var Ft=Object.getOwnPropertyDescriptor;var kt=Object.getOwnPropertyNames;var Et=Object.prototype.hasOwnProperty;var Ct=(t,e)=>{for(var n in e)G(t,n,{get:e[n],enumerable:!0})},St=(t,e,n,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of kt(e))!Et.call(t,r)&&r!==n&&G(t,r,{get:()=>e[r],enumerable:!(o=Ft(e,r))||o.enumerable});return t};var Mt=t=>St(G({},"__esModule",{value:!0}),t);var ee={};Ct(ee,{default:()=>q});module.exports=Mt(ee);var bt=require("obsidian");function S(){}function V(t){return t()}function N(){return Object.create(null)}function w(t){t.forEach(V)}function j(t){return typeof t=="function"}function k(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}function et(t){return Object.keys(t).length===0}var W=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;var I=class t{_listeners="WeakMap"in W?new WeakMap:void 0;_observer=void 0;options;constructor(e){this.options=e}observe(e,n){return this._listeners.set(e,n),this._getObserver().observe(e,this.options),()=>{this._listeners.delete(e),this._observer.unobserve(e)}}_getObserver(){return this._observer??(this._observer=new ResizeObserver(e=>{for(let n of e)t.entries.set(n.target,n),this._listeners.get(n.target)?.(n)}))}};I.entries="WeakMap"in W?new WeakMap:void 0;var nt=!1;function rt(){nt=!0}function ot(){nt=!1}function H(t,e,n){t.insertBefore(e,n||null)}function T(t){t.parentNode&&t.parentNode.removeChild(t)}function it(t){return document.createElement(t)}function U(t,e,n){n==null?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function st(t){return Array.from(t.childNodes)}function ct(t){let e={};return t.childNodes.forEach(n=>{e[n.slot||"default"]=!0}),e}var O;function v(t){O=t}var M=[];var at=[],P=[],ut=[],jt=Promise.resolve(),X=!1;function ft(){X||(X=!0,jt.then(R))}function L(t){P.push(t)}var J=new Set,A=0;function R(){if(A!==0)return;let t=O;do{try{for(;A<M.length;){let e=M[A];A++,v(e),It(e.$$)}}catch(e){throw M.length=0,A=0,e}for(v(null),M.length=0,A=0;at.length;)at.pop()();for(let e=0;e<P.length;e+=1){let n=P[e];J.has(n)||(J.add(n),n())}P.length=0}while(M.length);for(;ut.length;)ut.pop()();X=!1,J.clear(),v(t)}function It(t){if(t.fragment!==null){t.update(),w(t.before_update);let e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(L)}}function pt(t){let e=[],n=[];P.forEach(o=>t.indexOf(o)===-1?e.push(o):n.push(o)),n.forEach(o=>o()),P=e}var Rt=new Set;function B(t,e){t&&t.i&&(Rt.delete(t),t.i(e))}var qt=["allowfullscreen","allowpaymentrequest","async","autofocus","autoplay","checked","controls","default","defer","disabled","formnovalidate","hidden","inert","ismap","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","selected"],zt=new Set([...qt]);function Wt(t,e,n){let{fragment:o,after_update:r}=t.$$;o&&o.m(e,n),L(()=>{let s=t.$$.on_mount.map(V).filter(j);t.$$.on_destroy?t.$$.on_destroy.push(...s):w(s),t.$$.on_mount=[]}),r.forEach(L)}function Ht(t,e){let n=t.$$;n.fragment!==null&&(pt(n.after_update),w(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function Ut(t,e){t.$$.dirty[0]===-1&&(M.push(t),ft(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function E(t,e,n,o,r,s,d=null,h=[-1]){let _=O;v(t);let a=t.$$={fragment:null,ctx:[],props:s,update:S,not_equal:r,bound:N(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(_?_.$$.context:[])),callbacks:N(),dirty:h,skip_bound:!1,root:e.target||_.$$.root};d&&d(a.root);let x=!1;if(a.ctx=n?n(t,e.props||{},(m,g,...u)=>{let p=u.length?u[0]:g;return a.ctx&&r(a.ctx[m],a.ctx[m]=p)&&(!a.skip_bound&&a.bound[m]&&a.bound[m](p),x&&Ut(t,m)),g}):[],a.update(),x=!0,w(a.before_update),a.fragment=o?o(a.ctx):!1,e.target){if(e.hydrate){rt();let m=st(e.target);a.fragment&&a.fragment.l(m),m.forEach(T)}else a.fragment&&a.fragment.c();e.intro&&B(t.$$.fragment),Wt(t,e.target,e.anchor),ot(),R()}v(_)}var Jt;typeof HTMLElement=="function"&&(Jt=class extends HTMLElement{$$ctor;$$s;$$c;$$cn=!1;$$d={};$$r=!1;$$p_d={};$$l={};$$l_u=new Map;constructor(t,e,n){super(),this.$$ctor=t,this.$$s=e,n&&this.attachShadow({mode:"open"})}addEventListener(t,e,n){if(this.$$l[t]=this.$$l[t]||[],this.$$l[t].push(e),this.$$c){let o=this.$$c.$on(t,e);this.$$l_u.set(e,o)}super.addEventListener(t,e,n)}removeEventListener(t,e,n){if(super.removeEventListener(t,e,n),this.$$c){let o=this.$$l_u.get(e);o&&(o(),this.$$l_u.delete(e))}if(this.$$l[t]){let o=this.$$l[t].indexOf(e);o>=0&&this.$$l[t].splice(o,1)}}async connectedCallback(){if(this.$$cn=!0,!this.$$c){let t=function(r){return()=>{let s;return{c:function(){s=it("slot"),r!=="default"&&U(s,"name",r)},m:function(_,a){H(_,s,a)},d:function(_){_&&T(s)}}}};if(await Promise.resolve(),!this.$$cn||this.$$c)return;let e={},n=ct(this);for(let r of this.$$s)r in n&&(e[r]=[t(r)]);for(let r of this.attributes){let s=this.$$g_p(r.name);s in this.$$d||(this.$$d[s]=K(s,r.value,this.$$p_d,"toProp"))}for(let r in this.$$p_d)!(r in this.$$d)&&this[r]!==void 0&&(this.$$d[r]=this[r],delete this[r]);this.$$c=new this.$$ctor({target:this.shadowRoot||this,props:{...this.$$d,$$slots:e,$$scope:{ctx:[]}}});let o=()=>{this.$$r=!0;for(let r in this.$$p_d)if(this.$$d[r]=this.$$c.$$.ctx[this.$$c.$$.props[r]],this.$$p_d[r].reflect){let s=K(r,this.$$d[r],this.$$p_d,"toAttribute");s==null?this.removeAttribute(this.$$p_d[r].attribute||r):this.setAttribute(this.$$p_d[r].attribute||r,s)}this.$$r=!1};this.$$c.$$.after_update.push(o),o();for(let r in this.$$l)for(let s of this.$$l[r]){let d=this.$$c.$on(r,s);this.$$l_u.set(s,d)}this.$$l={}}}attributeChangedCallback(t,e,n){this.$$r||(t=this.$$g_p(t),this.$$d[t]=K(t,n,this.$$p_d,"toProp"),this.$$c?.$set({[t]:this.$$d[t]}))}disconnectedCallback(){this.$$cn=!1,Promise.resolve().then(()=>{!this.$$cn&&this.$$c&&(this.$$c.$destroy(),this.$$c=void 0)})}$$g_p(t){return Object.keys(this.$$p_d).find(e=>this.$$p_d[e].attribute===t||!this.$$p_d[e].attribute&&e.toLowerCase()===t)||t}});function K(t,e,n,o){let r=n[t]?.type;if(e=r==="Boolean"&&typeof e!="boolean"?e!=null:e,!o||!n[t])return e;if(o==="toAttribute")switch(r){case"Object":case"Array":return e==null?null:JSON.stringify(e);case"Boolean":return e?"":null;case"Number":return e??null;default:return e}else switch(r){case"Object":case"Array":return e&&JSON.parse(e);case"Boolean":return e;case"Number":return e!=null?+e:e;default:return e}}var $=class{$$=void 0;$$set=void 0;$destroy(){Ht(this,1),this.$destroy=S}$on(e,n){if(!j(n))return S;let o=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return o.push(n),()=>{let r=o.indexOf(n);r!==-1&&o.splice(r,1)}}$set(e){this.$$set&&!et(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}};var dt="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(dt);var ir=require("obsidian");var Un=require("obsidian");async function Xt(t){let e=/\[\[([^\]#|^]+)(?:(#)([^\]|]+))?(?:(\^)([^\]|]+))?(?:\|([^\]]+))?\]\]/g,n=t,o;for(;(o=e.exec(t))!==null;){let r=o[0],s=o[1].trim(),d=o[2],h=o[3],_=o[4],a=o[5],x=o[6];if(!/\.(png|jpg|jpeg|gif|svg|bmp|webp)$/i.test(s)){if(d&&h){let m=h.replace(/\s+/g,"-").toLowerCase()+"-comb",g=x||h;n=n.replace(r,`[${g}](#${m})`);continue}if(_&&a){let m=a+"-comb",g=x||a;n=n.replace(r,`[${g}](#${m})`);continue}}}return n}function Kt(t){return t=t.replace(/^(#+)([^\n]*)/gm,(e,n,o)=>`${n}${o}-comb`),t=t.replace(/\^(\w+)$/gm,(e,n)=>`^${n}-comb`),t}function Yt(t,e,n){let{app:o}=e,{basePath:r}=e,{config:s=null}=e,d=new Set,h="";async function _(u){let p=/!\[\[([^\]#|^]+)(?:(#)([^\]|]+))?(?:(\^)([^\]|]+))?(?:\|([^\]]+))?\]\]/g,i=u,c;for(;(c=p.exec(u))!==null;){let l=c[0],f=c[1].trim(),y=c[2],C=c[3],z=c[4],yt=c[5];if(/\.(png|jpg|jpeg|gif|svg|bmp|webp)$/i.test(f)){let b=`%% EMBED IMAGE: ${f} %%
`;i=i.replace(l,b+l);continue}if(!d.has(f)){d.add(f);try{let b=o.metadataCache.getFirstLinkpathDest(f,"");if(b){let D=await o.vault.read(b);(!D||D.trim()==="")&&(D=`<!-- Contenu vide ou non trouv\xE9 pour '${f}' -->`);let F=Kt(D);F=await x(F,b.parent?.path||"");let wt=`%% EMBED START: ${f} %%
`,vt=`
%% EMBED END: ${f} %%`;i=i.replace(l,wt+F+vt)}else i=i.replace(l,`![[${f}]]`)}catch{i=i.replace(l,`![[${f}]]`)}finally{d.delete(f)}}}return i}async function a(u){let p=/!\[\[([^\]#|^]+)(?:(#)([^\]|]+))?(?:\|([^\]]+))?\]\]/g,i=u,c;for(;(c=p.exec(u))!==null;){let l=c[0],f=c[1].trim(),y=c[2],C=c[3],z=c[4];/\.(png|jpg|jpeg|gif|svg|bmp|webp)$/i.test(f)&&(f=f.replace(/\.md$/i,""));try{let b=o.metadataCache.getFirstLinkpathDest(f,"");if(b){let F=`![[${b.path.replace(/\\/g,"/")}`;y&&C&&(F+=`#${C}`),z&&(F+=`|${z}`),F+="]]",i=i.replace(l,F)}else i=i.replace(l,`![[${f}]]`)}catch{i=i.replace(l,`![[${f}]]`)}}return i}async function x(u,p){let i=u;return i=await _(i),i=await Xt(i),i=await a(i),i=i,i}async function m(u){h="Traitement des liens...",d.clear();try{let p=await x(u,r);return h="Traitement termin\xE9",p}catch(p){throw h="Erreur lors du traitement",p}}function g(){d.clear(),h=""}return t.$$set=u=>{"app"in u&&n(0,o=u.app),"basePath"in u&&n(1,r=u.basePath),"config"in u&&n(2,s=u.config)},[o,r,s,m,g]}var Y=class extends ${constructor(e){super(),E(this,e,Yt,null,k,{app:0,basePath:1,config:2,processMarkdown:3,resetState:4})}get processMarkdown(){return this.$$.ctx[3]}get resetState(){return this.$$.ctx[4]}},ht=Y;var _t=require("obsidian");function Qt(t,e,n){let{app:o}=e,{config:r=null}=e,s="";async function d(i,c){let l=1,f=r?.combinedFilePrefix||"",y=r?.combinedFileSuffix||"-combined",C=`${f}${i}${y}.md`;for(;await o.vault.adapter.exists(`${c}/${C}`);)C=`${f}${i}${y}-${l}.md`,l++;return C}function h(){let i=o.workspace.getActiveFile();return!i||i.extension!=="md"||!i.parent?(o.workspace.trigger("notice","Aucun fichier Markdown valide s\xE9lectionn\xE9."),null):i}async function _(i){let c=i.parent?.path||"",l=i.basename,f=await d(l,c),y=`${c}/${f}`;return{originalFile:i,newFileName:f,parentPath:c,fullPath:y}}async function a(i,c){s="Cr\xE9ation du fichier...";try{await o.vault.create(i.fullPath,c),s="Fichier cr\xE9\xE9 avec succ\xE8s";let l=o.vault.getAbstractFileByPath(i.fullPath);if(l&&l instanceof _t.TFile)return l;throw new Error("Impossible de r\xE9cup\xE9rer le fichier cr\xE9\xE9")}catch(l){throw s="Erreur lors de la cr\xE9ation du fichier",l}}async function x(i){if(!(r&&r.openFileAfterCreation===!1))try{await o.workspace.getLeaf("split","vertical").openFile(i),o.workspace.trigger("notice",`Fichier combin\xE9 ouvert : ${i.name}`)}catch(c){o.workspace.trigger("notice",`Erreur lors de l'ouverture du fichier : ${c}`)}}async function m(i){s="Lecture du fichier original...";try{let c=await o.vault.read(i);return s="Fichier lu avec succ\xE8s",c}catch(c){throw s="Erreur lors de la lecture du fichier",c}}async function g(){s="D\xE9but du processus...";let i=h();if(!i)return null;try{let c=await m(i),l=await _(i);return{originalContent:c,fileInfo:l,activeFile:i}}catch(c){let l=c instanceof Error?c.message:String(c);throw o.workspace.trigger("notice",`Erreur : ${l}`),s="Erreur : "+l,c}}async function u(i,c){try{let l=await a(i,c);return await x(l),l}catch(l){let f=l instanceof Error?l.message:String(l);throw o.workspace.trigger("notice",`Erreur lors de la cr\xE9ation du fichier combin\xE9 : ${f}`),l}}function p(){s=""}return t.$$set=i=>{"app"in i&&n(0,o=i.app),"config"in i&&n(1,r=i.config)},[o,r,g,u,p]}var Q=class extends ${constructor(e){super(),E(this,e,Qt,null,k,{app:0,config:1,handleFileCombination:2,finalizeFileCreation:3,resetFileStatus:4})}get handleFileCombination(){return this.$$.ctx[2]}get finalizeFileCreation(){return this.$$.ctx[3]}get resetFileStatus(){return this.$$.ctx[4]}},mt=Q;function gt(t){let e=[];return(t.maxRecursionDepth<1||t.maxRecursionDepth>50)&&e.push("La profondeur de r\xE9cursion doit \xEAtre entre 1 et 50"),t.combinedFileSuffix.length>50&&e.push("Le suffixe du fichier ne peut pas d\xE9passer 50 caract\xE8res"),{isValid:e.length===0,errors:e}}function Zt(t,e,n){let o={processEmbeddedLinks:!0,processInternalLinks:!0,processImages:!0,processExternalLinks:!1,combinedFilePrefix:"",combinedFileSuffix:"-combined",showNotifications:!0,openFileAfterCreation:!0,maxRecursionDepth:10,preserveOriginalLinks:!0},r={...o},s="";async function d(g){s="Chargement de la configuration...";try{let u=await g.loadData();return u?r={...o,...u}:r={...o},s="Configuration charg\xE9e",r}catch(u){return s="Erreur lors du chargement de la configuration",console.error("Erreur de chargement de configuration:",u),o}}async function h(g,u){s="Sauvegarde de la configuration...";try{await g.saveData(u),r={...u},s="Configuration sauvegard\xE9e"}catch(p){throw s="Erreur lors de la sauvegarde de la configuration",console.error("Erreur de sauvegarde de configuration:",p),p}}async function _(g,u){let p={...r,...u};await h(g,p)}async function a(g){await h(g,o)}function x(){return{...r}}function m(){s=""}return[d,h,_,a,x,gt,m]}var Z=class extends ${constructor(e){super(),E(this,e,Zt,null,k,{loadConfig:0,saveConfig:1,updateConfig:2,resetConfig:3,getCurrentConfig:4,validateConfig:5,resetConfigStatus:6})}get loadConfig(){return this.$$.ctx[0]}get saveConfig(){return this.$$.ctx[1]}get updateConfig(){return this.$$.ctx[2]}get resetConfig(){return this.$$.ctx[3]}get getCurrentConfig(){return this.$$.ctx[4]}get validateConfig(){return gt}get resetConfigStatus(){return this.$$.ctx[6]}},xt=Z;function te(t,e,n){let{plugin:o}=e,r,s,d,h=!1,_="Pr\xEAt",a=null;async function x(){d=new xt({target:document.createElement("div"),props:{}}),a=await d.loadConfig(o)}async function m(){if(h)return;let{app:p}=o;h=!0,_="Initialisation...";try{await x(),r=new ht({target:document.createElement("div"),props:{app:p,basePath:"",config:a}}),s=new mt({target:document.createElement("div"),props:{app:p,config:a}});let i=await s.handleFileCombination();if(!i){_="Aucun fichier valide s\xE9lectionn\xE9";return}let{originalContent:c,fileInfo:l,activeFile:f}=i;r.$set({basePath:l.parentPath}),_="Traitement du contenu...";let y=await r.processMarkdown(c);_="Cr\xE9ation du fichier final...",await s.finalizeFileCreation(l,y),_="Termin\xE9 avec succ\xE8s !",a.showNotifications&&p.workspace.trigger("notice",`Fichier combin\xE9 cr\xE9\xE9 : ${l.newFileName}`)}catch(i){let c=i instanceof Error?i.message:String(i);a?.showNotifications&&p.workspace.trigger("notice",`Erreur lors de la combinaison : ${c}`),_="Erreur : "+c}finally{h=!1,r&&r.$destroy(),s&&s.$destroy(),d&&d.$destroy()}}function g(){h=!1,_="Pr\xEAt",r&&r.resetState(),s&&s.resetFileStatus(),d&&d.resetConfigStatus()}function u(){return a}return t.$$set=p=>{"plugin"in p&&n(0,o=p.plugin)},[o,m,g,u]}var tt=class extends ${constructor(e){super(),E(this,e,te,null,k,{plugin:0,combineFiles:1,resetState:2,getConfig:3})}get combineFiles(){return this.$$.ctx[1]}get resetState(){return this.$$.ctx[2]}get getConfig(){return this.$$.ctx[3]}},$t=tt;var q=class extends bt.Plugin{appView=null;async onload(){this.addCommand({id:"combine-markdown-files",name:"Combiner les fichiers Markdown avec les embeds",callback:()=>this.combineMarkdownFiles()}),this.addRibbonIcon("link","Combiner les fichiers Markdown",()=>{this.combineMarkdownFiles()}),this.appView=new $t({target:document.createElement("div"),props:{plugin:this}})}async combineMarkdownFiles(){this.appView&&await this.appView.combineFiles()}onunload(){this.appView?.$destroy(),this.appView=null}};

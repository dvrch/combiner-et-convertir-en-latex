/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

"use strict";var st=Object.defineProperty;var Bt=Object.getOwnPropertyDescriptor;var qt=Object.getOwnPropertyNames;var zt=Object.prototype.hasOwnProperty;var Wt=(e,t)=>{for(var r in t)st(e,r,{get:t[r],enumerable:!0})},Gt=(e,t,r,o)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of qt(t))!zt.call(e,n)&&n!==r&&st(e,n,{get:()=>t[n],enumerable:!(o=Bt(t,n))||o.enumerable});return e};var Vt=e=>Gt(st({},"__esModule",{value:!0}),e);var me={};Wt(me,{default:()=>rt});module.exports=Vt(me);var jt=require("obsidian");function q(){}function ct(e){return e()}function Q(){return Object.create(null)}function N(e){e.forEach(ct)}function Z(e){return typeof e=="function"}function j(e,t){return e!=e?t==t:e!==t||e&&typeof e=="object"||typeof e=="function"}function $t(e){return Object.keys(e).length===0}var lt=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;var tt=class e{_listeners="WeakMap"in lt?new WeakMap:void 0;_observer=void 0;options;constructor(t){this.options=t}observe(t,r){return this._listeners.set(t,r),this._getObserver().observe(t,this.options),()=>{this._listeners.delete(t),this._observer.unobserve(t)}}_getObserver(){return this._observer??(this._observer=new ResizeObserver(t=>{for(let r of t)e.entries.set(r.target,r),this._listeners.get(r.target)?.(r)}))}};tt.entries="WeakMap"in lt?new WeakMap:void 0;var bt=!1;function yt(){bt=!0}function wt(){bt=!1}function at(e,t,r){e.insertBefore(t,r||null)}function J(e){e.parentNode&&e.parentNode.removeChild(e)}function Ft(e){return document.createElement(e)}function ut(e,t,r){r==null?e.removeAttribute(t):e.getAttribute(t)!==r&&e.setAttribute(t,r)}function vt(e){return Array.from(e.childNodes)}function kt(e){let t={};return e.childNodes.forEach(r=>{t[r.slot||"default"]=!0}),t}var W;function T(e){W=e}var z=[];var Ct=[],V=[],St=[],Zt=Promise.resolve(),pt=!1;function Mt(){pt||(pt=!0,Zt.then(et))}function X(e){V.push(e)}var ft=new Set,G=0;function et(){if(G!==0)return;let e=W;do{try{for(;G<z.length;){let t=z[G];G++,T(t),te(t.$$)}}catch(t){throw z.length=0,G=0,t}for(T(null),z.length=0,G=0;Ct.length;)Ct.pop()();for(let t=0;t<V.length;t+=1){let r=V[t];ft.has(r)||(ft.add(r),r())}V.length=0}while(z.length);for(;St.length;)St.pop()();pt=!1,ft.clear(),T(e)}function te(e){if(e.fragment!==null){e.update(),N(e.before_update);let t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(X)}}function Lt(e){let t=[],r=[];V.forEach(o=>e.indexOf(o)===-1?t.push(o):r.push(o)),r.forEach(o=>o()),V=t}var ee=new Set;function nt(e,t){e&&e.i&&(ee.delete(e),e.i(t))}var re=["allowfullscreen","allowpaymentrequest","async","autofocus","autoplay","checked","controls","default","defer","disabled","formnovalidate","hidden","inert","ismap","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","selected"],oe=new Set([...re]);function ce(e,t,r){let{fragment:o,after_update:n}=e.$$;o&&o.m(t,r),X(()=>{let i=e.$$.on_mount.map(ct).filter(Z);e.$$.on_destroy?e.$$.on_destroy.push(...i):N(i),e.$$.on_mount=[]}),n.forEach(X)}function le(e,t){let r=e.$$;r.fragment!==null&&(Lt(r.after_update),N(r.on_destroy),r.fragment&&r.fragment.d(t),r.on_destroy=r.fragment=null,r.ctx=[])}function ae(e,t){e.$$.dirty[0]===-1&&(z.push(e),Mt(),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function R(e,t,r,o,n,i,_=null,m=[-1]){let d=W;T(e);let c=e.$$={fragment:null,ctx:[],props:i,update:q,not_equal:n,bound:Q(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(d?d.$$.context:[])),callbacks:Q(),dirty:m,skip_bound:!1,root:t.target||d.$$.root};_&&_(c.root);let M=!1;if(c.ctx=r?r(e,t.props||{},(y,v,...$)=>{let g=$.length?$[0]:v;return c.ctx&&n(c.ctx[y],c.ctx[y]=g)&&(!c.skip_bound&&c.bound[y]&&c.bound[y](g),M&&ae(e,y)),v}):[],c.update(),M=!0,N(c.before_update),c.fragment=o?o(c.ctx):!1,t.target){if(t.hydrate){yt();let y=vt(t.target);c.fragment&&c.fragment.l(y),y.forEach(J)}else c.fragment&&c.fragment.c();t.intro&&nt(e.$$.fragment),ce(e,t.target,t.anchor),wt(),et()}T(d)}var ue;typeof HTMLElement=="function"&&(ue=class extends HTMLElement{$$ctor;$$s;$$c;$$cn=!1;$$d={};$$r=!1;$$p_d={};$$l={};$$l_u=new Map;constructor(e,t,r){super(),this.$$ctor=e,this.$$s=t,r&&this.attachShadow({mode:"open"})}addEventListener(e,t,r){if(this.$$l[e]=this.$$l[e]||[],this.$$l[e].push(t),this.$$c){let o=this.$$c.$on(e,t);this.$$l_u.set(t,o)}super.addEventListener(e,t,r)}removeEventListener(e,t,r){if(super.removeEventListener(e,t,r),this.$$c){let o=this.$$l_u.get(t);o&&(o(),this.$$l_u.delete(t))}if(this.$$l[e]){let o=this.$$l[e].indexOf(t);o>=0&&this.$$l[e].splice(o,1)}}async connectedCallback(){if(this.$$cn=!0,!this.$$c){let e=function(n){return()=>{let i;return{c:function(){i=Ft("slot"),n!=="default"&&ut(i,"name",n)},m:function(d,c){at(d,i,c)},d:function(d){d&&J(i)}}}};if(await Promise.resolve(),!this.$$cn||this.$$c)return;let t={},r=kt(this);for(let n of this.$$s)n in r&&(t[n]=[e(n)]);for(let n of this.attributes){let i=this.$$g_p(n.name);i in this.$$d||(this.$$d[i]=dt(i,n.value,this.$$p_d,"toProp"))}for(let n in this.$$p_d)!(n in this.$$d)&&this[n]!==void 0&&(this.$$d[n]=this[n],delete this[n]);this.$$c=new this.$$ctor({target:this.shadowRoot||this,props:{...this.$$d,$$slots:t,$$scope:{ctx:[]}}});let o=()=>{this.$$r=!0;for(let n in this.$$p_d)if(this.$$d[n]=this.$$c.$$.ctx[this.$$c.$$.props[n]],this.$$p_d[n].reflect){let i=dt(n,this.$$d[n],this.$$p_d,"toAttribute");i==null?this.removeAttribute(this.$$p_d[n].attribute||n):this.setAttribute(this.$$p_d[n].attribute||n,i)}this.$$r=!1};this.$$c.$$.after_update.push(o),o();for(let n in this.$$l)for(let i of this.$$l[n]){let _=this.$$c.$on(n,i);this.$$l_u.set(i,_)}this.$$l={}}}attributeChangedCallback(e,t,r){this.$$r||(e=this.$$g_p(e),this.$$d[e]=dt(e,r,this.$$p_d,"toProp"),this.$$c?.$set({[e]:this.$$d[e]}))}disconnectedCallback(){this.$$cn=!1,Promise.resolve().then(()=>{!this.$$cn&&this.$$c&&(this.$$c.$destroy(),this.$$c=void 0)})}$$g_p(e){return Object.keys(this.$$p_d).find(t=>this.$$p_d[t].attribute===e||!this.$$p_d[t].attribute&&t.toLowerCase()===e)||e}});function dt(e,t,r,o){let n=r[e]?.type;if(t=n==="Boolean"&&typeof t!="boolean"?t!=null:t,!o||!r[e])return t;if(o==="toAttribute")switch(n){case"Object":case"Array":return t==null?null:JSON.stringify(t);case"Boolean":return t?"":null;case"Number":return t??null;default:return t}else switch(n){case"Object":case"Array":return t&&JSON.parse(t);case"Boolean":return t;case"Number":return t!=null?+t:t;default:return t}}var L=class{$$=void 0;$$set=void 0;$destroy(){le(this,1),this.$destroy=q}$on(t,r){if(!Z(r))return q;let o=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return o.push(r),()=>{let n=o.indexOf(r);n!==-1&&o.splice(n,1)}}$set(t){this.$$set&&!$t(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}};var At="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(At);var $r=require("obsidian");var cr=require("obsidian");function fe(e,t,r){let{app:o}=t,{basePath:n}=t,{config:i=null}=t,{combinedFileName:_=""}=t,m=new Set,d="",c=new Set,M={},y=new Set;function v(f,w){let l=[],h=[],b=w.split(`
`);for(let p of b){let B=p.match(/^(#+)\s*(.*)$/);if(B){let k=B[2].trim().replace(/_/g,"-").replace(/\s+/g,"-").toLowerCase();l.push(k)}let D=p.match(/\^([\w-]+)$/);D&&h.push(D[1])}M[f.toLowerCase()]={file:f,sections:l,blocks:h}}async function $(f){let w=/!\[\[([^\]#|^]+)(?:(#)([^\]|]+))?(?:(\^)([^\]|]+))?(?:\|([^\]]+))?\]\]/g,l=f,h;for(;(h=w.exec(f))!==null;){let b=h[0],p=h[1].trim(),B=h[2],D=h[3],k=h[4],C=h[5];if(/\.(png|jpg|jpeg|gif|svg|bmp|webp)$/i.test(p)){let x=`%% EMBED IMAGE: ${p} %%
`;l=l.replace(b,x+b);continue}if(!m.has(p)){m.add(p),c.add(p.toLowerCase());try{let x=o.metadataCache.getFirstLinkpathDest(p,"");if(x){let I=await o.vault.read(x);(!I||I.trim()==="")&&(I=`<!-- Contenu vide ou non trouv\xE9 pour '${p}' -->`);let E=I;v(p,E),E=await a(E,x.parent?.path||"");let F=`^${p.replace(/_/g,"-")}`,K=`%% EMBED START: [${p}] %% ${F}
`,H=`
%% EMBED END: ${p} %%`;l=l.replace(b,K+E+H)}else l=l.replace(b,`![[${p}]]`)}catch{l=l.replace(b,`![[${p}]]`)}finally{m.delete(p)}}}return l}async function g(f){let w=/\[\[([^\]#|^/]+)(?:(#)([^\]|]+))?(?:(\^)([^\]|]+))?(?:\|([^\]]+))?\]\]/g,h=f.split(`
`),b=!1,p=-1,B=[];for(let k=0;k<h.length;k++)/^(```|~~~)/.test(h[k].trim())&&(b?(b=!1,B.push({start:p,end:k})):(b=!0,p=k));let D=[];for(let k=0;k<h.length;k++){let C=h[k],x,I=!1;for(;(x=w.exec(C))!==null;){let E=x[0],F=x[1].trim(),K=x[2],H=x[3],xt=x[4],Y=x[5],U=x[6];if(/\.(png|jpg|jpeg|gif|svg|bmp|webp)$/i.test(F))continue;let ot=M[F.toLowerCase()];if(ot){if(!K&&!xt){let S=`^${F.replace(/_/g,"-")}`,O=U||F;C=C.replace(E,`[[#${S}|${O}]]`);continue}if(K&&H){let S=H.replace(/_/g,"-").replace(/\s+/g,"-").toLowerCase();if(ot.sections.includes(S)){let O=U||H;C=C.replace(E,`[[#${S}|${O}]]`);continue}}if(xt&&Y){let S="^"+Y.replace(/_/g,"-");if(ot.blocks.includes(Y.replace(/_/g,"-"))){let O=U||Y;C=C.replace(E,`[[#${S}|${O}]]`);continue}}}if(!c.has(F.toLowerCase())&&!y.has(F.toLowerCase()))try{let S=o.metadataCache.getFirstLinkpathDest(F,"");if(S){let O=await o.vault.read(S);(!O||O.trim()==="")&&(O=`<!-- Contenu vide ou non trouv\xE9 pour '${F}' -->`);let Rt=`%%
%% EMBED HIDDEN START: [[${F}]] %%
${O}
%% EMBED HIDDEN END %%
%%`;D.push(Rt),I=!0,y.add(F.toLowerCase())}}catch{}let it=o.metadataCache.getFirstLinkpathDest(F,"");if(it&&!it.path.startsWith("http")&&!it.path.startsWith("/")){let S=U||F;C=C.replace(E,`[[${F}|${S}]]`)}else{let S=U||F;C=C.replace(E,`[[${F}|${S}]]`)}}if(I)break;w.lastIndex=0,D.push(C)}return D.join(`
`)}async function s(f){let w=/!\[\[([^\]#|^]+)(?:(#)([^\]|]+))?(?:\|([^\]]+))?\]\]/g,l=f,h;for(;(h=w.exec(f))!==null;){let b=h[0],p=h[1].trim(),B=h[2],D=h[3],k=h[4];/\.(png|jpg|jpeg|gif|svg|bmp|webp)$/i.test(p)&&(p=p.replace(/\.md$/i,""));try{let x=o.metadataCache.getFirstLinkpathDest(p,"");if(x){let E=`![[${x.path.replace(/\\/g,"/")}`;B&&D&&(E+=`#${D}`),k&&(E+=`|${k}`),E+="]]",l=l.replace(b,E)}else l=l.replace(b,`![[${p}]]`)}catch{l=l.replace(b,`![[${p}]]`)}}return l}async function a(f,w){let l=f;return l=await $(l),l=await g(l),l=await s(l),l=l,l}function u(f){return f.replace(/\[\[([^\]#|^/]+)#\^([\w-]+)(?:\|([^\]]+))?\]\]/g,(w,l,h,b)=>c.has(l.toLowerCase())?b?`[[#^${h}|${b}]]`:`[[#^${h}]]`:w)}async function A(f){d="Traitement des liens...",m.clear();try{let w=await a(f,n);return w=u(w),d="Traitement termin\xE9",w}catch(w){throw d="Erreur lors du traitement",w}}function P(){m.clear(),d=""}return e.$$set=f=>{"app"in f&&r(0,o=f.app),"basePath"in f&&r(1,n=f.basePath),"config"in f&&r(2,i=f.config),"combinedFileName"in f&&r(3,_=f.combinedFileName)},[o,n,i,_,A,P]}var ht=class extends L{constructor(t){super(),R(this,t,fe,null,j,{app:0,basePath:1,config:2,combinedFileName:3,processMarkdown:4,resetState:5})}get processMarkdown(){return this.$$.ctx[4]}get resetState(){return this.$$.ctx[5]}},Dt=ht;var Ot=require("obsidian");function pe(e,t,r){let{app:o}=t,{config:n=null}=t,i="";async function _(s,a){let u=1,A=n?.combinedFilePrefix||"",P=n?.combinedFileSuffix||"-combined",f=`${A}${s}${P}.md`;for(;await o.vault.adapter.exists(`${a}/${f}`);)f=`${A}${s}${P}-${u}.md`,u++;return f}function m(){let s=o.workspace.getActiveFile();return!s||s.extension!=="md"||!s.parent?(o.workspace.trigger("notice","Aucun fichier Markdown valide s\xE9lectionn\xE9."),null):s}async function d(s){let a=s.parent?.path||"",u=s.basename,A=await _(u,a),P=`${a}/${A}`;return{originalFile:s,newFileName:A,parentPath:a,fullPath:P}}async function c(s,a){i="Cr\xE9ation du fichier...";try{await o.vault.create(s.fullPath,a),i="Fichier cr\xE9\xE9 avec succ\xE8s";let u=o.vault.getAbstractFileByPath(s.fullPath);if(u&&u instanceof Ot.TFile)return u;throw new Error("Impossible de r\xE9cup\xE9rer le fichier cr\xE9\xE9")}catch(u){throw i="Erreur lors de la cr\xE9ation du fichier",u}}async function M(s){if(!(n&&n.openFileAfterCreation===!1))try{await o.workspace.getLeaf("split","vertical").openFile(s),o.workspace.trigger("notice",`Fichier combin\xE9 ouvert : ${s.name}`)}catch(a){o.workspace.trigger("notice",`Erreur lors de l'ouverture du fichier : ${a}`)}}async function y(s){i="Lecture du fichier original...";try{let a=await o.vault.read(s);return i="Fichier lu avec succ\xE8s",a}catch(a){throw i="Erreur lors de la lecture du fichier",a}}async function v(){i="D\xE9but du processus...";let s=m();if(!s)return null;try{let a=await y(s),u=await d(s);return{originalContent:a,fileInfo:u,activeFile:s}}catch(a){let u=a instanceof Error?a.message:String(a);throw o.workspace.trigger("notice",`Erreur : ${u}`),i="Erreur : "+u,a}}async function $(s,a){try{let u=await c(s,a);return await M(u),u}catch(u){let A=u instanceof Error?u.message:String(u);throw o.workspace.trigger("notice",`Erreur lors de la cr\xE9ation du fichier combin\xE9 : ${A}`),u}}function g(){i=""}return e.$$set=s=>{"app"in s&&r(0,o=s.app),"config"in s&&r(1,n=s.config)},[o,n,v,$,g]}var mt=class extends L{constructor(t){super(),R(this,t,pe,null,j,{app:0,config:1,handleFileCombination:2,finalizeFileCreation:3,resetFileStatus:4})}get handleFileCombination(){return this.$$.ctx[2]}get finalizeFileCreation(){return this.$$.ctx[3]}get resetFileStatus(){return this.$$.ctx[4]}},Nt=mt;function Tt(e){let t=[];return(e.maxRecursionDepth<1||e.maxRecursionDepth>50)&&t.push("La profondeur de r\xE9cursion doit \xEAtre entre 1 et 50"),e.combinedFileSuffix.length>50&&t.push("Le suffixe du fichier ne peut pas d\xE9passer 50 caract\xE8res"),{isValid:t.length===0,errors:t}}function de(e,t,r){let o={processEmbeddedLinks:!0,processInternalLinks:!0,processImages:!0,processExternalLinks:!1,combinedFilePrefix:"",combinedFileSuffix:"-combined",showNotifications:!0,openFileAfterCreation:!0,maxRecursionDepth:10,preserveOriginalLinks:!0},n={...o},i="";async function _(v){i="Chargement de la configuration...";try{let $=await v.loadData();return $?n={...o,...$}:n={...o},i="Configuration charg\xE9e",n}catch($){return i="Erreur lors du chargement de la configuration",console.error("Erreur de chargement de configuration:",$),o}}async function m(v,$){i="Sauvegarde de la configuration...";try{await v.saveData($),n={...$},i="Configuration sauvegard\xE9e"}catch(g){throw i="Erreur lors de la sauvegarde de la configuration",console.error("Erreur de sauvegarde de configuration:",g),g}}async function d(v,$){let g={...n,...$};await m(v,g)}async function c(v){await m(v,o)}function M(){return{...n}}function y(){i=""}return[_,m,d,c,M,Tt,y]}var _t=class extends L{constructor(t){super(),R(this,t,de,null,j,{loadConfig:0,saveConfig:1,updateConfig:2,resetConfig:3,getCurrentConfig:4,validateConfig:5,resetConfigStatus:6})}get loadConfig(){return this.$$.ctx[0]}get saveConfig(){return this.$$.ctx[1]}get updateConfig(){return this.$$.ctx[2]}get resetConfig(){return this.$$.ctx[3]}get getCurrentConfig(){return this.$$.ctx[4]}get validateConfig(){return Tt}get resetConfigStatus(){return this.$$.ctx[6]}},Pt=_t;function he(e,t,r){let{plugin:o}=t,n,i,_,m=!1,d="Pr\xEAt",c=null;async function M(){_=new Pt({target:document.createElement("div"),props:{}}),c=await _.loadConfig(o)}async function y(){if(m)return;let{app:g}=o;m=!0,d="Initialisation...";try{await M(),n=new Dt({target:document.createElement("div"),props:{app:g,basePath:"",config:c}}),i=new Nt({target:document.createElement("div"),props:{app:g,config:c}});let s=await i.handleFileCombination();if(!s){d="Aucun fichier valide s\xE9lectionn\xE9";return}let{originalContent:a,fileInfo:u,activeFile:A}=s;n.$set({basePath:u.parentPath}),d="Traitement du contenu...";let P=await n.processMarkdown(a);d="Cr\xE9ation du fichier final...",await i.finalizeFileCreation(u,P),d="Termin\xE9 avec succ\xE8s !",c.showNotifications&&g.workspace.trigger("notice",`Fichier combin\xE9 cr\xE9\xE9 : ${u.newFileName}`)}catch(s){let a=s instanceof Error?s.message:String(s);c?.showNotifications&&g.workspace.trigger("notice",`Erreur lors de la combinaison : ${a}`),d="Erreur : "+a}finally{m=!1,n&&n.$destroy(),i&&i.$destroy(),_&&_.$destroy()}}function v(){m=!1,d="Pr\xEAt",n&&n.resetState(),i&&i.resetFileStatus(),_&&_.resetConfigStatus()}function $(){return c}return e.$$set=g=>{"plugin"in g&&r(0,o=g.plugin)},[o,y,v,$]}var gt=class extends L{constructor(t){super(),R(this,t,he,null,j,{plugin:0,combineFiles:1,resetState:2,getConfig:3})}get combineFiles(){return this.$$.ctx[1]}get resetState(){return this.$$.ctx[2]}get getConfig(){return this.$$.ctx[3]}},It=gt;var rt=class extends jt.Plugin{appView=null;async onload(){this.addCommand({id:"combine-markdown-files",name:"Combiner les fichiers Markdown avec les embeds",callback:()=>this.combineMarkdownFiles()}),this.addRibbonIcon("link","Combiner les fichiers Markdown",()=>{this.combineMarkdownFiles()}),this.appView=new It({target:document.createElement("div"),props:{plugin:this}})}async combineMarkdownFiles(){this.appView&&await this.appView.combineFiles()}onunload(){this.appView?.$destroy(),this.appView=null}};

/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

"use strict";var W=Object.defineProperty;var vt=Object.getOwnPropertyDescriptor;var Ft=Object.getOwnPropertyNames;var kt=Object.prototype.hasOwnProperty;var Et=(e,t)=>{for(var r in t)W(e,r,{get:t[r],enumerable:!0})},Ct=(e,t,r,o)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of Ft(t))!kt.call(e,n)&&n!==r&&W(e,n,{get:()=>t[n],enumerable:!(o=vt(t,n))||o.enumerable});return e};var St=e=>Ct(W({},"__esModule",{value:!0}),e);var Qt={};Et(Qt,{default:()=>G});module.exports=St(Qt);var wt=require("obsidian");function M(){}function H(e){return e()}function R(){return Object.create(null)}function F(e){e.forEach(H)}function q(e){return typeof e=="function"}function C(e,t){return e!=e?t==t:e!==t||e&&typeof e=="object"||typeof e=="function"}function rt(e){return Object.keys(e).length===0}var U=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;var B=class e{_listeners="WeakMap"in U?new WeakMap:void 0;_observer=void 0;options;constructor(t){this.options=t}observe(t,r){return this._listeners.set(t,r),this._getObserver().observe(t,this.options),()=>{this._listeners.delete(t),this._observer.unobserve(t)}}_getObserver(){return this._observer??(this._observer=new ResizeObserver(t=>{for(let r of t)e.entries.set(r.target,r),this._listeners.get(r.target)?.(r)}))}};B.entries="WeakMap"in U?new WeakMap:void 0;var ot=!1;function it(){ot=!0}function st(){ot=!1}function J(e,t,r){e.insertBefore(t,r||null)}function T(e){e.parentNode&&e.parentNode.removeChild(e)}function ct(e){return document.createElement(e)}function X(e,t,r){r==null?e.removeAttribute(t):e.getAttribute(t)!==r&&e.setAttribute(t,r)}function lt(e){return Array.from(e.childNodes)}function at(e){let t={};return e.childNodes.forEach(r=>{t[r.slot||"default"]=!0}),t}var P;function k(e){P=e}var O=[];var ft=[],D=[],pt=[],Tt=Promise.resolve(),Y=!1;function dt(){Y||(Y=!0,Tt.then(z))}function j(e){D.push(e)}var K=new Set,L=0;function z(){if(L!==0)return;let e=P;do{try{for(;L<O.length;){let t=O[L];L++,k(t),jt(t.$$)}}catch(t){throw O.length=0,L=0,t}for(k(null),O.length=0,L=0;ft.length;)ft.pop()();for(let t=0;t<D.length;t+=1){let r=D[t];K.has(r)||(K.add(r),r())}D.length=0}while(O.length);for(;pt.length;)pt.pop()();Y=!1,K.clear(),k(e)}function jt(e){if(e.fragment!==null){e.update(),F(e.before_update);let t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(j)}}function ht(e){let t=[],r=[];D.forEach(o=>e.indexOf(o)===-1?t.push(o):r.push(o)),r.forEach(o=>o()),D=t}var It=new Set;function V(e,t){e&&e.i&&(It.delete(e),e.i(t))}var qt=["allowfullscreen","allowpaymentrequest","async","autofocus","autoplay","checked","controls","default","defer","disabled","formnovalidate","hidden","inert","ismap","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","selected"],Bt=new Set([...qt]);function Gt(e,t,r){let{fragment:o,after_update:n}=e.$$;o&&o.m(t,r),j(()=>{let l=e.$$.on_mount.map(H).filter(q);e.$$.on_destroy?e.$$.on_destroy.push(...l):F(l),e.$$.on_mount=[]}),n.forEach(j)}function Wt(e,t){let r=e.$$;r.fragment!==null&&(ht(r.after_update),F(r.on_destroy),r.fragment&&r.fragment.d(t),r.on_destroy=r.fragment=null,r.ctx=[])}function Ht(e,t){e.$$.dirty[0]===-1&&(O.push(e),dt(),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function S(e,t,r,o,n,l,p=null,_=[-1]){let d=P;k(e);let u=e.$$={fragment:null,ctx:[],props:l,update:M,not_equal:n,bound:R(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(d?d.$$.context:[])),callbacks:R(),dirty:_,skip_bound:!1,root:t.target||d.$$.root};p&&p(u.root);let w=!1;if(u.ctx=r?r(e,t.props||{},(g,x,...m)=>{let a=m.length?m[0]:x;return u.ctx&&n(u.ctx[g],u.ctx[g]=a)&&(!u.skip_bound&&u.bound[g]&&u.bound[g](a),w&&Ht(e,g)),x}):[],u.update(),w=!0,F(u.before_update),u.fragment=o?o(u.ctx):!1,t.target){if(t.hydrate){it();let g=lt(t.target);u.fragment&&u.fragment.l(g),g.forEach(T)}else u.fragment&&u.fragment.c();t.intro&&V(e.$$.fragment),Gt(e,t.target,t.anchor),st(),z()}k(d)}var Ut;typeof HTMLElement=="function"&&(Ut=class extends HTMLElement{$$ctor;$$s;$$c;$$cn=!1;$$d={};$$r=!1;$$p_d={};$$l={};$$l_u=new Map;constructor(e,t,r){super(),this.$$ctor=e,this.$$s=t,r&&this.attachShadow({mode:"open"})}addEventListener(e,t,r){if(this.$$l[e]=this.$$l[e]||[],this.$$l[e].push(t),this.$$c){let o=this.$$c.$on(e,t);this.$$l_u.set(t,o)}super.addEventListener(e,t,r)}removeEventListener(e,t,r){if(super.removeEventListener(e,t,r),this.$$c){let o=this.$$l_u.get(t);o&&(o(),this.$$l_u.delete(t))}if(this.$$l[e]){let o=this.$$l[e].indexOf(t);o>=0&&this.$$l[e].splice(o,1)}}async connectedCallback(){if(this.$$cn=!0,!this.$$c){let e=function(n){return()=>{let l;return{c:function(){l=ct("slot"),n!=="default"&&X(l,"name",n)},m:function(d,u){J(d,l,u)},d:function(d){d&&T(l)}}}};if(await Promise.resolve(),!this.$$cn||this.$$c)return;let t={},r=at(this);for(let n of this.$$s)n in r&&(t[n]=[e(n)]);for(let n of this.attributes){let l=this.$$g_p(n.name);l in this.$$d||(this.$$d[l]=Q(l,n.value,this.$$p_d,"toProp"))}for(let n in this.$$p_d)!(n in this.$$d)&&this[n]!==void 0&&(this.$$d[n]=this[n],delete this[n]);this.$$c=new this.$$ctor({target:this.shadowRoot||this,props:{...this.$$d,$$slots:t,$$scope:{ctx:[]}}});let o=()=>{this.$$r=!0;for(let n in this.$$p_d)if(this.$$d[n]=this.$$c.$$.ctx[this.$$c.$$.props[n]],this.$$p_d[n].reflect){let l=Q(n,this.$$d[n],this.$$p_d,"toAttribute");l==null?this.removeAttribute(this.$$p_d[n].attribute||n):this.setAttribute(this.$$p_d[n].attribute||n,l)}this.$$r=!1};this.$$c.$$.after_update.push(o),o();for(let n in this.$$l)for(let l of this.$$l[n]){let p=this.$$c.$on(n,l);this.$$l_u.set(l,p)}this.$$l={}}}attributeChangedCallback(e,t,r){this.$$r||(e=this.$$g_p(e),this.$$d[e]=Q(e,r,this.$$p_d,"toProp"),this.$$c?.$set({[e]:this.$$d[e]}))}disconnectedCallback(){this.$$cn=!1,Promise.resolve().then(()=>{!this.$$cn&&this.$$c&&(this.$$c.$destroy(),this.$$c=void 0)})}$$g_p(e){return Object.keys(this.$$p_d).find(t=>this.$$p_d[t].attribute===e||!this.$$p_d[t].attribute&&t.toLowerCase()===e)||e}});function Q(e,t,r,o){let n=r[e]?.type;if(t=n==="Boolean"&&typeof t!="boolean"?t!=null:t,!o||!r[e])return t;if(o==="toAttribute")switch(n){case"Object":case"Array":return t==null?null:JSON.stringify(t);case"Boolean":return t?"":null;case"Number":return t??null;default:return t}else switch(n){case"Object":case"Array":return t&&JSON.parse(t);case"Boolean":return t;case"Number":return t!=null?+t:t;default:return t}}var b=class{$$=void 0;$$set=void 0;$destroy(){Wt(this,1),this.$destroy=M}$on(t,r){if(!q(r))return M;let o=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return o.push(r),()=>{let n=o.indexOf(r);n!==-1&&o.splice(n,1)}}$set(t){this.$$set&&!rt(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}};var _t="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(_t);var nr=require("obsidian");var Gn=require("obsidian");function Jt(e,t,r){let{app:o}=t,{basePath:n}=t,{config:l=null}=t,p=new Set,_="";async function d(a){let c=/!\[\[([^\]#|^]+)(?:(#)([^\]|]+))?(?:(\^)([^\]|]+))?(?:\|([^\]]+))?\]\]/g,i=a,s;for(;(s=c.exec(a))!==null;){let h=s[0],f=s[1].trim(),E=s[2],A=s[3],N=s[4],I=s[5];if(!/\.(png|jpg|jpeg|gif|svg|bmp|webp)$/i.test(f)&&!p.has(f)){p.add(f);try{let y=o.metadataCache.getFirstLinkpathDest(f,"");if(y){let v=await o.vault.read(y);(!v||v.trim()==="")&&(v=`<!-- Contenu vide ou non trouv\xE9 pour '${f}' -->`);let $=v;$=await g(v,y.parent?.path||""),i=i.replace(h,$)}else i=i.replace(h,`![[${f}]]`)}catch{i=i.replace(h,`![[${f}]]`)}finally{p.delete(f)}}}return i}async function u(a){let c=/\[\[([^\]#|^]+)(?:(#)([^\]|]+))?(?:(\^)([^\]|]+))?(?:\|([^\]]+))?\]\]/g,i=a,s;for(;(s=c.exec(a))!==null;){let h=s[0],f=s[1].trim(),E=s[2],A=s[3],N=s[4],I=s[5],y=s[6];if(!/\.(png|jpg|jpeg|gif|svg|bmp|webp)$/i.test(f))try{let v=o.metadataCache.getFirstLinkpathDest(f,"");if(v){let $=`[[${v.basename}`;E&&A?$+=`#${A}`:N&&I&&($+=`^${I}`),y&&($+=`|${y}`),$+="]]",i=i.replace(h,$)}else i=i.replace(h,`<!-- Link not found: ${f} -->${h}`)}catch{i=i.replace(h,`<!-- Error processing link: ${f} -->${h}`)}}return i}async function w(a){let c=/!\[\[([^\]#|^]+)(?:(#)([^\]|]+))?(?:\|([^\]]+))?\]\]/g,i=a,s;for(;(s=c.exec(a))!==null;){let h=s[0],f=s[1].trim(),E=s[2],A=s[3],N=s[4];/\.(png|jpg|jpeg|gif|svg|bmp|webp)$/i.test(f)&&(f=f.replace(/\.md$/i,""));try{let y=o.metadataCache.getFirstLinkpathDest(f,"");if(y){let $=`![[${y.path.replace(/\\/g,"/")}`;E&&A&&($+=`#${A}`),N&&($+=`|${N}`),$+="]]",i=i.replace(h,$)}else i=i.replace(h,`![[${f}]]`)}catch{i=i.replace(h,`![[${f}]]`)}}return i}async function g(a,c){let i=a;return i=await d(i),i=await u(i),i=await w(i),i=i,i}async function x(a){_="Traitement des liens...",p.clear();try{let c=await g(a,n);return _="Traitement termin\xE9",c}catch(c){throw _="Erreur lors du traitement",c}}function m(){p.clear(),_=""}return e.$$set=a=>{"app"in a&&r(0,o=a.app),"basePath"in a&&r(1,n=a.basePath),"config"in a&&r(2,l=a.config)},[o,n,l,x,m]}var Z=class extends b{constructor(t){super(),S(this,t,Jt,null,C,{app:0,basePath:1,config:2,processMarkdown:3,resetState:4})}get processMarkdown(){return this.$$.ctx[3]}get resetState(){return this.$$.ctx[4]}},mt=Z;var gt=require("obsidian");function Xt(e,t,r){let{app:o}=t,{config:n=null}=t,l="";async function p(c,i){let s=1,h=n?.combinedFilePrefix||"",f=n?.combinedFileSuffix||"-combined",E=`${h}${c}${f}.md`;for(;await o.vault.adapter.exists(`${i}/${E}`);)E=`${h}${c}${f}-${s}.md`,s++;return E}function _(){let c=o.workspace.getActiveFile();return!c||c.extension!=="md"||!c.parent?(o.workspace.trigger("notice","Aucun fichier Markdown valide s\xE9lectionn\xE9."),null):c}async function d(c){let i=c.parent?.path||"",s=c.basename,h=await p(s,i),f=`${i}/${h}`;return{originalFile:c,newFileName:h,parentPath:i,fullPath:f}}async function u(c,i){l="Cr\xE9ation du fichier...";try{await o.vault.create(c.fullPath,i),l="Fichier cr\xE9\xE9 avec succ\xE8s";let s=o.vault.getAbstractFileByPath(c.fullPath);if(s&&s instanceof gt.TFile)return s;throw new Error("Impossible de r\xE9cup\xE9rer le fichier cr\xE9\xE9")}catch(s){throw l="Erreur lors de la cr\xE9ation du fichier",s}}async function w(c){if(!(n&&n.openFileAfterCreation===!1))try{await o.workspace.getLeaf("split","vertical").openFile(c),o.workspace.trigger("notice",`Fichier combin\xE9 ouvert : ${c.name}`)}catch(i){o.workspace.trigger("notice",`Erreur lors de l'ouverture du fichier : ${i}`)}}async function g(c){l="Lecture du fichier original...";try{let i=await o.vault.read(c);return l="Fichier lu avec succ\xE8s",i}catch(i){throw l="Erreur lors de la lecture du fichier",i}}async function x(){l="D\xE9but du processus...";let c=_();if(!c)return null;try{let i=await g(c),s=await d(c);return{originalContent:i,fileInfo:s,activeFile:c}}catch(i){let s=i instanceof Error?i.message:String(i);throw o.workspace.trigger("notice",`Erreur : ${s}`),l="Erreur : "+s,i}}async function m(c,i){try{let s=await u(c,i);return await w(s),s}catch(s){let h=s instanceof Error?s.message:String(s);throw o.workspace.trigger("notice",`Erreur lors de la cr\xE9ation du fichier combin\xE9 : ${h}`),s}}function a(){l=""}return e.$$set=c=>{"app"in c&&r(0,o=c.app),"config"in c&&r(1,n=c.config)},[o,n,x,m,a]}var tt=class extends b{constructor(t){super(),S(this,t,Xt,null,C,{app:0,config:1,handleFileCombination:2,finalizeFileCreation:3,resetFileStatus:4})}get handleFileCombination(){return this.$$.ctx[2]}get finalizeFileCreation(){return this.$$.ctx[3]}get resetFileStatus(){return this.$$.ctx[4]}},xt=tt;function $t(e){let t=[];return(e.maxRecursionDepth<1||e.maxRecursionDepth>50)&&t.push("La profondeur de r\xE9cursion doit \xEAtre entre 1 et 50"),e.combinedFileSuffix.length>50&&t.push("Le suffixe du fichier ne peut pas d\xE9passer 50 caract\xE8res"),{isValid:t.length===0,errors:t}}function Kt(e,t,r){let o={processEmbeddedLinks:!0,processInternalLinks:!0,processImages:!0,processExternalLinks:!1,combinedFilePrefix:"",combinedFileSuffix:"-combined",showNotifications:!0,openFileAfterCreation:!0,maxRecursionDepth:10,preserveOriginalLinks:!0},n={...o},l="";async function p(x){l="Chargement de la configuration...";try{let m=await x.loadData();return m?n={...o,...m}:n={...o},l="Configuration charg\xE9e",n}catch(m){return l="Erreur lors du chargement de la configuration",console.error("Erreur de chargement de configuration:",m),o}}async function _(x,m){l="Sauvegarde de la configuration...";try{await x.saveData(m),n={...m},l="Configuration sauvegard\xE9e"}catch(a){throw l="Erreur lors de la sauvegarde de la configuration",console.error("Erreur de sauvegarde de configuration:",a),a}}async function d(x,m){let a={...n,...m};await _(x,a)}async function u(x){await _(x,o)}function w(){return{...n}}function g(){l=""}return[p,_,d,u,w,$t,g]}var et=class extends b{constructor(t){super(),S(this,t,Kt,null,C,{loadConfig:0,saveConfig:1,updateConfig:2,resetConfig:3,getCurrentConfig:4,validateConfig:5,resetConfigStatus:6})}get loadConfig(){return this.$$.ctx[0]}get saveConfig(){return this.$$.ctx[1]}get updateConfig(){return this.$$.ctx[2]}get resetConfig(){return this.$$.ctx[3]}get getCurrentConfig(){return this.$$.ctx[4]}get validateConfig(){return $t}get resetConfigStatus(){return this.$$.ctx[6]}},yt=et;function Yt(e,t,r){let{plugin:o}=t,n,l,p,_=!1,d="Pr\xEAt",u=null;async function w(){p=new yt({target:document.createElement("div"),props:{}}),u=await p.loadConfig(o)}async function g(){if(_)return;let{app:a}=o;_=!0,d="Initialisation...";try{await w(),n=new mt({target:document.createElement("div"),props:{app:a,basePath:"",config:u}}),l=new xt({target:document.createElement("div"),props:{app:a,config:u}});let c=await l.handleFileCombination();if(!c){d="Aucun fichier valide s\xE9lectionn\xE9";return}let{originalContent:i,fileInfo:s,activeFile:h}=c;n.$set({basePath:s.parentPath}),d="Traitement du contenu...";let f=await n.processMarkdown(i);d="Cr\xE9ation du fichier final...",await l.finalizeFileCreation(s,f),d="Termin\xE9 avec succ\xE8s !",u.showNotifications&&a.workspace.trigger("notice",`Fichier combin\xE9 cr\xE9\xE9 : ${s.newFileName}`)}catch(c){let i=c instanceof Error?c.message:String(c);u?.showNotifications&&a.workspace.trigger("notice",`Erreur lors de la combinaison : ${i}`),d="Erreur : "+i}finally{_=!1,n&&n.$destroy(),l&&l.$destroy(),p&&p.$destroy()}}function x(){_=!1,d="Pr\xEAt",n&&n.resetState(),l&&l.resetFileStatus(),p&&p.resetConfigStatus()}function m(){return u}return e.$$set=a=>{"plugin"in a&&r(0,o=a.plugin)},[o,g,x,m]}var nt=class extends b{constructor(t){super(),S(this,t,Yt,null,C,{plugin:0,combineFiles:1,resetState:2,getConfig:3})}get combineFiles(){return this.$$.ctx[1]}get resetState(){return this.$$.ctx[2]}get getConfig(){return this.$$.ctx[3]}},bt=nt;var G=class extends wt.Plugin{appView=null;async onload(){this.addCommand({id:"combine-markdown-files",name:"Combiner les fichiers Markdown avec les embeds",callback:()=>this.combineMarkdownFiles()}),this.addRibbonIcon("link","Combiner les fichiers Markdown",()=>{this.combineMarkdownFiles()}),this.appView=new bt({target:document.createElement("div"),props:{plugin:this}})}async combineMarkdownFiles(){this.appView&&await this.appView.combineFiles()}onunload(){this.appView?.$destroy(),this.appView=null}};

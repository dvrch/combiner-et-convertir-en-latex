/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

"use strict";var X=Object.defineProperty;var Mt=Object.getOwnPropertyDescriptor;var At=Object.getOwnPropertyNames;var Ot=Object.prototype.hasOwnProperty;var Lt=(t,e)=>{for(var r in e)X(t,r,{get:e[r],enumerable:!0})},Pt=(t,e,r,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of At(e))!Ot.call(t,n)&&n!==r&&X(t,n,{get:()=>e[n],enumerable:!(o=Mt(e,n))||o.enumerable});return t};var Dt=t=>Pt(X({},"__esModule",{value:!0}),t);var ie={};Lt(ie,{default:()=>J});module.exports=Dt(ie);var Et=require("obsidian");function T(){}function K(t){return t()}function G(){return Object.create(null)}function S(t){t.forEach(K)}function V(t){return typeof t=="function"}function L(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}function ct(t){return Object.keys(t).length===0}var Y=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;var W=class t{_listeners="WeakMap"in Y?new WeakMap:void 0;_observer=void 0;options;constructor(e){this.options=e}observe(e,r){return this._listeners.set(e,r),this._getObserver().observe(e,this.options),()=>{this._listeners.delete(e),this._observer.unobserve(e)}}_getObserver(){return this._observer??(this._observer=new ResizeObserver(e=>{for(let r of e)t.entries.set(r.target,r),this._listeners.get(r.target)?.(r)}))}};W.entries="WeakMap"in Y?new WeakMap:void 0;var lt=!1;function at(){lt=!0}function ut(){lt=!1}function Q(t,e,r){t.insertBefore(e,r||null)}function q(t){t.parentNode&&t.parentNode.removeChild(t)}function ft(t){return document.createElement(t)}function Z(t,e,r){r==null?t.removeAttribute(e):t.getAttribute(e)!==r&&t.setAttribute(e,r)}function pt(t){return Array.from(t.childNodes)}function dt(t){let e={};return t.childNodes.forEach(r=>{e[r.slot||"default"]=!0}),e}var j;function M(t){j=t}var N=[];var mt=[],R=[],_t=[],zt=Promise.resolve(),et=!1;function gt(){et||(et=!0,zt.then(H))}function z(t){R.push(t)}var tt=new Set,I=0;function H(){if(I!==0)return;let t=j;do{try{for(;I<N.length;){let e=N[I];I++,M(e),Gt(e.$$)}}catch(e){throw N.length=0,I=0,e}for(M(null),N.length=0,I=0;mt.length;)mt.pop()();for(let e=0;e<R.length;e+=1){let r=R[e];tt.has(r)||(tt.add(r),r())}R.length=0}while(N.length);for(;_t.length;)_t.pop()();et=!1,tt.clear(),M(t)}function Gt(t){if(t.fragment!==null){t.update(),S(t.before_update);let e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(z)}}function xt(t){let e=[],r=[];R.forEach(o=>t.indexOf(o)===-1?e.push(o):r.push(o)),r.forEach(o=>o()),R=e}var Vt=new Set;function U(t,e){t&&t.i&&(Vt.delete(t),t.i(e))}var Ht=["allowfullscreen","allowpaymentrequest","async","autofocus","autoplay","checked","controls","default","defer","disabled","formnovalidate","hidden","inert","ismap","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","selected"],Ut=new Set([...Ht]);function Kt(t,e,r){let{fragment:o,after_update:n}=t.$$;o&&o.m(e,r),z(()=>{let s=t.$$.on_mount.map(K).filter(V);t.$$.on_destroy?t.$$.on_destroy.push(...s):S(s),t.$$.on_mount=[]}),n.forEach(z)}function Yt(t,e){let r=t.$$;r.fragment!==null&&(xt(r.after_update),S(r.on_destroy),r.fragment&&r.fragment.d(e),r.on_destroy=r.fragment=null,r.ctx=[])}function Qt(t,e){t.$$.dirty[0]===-1&&(N.push(t),gt(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function P(t,e,r,o,n,s,d=null,_=[-1]){let h=j;M(t);let a=t.$$={fragment:null,ctx:[],props:s,update:T,not_equal:n,bound:G(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(h?h.$$.context:[])),callbacks:G(),dirty:_,skip_bound:!1,root:e.target||h.$$.root};d&&d(a.root);let k=!1;if(a.ctx=r?r(t,e.props||{},(b,y,...x)=>{let g=x.length?x[0]:y;return a.ctx&&n(a.ctx[b],a.ctx[b]=g)&&(!a.skip_bound&&a.bound[b]&&a.bound[b](g),k&&Qt(t,b)),y}):[],a.update(),k=!0,S(a.before_update),a.fragment=o?o(a.ctx):!1,e.target){if(e.hydrate){at();let b=pt(e.target);a.fragment&&a.fragment.l(b),b.forEach(q)}else a.fragment&&a.fragment.c();e.intro&&U(t.$$.fragment),Kt(t,e.target,e.anchor),ut(),H()}M(h)}var Zt;typeof HTMLElement=="function"&&(Zt=class extends HTMLElement{$$ctor;$$s;$$c;$$cn=!1;$$d={};$$r=!1;$$p_d={};$$l={};$$l_u=new Map;constructor(t,e,r){super(),this.$$ctor=t,this.$$s=e,r&&this.attachShadow({mode:"open"})}addEventListener(t,e,r){if(this.$$l[t]=this.$$l[t]||[],this.$$l[t].push(e),this.$$c){let o=this.$$c.$on(t,e);this.$$l_u.set(e,o)}super.addEventListener(t,e,r)}removeEventListener(t,e,r){if(super.removeEventListener(t,e,r),this.$$c){let o=this.$$l_u.get(e);o&&(o(),this.$$l_u.delete(e))}if(this.$$l[t]){let o=this.$$l[t].indexOf(e);o>=0&&this.$$l[t].splice(o,1)}}async connectedCallback(){if(this.$$cn=!0,!this.$$c){let t=function(n){return()=>{let s;return{c:function(){s=ft("slot"),n!=="default"&&Z(s,"name",n)},m:function(h,a){Q(h,s,a)},d:function(h){h&&q(s)}}}};if(await Promise.resolve(),!this.$$cn||this.$$c)return;let e={},r=dt(this);for(let n of this.$$s)n in r&&(e[n]=[t(n)]);for(let n of this.attributes){let s=this.$$g_p(n.name);s in this.$$d||(this.$$d[s]=nt(s,n.value,this.$$p_d,"toProp"))}for(let n in this.$$p_d)!(n in this.$$d)&&this[n]!==void 0&&(this.$$d[n]=this[n],delete this[n]);this.$$c=new this.$$ctor({target:this.shadowRoot||this,props:{...this.$$d,$$slots:e,$$scope:{ctx:[]}}});let o=()=>{this.$$r=!0;for(let n in this.$$p_d)if(this.$$d[n]=this.$$c.$$.ctx[this.$$c.$$.props[n]],this.$$p_d[n].reflect){let s=nt(n,this.$$d[n],this.$$p_d,"toAttribute");s==null?this.removeAttribute(this.$$p_d[n].attribute||n):this.setAttribute(this.$$p_d[n].attribute||n,s)}this.$$r=!1};this.$$c.$$.after_update.push(o),o();for(let n in this.$$l)for(let s of this.$$l[n]){let d=this.$$c.$on(n,s);this.$$l_u.set(s,d)}this.$$l={}}}attributeChangedCallback(t,e,r){this.$$r||(t=this.$$g_p(t),this.$$d[t]=nt(t,r,this.$$p_d,"toProp"),this.$$c?.$set({[t]:this.$$d[t]}))}disconnectedCallback(){this.$$cn=!1,Promise.resolve().then(()=>{!this.$$cn&&this.$$c&&(this.$$c.$destroy(),this.$$c=void 0)})}$$g_p(t){return Object.keys(this.$$p_d).find(e=>this.$$p_d[e].attribute===t||!this.$$p_d[e].attribute&&e.toLowerCase()===t)||t}});function nt(t,e,r,o){let n=r[t]?.type;if(e=n==="Boolean"&&typeof e!="boolean"?e!=null:e,!o||!r[t])return e;if(o==="toAttribute")switch(n){case"Object":case"Array":return e==null?null:JSON.stringify(e);case"Boolean":return e?"":null;case"Number":return e??null;default:return e}else switch(n){case"Object":case"Array":return e&&JSON.parse(e);case"Boolean":return e;case"Number":return e!=null?+e:e;default:return e}}var F=class{$$=void 0;$$set=void 0;$destroy(){Yt(this,1),this.$destroy=T}$on(e,r){if(!V(r))return T;let o=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return o.push(r),()=>{let n=o.indexOf(r);n!==-1&&o.splice(n,1)}}$set(e){this.$$set&&!ct(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}};var $t="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add($t);var ar=require("obsidian");var Yn=require("obsidian");function te(t){return t=t.replace(/^(#+)([^\n]*)/gm,(e,r,o)=>`${r}${o}-comb`),t=t.replace(/\^(\w+)$/gm,(e,r)=>`^${r}-comb`),t}function ee(t,e,r){let{app:o}=e,{basePath:n}=e,{config:s=null}=e,d=new Set,_="",h=new Set,a={};function k(i,m){let c=[],f=[],w=m.split(`
`);for(let p of w){let A=p.match(/^(#+)\s*(.*)$/);if(A){let O=A[2].trim().replace(/\s+/g,"-").toLowerCase()+"-comb";c.push(O)}let E=p.match(/\^(\w+)-comb$/);E&&f.push(E[1]+"-comb")}a[i.toLowerCase()]={file:i,sections:c,blocks:f}}async function b(i){let m=/!\[\[([^\]#|^]+)(?:(#)([^\]|]+))?(?:(\^)([^\]|]+))?(?:\|([^\]]+))?\]\]/g,c=i,f;for(;(f=m.exec(i))!==null;){let w=f[0],p=f[1].trim(),A=f[2],E=f[3],O=f[4],B=f[5];if(/\.(png|jpg|jpeg|gif|svg|bmp|webp)$/i.test(p)){let v=`%% EMBED IMAGE: ${p} %%
`;c=c.replace(w,v+w);continue}if(!d.has(p)){d.add(p),h.add(p.toLowerCase());try{let v=o.metadataCache.getFirstLinkpathDest(p,"");if(v){let C=await o.vault.read(v);(!C||C.trim()==="")&&(C=`<!-- Contenu vide ou non trouv\xE9 pour '${p}' -->`);let $=te(C);k(p,$),$=await g($,v.parent?.path||"");let D=`<a id="${p}-comb"></a>
`,Ct=`%% EMBED START: ${p} %%
`,St=`
%% EMBED END: ${p} %%`;c=c.replace(w,D+Ct+$+St)}else c=c.replace(w,`![[${p}]]`)}catch{c=c.replace(w,`![[${p}]]`)}finally{d.delete(p)}}}return c}async function y(i){let m=/\[\[([^\]#|^]+)(?:(#)([^\]|]+))?(?:(\^)([^\]|]+))?(?:\|([^\]]+))?\]\]/g,c=i,f;for(;(f=m.exec(i))!==null;){let w=f[0],p=f[1].trim(),A=f[2],E=f[3],O=f[4],B=f[5],v=f[6];if(/\.(png|jpg|jpeg|gif|svg|bmp|webp)$/i.test(p))continue;let C=a[p.toLowerCase()];if(C){if(!A&&!O){let $=`${p}-comb`,D=v||p;c=c.replace(w,`[${D}](#${$})`);continue}if(A&&E){let $=E.replace(/\s+/g,"-").toLowerCase()+"-comb";if(C.sections.includes($)){let D=v||E;c=c.replace(w,`[${D}](#${$})`);continue}}if(O&&B){let $=B+"-comb";if(C.blocks.includes($)){let D=v||B;c=c.replace(w,`[${D}](#${$})`);continue}}}}return c}async function x(i){let m=/!\[\[([^\]#|^]+)(?:(#)([^\]|]+))?(?:\|([^\]]+))?\]\]/g,c=i,f;for(;(f=m.exec(i))!==null;){let w=f[0],p=f[1].trim(),A=f[2],E=f[3],O=f[4];/\.(png|jpg|jpeg|gif|svg|bmp|webp)$/i.test(p)&&(p=p.replace(/\.md$/i,""));try{let v=o.metadataCache.getFirstLinkpathDest(p,"");if(v){let $=`![[${v.path.replace(/\\/g,"/")}`;A&&E&&($+=`#${E}`),O&&($+=`|${O}`),$+="]]",c=c.replace(w,$)}else c=c.replace(w,`![[${p}]]`)}catch{c=c.replace(w,`![[${p}]]`)}}return c}async function g(i,m){let c=i;return c=await b(c),c=await y(c),c=await x(c),c=c,c}async function l(i){_="Traitement des liens...",d.clear();try{let m=await g(i,n);return _="Traitement termin\xE9",m}catch(m){throw _="Erreur lors du traitement",m}}function u(){d.clear(),_=""}return t.$$set=i=>{"app"in i&&r(0,o=i.app),"basePath"in i&&r(1,n=i.basePath),"config"in i&&r(2,s=i.config)},[o,n,s,l,u]}var rt=class extends F{constructor(e){super(),P(this,e,ee,null,L,{app:0,basePath:1,config:2,processMarkdown:3,resetState:4})}get processMarkdown(){return this.$$.ctx[3]}get resetState(){return this.$$.ctx[4]}},bt=rt;var yt=require("obsidian");function ne(t,e,r){let{app:o}=e,{config:n=null}=e,s="";async function d(l,u){let i=1,m=n?.combinedFilePrefix||"",c=n?.combinedFileSuffix||"-combined",f=`${m}${l}${c}.md`;for(;await o.vault.adapter.exists(`${u}/${f}`);)f=`${m}${l}${c}-${i}.md`,i++;return f}function _(){let l=o.workspace.getActiveFile();return!l||l.extension!=="md"||!l.parent?(o.workspace.trigger("notice","Aucun fichier Markdown valide s\xE9lectionn\xE9."),null):l}async function h(l){let u=l.parent?.path||"",i=l.basename,m=await d(i,u),c=`${u}/${m}`;return{originalFile:l,newFileName:m,parentPath:u,fullPath:c}}async function a(l,u){s="Cr\xE9ation du fichier...";try{await o.vault.create(l.fullPath,u),s="Fichier cr\xE9\xE9 avec succ\xE8s";let i=o.vault.getAbstractFileByPath(l.fullPath);if(i&&i instanceof yt.TFile)return i;throw new Error("Impossible de r\xE9cup\xE9rer le fichier cr\xE9\xE9")}catch(i){throw s="Erreur lors de la cr\xE9ation du fichier",i}}async function k(l){if(!(n&&n.openFileAfterCreation===!1))try{await o.workspace.getLeaf("split","vertical").openFile(l),o.workspace.trigger("notice",`Fichier combin\xE9 ouvert : ${l.name}`)}catch(u){o.workspace.trigger("notice",`Erreur lors de l'ouverture du fichier : ${u}`)}}async function b(l){s="Lecture du fichier original...";try{let u=await o.vault.read(l);return s="Fichier lu avec succ\xE8s",u}catch(u){throw s="Erreur lors de la lecture du fichier",u}}async function y(){s="D\xE9but du processus...";let l=_();if(!l)return null;try{let u=await b(l),i=await h(l);return{originalContent:u,fileInfo:i,activeFile:l}}catch(u){let i=u instanceof Error?u.message:String(u);throw o.workspace.trigger("notice",`Erreur : ${i}`),s="Erreur : "+i,u}}async function x(l,u){try{let i=await a(l,u);return await k(i),i}catch(i){let m=i instanceof Error?i.message:String(i);throw o.workspace.trigger("notice",`Erreur lors de la cr\xE9ation du fichier combin\xE9 : ${m}`),i}}function g(){s=""}return t.$$set=l=>{"app"in l&&r(0,o=l.app),"config"in l&&r(1,n=l.config)},[o,n,y,x,g]}var ot=class extends F{constructor(e){super(),P(this,e,ne,null,L,{app:0,config:1,handleFileCombination:2,finalizeFileCreation:3,resetFileStatus:4})}get handleFileCombination(){return this.$$.ctx[2]}get finalizeFileCreation(){return this.$$.ctx[3]}get resetFileStatus(){return this.$$.ctx[4]}},wt=ot;function vt(t){let e=[];return(t.maxRecursionDepth<1||t.maxRecursionDepth>50)&&e.push("La profondeur de r\xE9cursion doit \xEAtre entre 1 et 50"),t.combinedFileSuffix.length>50&&e.push("Le suffixe du fichier ne peut pas d\xE9passer 50 caract\xE8res"),{isValid:e.length===0,errors:e}}function re(t,e,r){let o={processEmbeddedLinks:!0,processInternalLinks:!0,processImages:!0,processExternalLinks:!1,combinedFilePrefix:"",combinedFileSuffix:"-combined",showNotifications:!0,openFileAfterCreation:!0,maxRecursionDepth:10,preserveOriginalLinks:!0},n={...o},s="";async function d(y){s="Chargement de la configuration...";try{let x=await y.loadData();return x?n={...o,...x}:n={...o},s="Configuration charg\xE9e",n}catch(x){return s="Erreur lors du chargement de la configuration",console.error("Erreur de chargement de configuration:",x),o}}async function _(y,x){s="Sauvegarde de la configuration...";try{await y.saveData(x),n={...x},s="Configuration sauvegard\xE9e"}catch(g){throw s="Erreur lors de la sauvegarde de la configuration",console.error("Erreur de sauvegarde de configuration:",g),g}}async function h(y,x){let g={...n,...x};await _(y,g)}async function a(y){await _(y,o)}function k(){return{...n}}function b(){s=""}return[d,_,h,a,k,vt,b]}var it=class extends F{constructor(e){super(),P(this,e,re,null,L,{loadConfig:0,saveConfig:1,updateConfig:2,resetConfig:3,getCurrentConfig:4,validateConfig:5,resetConfigStatus:6})}get loadConfig(){return this.$$.ctx[0]}get saveConfig(){return this.$$.ctx[1]}get updateConfig(){return this.$$.ctx[2]}get resetConfig(){return this.$$.ctx[3]}get getCurrentConfig(){return this.$$.ctx[4]}get validateConfig(){return vt}get resetConfigStatus(){return this.$$.ctx[6]}},Ft=it;function oe(t,e,r){let{plugin:o}=e,n,s,d,_=!1,h="Pr\xEAt",a=null;async function k(){d=new Ft({target:document.createElement("div"),props:{}}),a=await d.loadConfig(o)}async function b(){if(_)return;let{app:g}=o;_=!0,h="Initialisation...";try{await k(),n=new bt({target:document.createElement("div"),props:{app:g,basePath:"",config:a}}),s=new wt({target:document.createElement("div"),props:{app:g,config:a}});let l=await s.handleFileCombination();if(!l){h="Aucun fichier valide s\xE9lectionn\xE9";return}let{originalContent:u,fileInfo:i,activeFile:m}=l;n.$set({basePath:i.parentPath}),h="Traitement du contenu...";let c=await n.processMarkdown(u);h="Cr\xE9ation du fichier final...",await s.finalizeFileCreation(i,c),h="Termin\xE9 avec succ\xE8s !",a.showNotifications&&g.workspace.trigger("notice",`Fichier combin\xE9 cr\xE9\xE9 : ${i.newFileName}`)}catch(l){let u=l instanceof Error?l.message:String(l);a?.showNotifications&&g.workspace.trigger("notice",`Erreur lors de la combinaison : ${u}`),h="Erreur : "+u}finally{_=!1,n&&n.$destroy(),s&&s.$destroy(),d&&d.$destroy()}}function y(){_=!1,h="Pr\xEAt",n&&n.resetState(),s&&s.resetFileStatus(),d&&d.resetConfigStatus()}function x(){return a}return t.$$set=g=>{"plugin"in g&&r(0,o=g.plugin)},[o,b,y,x]}var st=class extends F{constructor(e){super(),P(this,e,oe,null,L,{plugin:0,combineFiles:1,resetState:2,getConfig:3})}get combineFiles(){return this.$$.ctx[1]}get resetState(){return this.$$.ctx[2]}get getConfig(){return this.$$.ctx[3]}},kt=st;var J=class extends Et.Plugin{appView=null;async onload(){this.addCommand({id:"combine-markdown-files",name:"Combiner les fichiers Markdown avec les embeds",callback:()=>this.combineMarkdownFiles()}),this.addRibbonIcon("link","Combiner les fichiers Markdown",()=>{this.combineMarkdownFiles()}),this.appView=new kt({target:document.createElement("div"),props:{plugin:this}})}async combineMarkdownFiles(){this.appView&&await this.appView.combineFiles()}onunload(){this.appView?.$destroy(),this.appView=null}};

/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

"use strict";var R=Object.defineProperty;var dt=Object.getOwnPropertyDescriptor;var _t=Object.getOwnPropertyNames;var ht=Object.prototype.hasOwnProperty;var mt=(t,e)=>{for(var n in e)R(t,n,{get:e[n],enumerable:!0})},xt=(t,e,n,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of _t(e))!ht.call(t,r)&&r!==n&&R(t,r,{get:()=>e[r],enumerable:!(o=dt(e,r))||o.enumerable});return t};var $t=t=>xt(R({},"__esModule",{value:!0}),t);var Ht={};mt(Ht,{default:()=>P});module.exports=$t(Ht);var pt=require("obsidian");function _(){}function I(t){return t()}function N(){return Object.create(null)}function x(t){t.forEach(I)}function D(t){return typeof t=="function"}function U(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}function J(t){return Object.keys(t).length===0}var B=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;var T=class t{_listeners="WeakMap"in B?new WeakMap:void 0;_observer=void 0;options;constructor(e){this.options=e}observe(e,n){return this._listeners.set(e,n),this._getObserver().observe(e,this.options),()=>{this._listeners.delete(e),this._observer.unobserve(e)}}_getObserver(){return this._observer??(this._observer=new ResizeObserver(e=>{for(let n of e)t.entries.set(n.target,n),this._listeners.get(n.target)?.(n)}))}};T.entries="WeakMap"in B?new WeakMap:void 0;var X=!1;function K(){X=!0}function Y(){X=!1}function h(t,e){t.appendChild(e)}function Q(t,e,n){let o=Z(t);if(!o.getElementById(e)){let r=g("style");r.id=e,r.textContent=n,yt(o,r)}}function Z(t){if(!t)return document;let e=t.getRootNode?t.getRootNode():t.ownerDocument;return e&&e.host?e:t.ownerDocument}function yt(t,e){return h(t.head||t,e),e.sheet}function O(t,e,n){t.insertBefore(e,n||null)}function w(t){t.parentNode&&t.parentNode.removeChild(t)}function g(t){return document.createElement(t)}function M(t){return document.createTextNode(t)}function tt(){return M(" ")}function q(t,e,n,o){return t.addEventListener(e,n,o),()=>t.removeEventListener(e,n,o)}function y(t,e,n){n==null?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function et(t){return Array.from(t.childNodes)}function z(t,e){e=""+e,t.data!==e&&(t.data=e)}function nt(t){let e={};return t.childNodes.forEach(n=>{e[n.slot||"default"]=!0}),e}var F;function $(t){F=t}var v=[];var ot=[],E=[],it=[],St=Promise.resolve(),V=!1;function st(){V||(V=!0,St.then(j))}function C(t){E.push(t)}var G=new Set,k=0;function j(){if(k!==0)return;let t=F;do{try{for(;k<v.length;){let e=v[k];k++,$(e),Ot(e.$$)}}catch(e){throw v.length=0,k=0,e}for($(null),v.length=0,k=0;ot.length;)ot.pop()();for(let e=0;e<E.length;e+=1){let n=E[e];G.has(n)||(G.add(n),n())}E.length=0}while(v.length);for(;it.length;)it.pop()();V=!1,G.clear(),$(t)}function Ot(t){if(t.fragment!==null){t.update(),x(t.before_update);let e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(C)}}function ct(t){let e=[],n=[];E.forEach(o=>t.indexOf(o)===-1?e.push(o):n.push(o)),n.forEach(o=>o()),E=e}var Mt=new Set;function L(t,e){t&&t.i&&(Mt.delete(t),t.i(e))}var At=["allowfullscreen","allowpaymentrequest","async","autofocus","autoplay","checked","controls","default","defer","disabled","formnovalidate","hidden","inert","ismap","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","selected"],Nt=new Set([...At]);function jt(t,e,n){let{fragment:o,after_update:r}=t.$$;o&&o.m(e,n),C(()=>{let c=t.$$.on_mount.map(I).filter(D);t.$$.on_destroy?t.$$.on_destroy.push(...c):x(c),t.$$.on_mount=[]}),r.forEach(C)}function Lt(t,e){let n=t.$$;n.fragment!==null&&(ct(n.after_update),x(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function Pt(t,e){t.$$.dirty[0]===-1&&(v.push(t),st(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function lt(t,e,n,o,r,c,u=null,l=[-1]){let s=F;$(t);let i=t.$$={fragment:null,ctx:[],props:c,update:_,not_equal:r,bound:N(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(s?s.$$.context:[])),callbacks:N(),dirty:l,skip_bound:!1,root:e.target||s.$$.root};u&&u(i.root);let p=!1;if(i.ctx=n?n(t,e.props||{},(a,f,...d)=>{let b=d.length?d[0]:f;return i.ctx&&r(i.ctx[a],i.ctx[a]=b)&&(!i.skip_bound&&i.bound[a]&&i.bound[a](b),p&&Pt(t,a)),f}):[],i.update(),p=!0,x(i.before_update),i.fragment=o?o(i.ctx):!1,e.target){if(e.hydrate){K();let a=et(e.target);i.fragment&&i.fragment.l(a),a.forEach(w)}else i.fragment&&i.fragment.c();e.intro&&L(t.$$.fragment),jt(t,e.target,e.anchor),Y(),j()}$(s)}var Rt;typeof HTMLElement=="function"&&(Rt=class extends HTMLElement{$$ctor;$$s;$$c;$$cn=!1;$$d={};$$r=!1;$$p_d={};$$l={};$$l_u=new Map;constructor(t,e,n){super(),this.$$ctor=t,this.$$s=e,n&&this.attachShadow({mode:"open"})}addEventListener(t,e,n){if(this.$$l[t]=this.$$l[t]||[],this.$$l[t].push(e),this.$$c){let o=this.$$c.$on(t,e);this.$$l_u.set(e,o)}super.addEventListener(t,e,n)}removeEventListener(t,e,n){if(super.removeEventListener(t,e,n),this.$$c){let o=this.$$l_u.get(e);o&&(o(),this.$$l_u.delete(e))}if(this.$$l[t]){let o=this.$$l[t].indexOf(e);o>=0&&this.$$l[t].splice(o,1)}}async connectedCallback(){if(this.$$cn=!0,!this.$$c){let t=function(r){return()=>{let c;return{c:function(){c=g("slot"),r!=="default"&&y(c,"name",r)},m:function(s,i){O(s,c,i)},d:function(s){s&&w(c)}}}};if(await Promise.resolve(),!this.$$cn||this.$$c)return;let e={},n=nt(this);for(let r of this.$$s)r in n&&(e[r]=[t(r)]);for(let r of this.attributes){let c=this.$$g_p(r.name);c in this.$$d||(this.$$d[c]=W(c,r.value,this.$$p_d,"toProp"))}for(let r in this.$$p_d)!(r in this.$$d)&&this[r]!==void 0&&(this.$$d[r]=this[r],delete this[r]);this.$$c=new this.$$ctor({target:this.shadowRoot||this,props:{...this.$$d,$$slots:e,$$scope:{ctx:[]}}});let o=()=>{this.$$r=!0;for(let r in this.$$p_d)if(this.$$d[r]=this.$$c.$$.ctx[this.$$c.$$.props[r]],this.$$p_d[r].reflect){let c=W(r,this.$$d[r],this.$$p_d,"toAttribute");c==null?this.removeAttribute(this.$$p_d[r].attribute||r):this.setAttribute(this.$$p_d[r].attribute||r,c)}this.$$r=!1};this.$$c.$$.after_update.push(o),o();for(let r in this.$$l)for(let c of this.$$l[r]){let u=this.$$c.$on(r,c);this.$$l_u.set(c,u)}this.$$l={}}}attributeChangedCallback(t,e,n){this.$$r||(t=this.$$g_p(t),this.$$d[t]=W(t,n,this.$$p_d,"toProp"),this.$$c?.$set({[t]:this.$$d[t]}))}disconnectedCallback(){this.$$cn=!1,Promise.resolve().then(()=>{!this.$$cn&&this.$$c&&(this.$$c.$destroy(),this.$$c=void 0)})}$$g_p(t){return Object.keys(this.$$p_d).find(e=>this.$$p_d[e].attribute===t||!this.$$p_d[e].attribute&&e.toLowerCase()===t)||t}});function W(t,e,n,o){let r=n[t]?.type;if(e=r==="Boolean"&&typeof e!="boolean"?e!=null:e,!o||!n[t])return e;if(o==="toAttribute")switch(r){case"Object":case"Array":return e==null?null:JSON.stringify(e);case"Boolean":return e?"":null;case"Number":return e??null;default:return e}else switch(r){case"Object":case"Array":return e&&JSON.parse(e);case"Boolean":return e;case"Number":return e!=null?+e:e;default:return e}}var A=class{$$=void 0;$$set=void 0;$destroy(){Lt(this,1),this.$destroy=_}$on(e,n){if(!D(n))return _;let o=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return o.push(n),()=>{let r=o.indexOf(n);r!==-1&&o.splice(r,1)}}$set(e){this.$$set&&!J(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}};var ut="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(ut);var at=require("obsidian");function It(t){Q(t,"svelte-19x9vft",".combiner-app.svelte-19x9vft{width:100%;padding:10px;background:var(--background-secondary);border-radius:5px;margin:10px 0}.status-bar.svelte-19x9vft{display:flex;justify-content:space-between;align-items:center;gap:10px}.status.svelte-19x9vft{font-size:14px;color:var(--text-muted)}.combine-btn.svelte-19x9vft{background:var(--interactive-accent);color:var(--text-on-accent);border:none;padding:8px 16px;border-radius:4px;cursor:pointer;font-size:14px;transition:background-color 0.2s}.combine-btn.svelte-19x9vft:hover:not(:disabled){background:var(--interactive-accent-hover)}.combine-btn.svelte-19x9vft:disabled{opacity:0.6;cursor:not-allowed}")}function Bt(t){let e,n,o,r,c,u,l,s=t[1]?"Traitement...":"Combiner le fichier actuel",i,p,a;return{c(){e=g("div"),n=g("div"),o=g("span"),r=M("Status: "),c=M(t[0]),u=tt(),l=g("button"),i=M(s),y(o,"class","status svelte-19x9vft"),y(l,"class","combine-btn svelte-19x9vft"),l.disabled=t[1],y(n,"class","status-bar svelte-19x9vft"),y(e,"class","combiner-app svelte-19x9vft")},m(f,d){O(f,e,d),h(e,n),h(n,o),h(o,r),h(o,c),h(n,u),h(n,l),h(l,i),p||(a=q(l,"click",t[2]),p=!0)},p(f,[d]){d&1&&z(c,f[0]),d&2&&s!==(s=f[1]?"Traitement...":"Combiner le fichier actuel")&&z(i,s),d&2&&(l.disabled=f[1])},i:_,o:_,d(f){f&&w(e),p=!1,a()}}}async function qt(t,e){let n=new Set;async function o(r){let c=/!\[\[([^\]#|^]+)(?:(#)([^\]|]+))?(?:(\^)([^\]|]+))?(?:\|([^\]]+))?\]\]/g,u=r,l;for(;(l=c.exec(r))!==null;){let s=l[0],i=l[1].trim(),p=l[2],a=l[3],f=l[4],d=l[5];if(!n.has(i)){n.add(i);try{let b=e.metadataCache.getFirstLinkpathDest(i,"");if(b){let m=await e.vault.read(b);p&&a?m=zt(m,a):f&&d&&(m=Gt(m,d));let S=await o(m);u=u.replace(s,S)}else u=u.replace(s,`<!-- Linked file not found: ${i} -->`)}catch{u=u.replace(s,`<!-- Error: Could not process ${i} -->`)}finally{n.delete(i)}}}return u}return await o(t)}function zt(t,e){let n=t.split(`
`),o=new RegExp(`^#+\\s*${e}$`),r=!1,c=[],u=0;for(let l of n){let s=l.match(/^(#+)\s*(.*)$/);if(s){let i=s[1].length;o.test(l)?(r=!0,u=i,c.push(l)):r&&i<=u&&(r=!1)}r&&c.push(l)}return c.join(`
`)}function Gt(t,e){let n=t.split(`
`),o=new RegExp(`\\s\\^${e}$`);for(let r=0;r<n.length;r++)if(o.test(n[r]))return n[r].replace(o,"").trim();return""}async function Vt(t,e,n){let o=1,r=`${e}-combined.md`;for(;await t.vault.adapter.exists(`${n}/${r}`);)r=`${e}-combined-${o}.md`,o++;return r}function Wt(t,e,n){let{plugin:o}=e,r="Pr\xEAt",c=!1;async function u(){if(c)return;let{app:s}=o,i=s.workspace.getActiveFile();if(!i||i.extension!=="md"||!i.parent){s.workspace.trigger("notice","Aucun fichier Markdown valide s\xE9lectionn\xE9.");return}n(1,c=!0),n(0,r="Traitement en cours...");try{s.workspace.trigger("notice",`Combinaison de ${i.name}...`);let p=await s.vault.read(i),a=await qt(p,s),f=i.parent.path,d=i.basename,b=await Vt(s,d,f),m=`${f}/${b}`;await s.vault.create(m,a),s.workspace.trigger("notice",`Fichier combin\xE9 cr\xE9\xE9 : ${m}`);let S=s.vault.getAbstractFileByPath(m);S&&S instanceof at.TFile&&await s.workspace.getLeaf("split","vertical").openFile(S),n(0,r="Termin\xE9 !")}catch(p){let a=p instanceof Error?p.message:String(p);s.workspace.trigger("notice",`Erreur lors de la cr\xE9ation du fichier combin\xE9 : ${a}`),n(0,r="Erreur : "+a)}finally{n(1,c=!1)}}async function l(){await u()}return t.$$set=s=>{"plugin"in s&&n(3,o=s.plugin)},[r,c,l,o,u]}var H=class extends A{constructor(e){super(),lt(this,e,Wt,Bt,U,{plugin:3,combineFiles:4},It)}get combineFiles(){return this.$$.ctx[4]}},ft=H;var P=class extends pt.Plugin{appView=null;async onload(){this.addCommand({id:"combine-markdown-files",name:"Combiner les fichiers Markdown avec les embeds",callback:()=>this.combineMarkdownFiles()}),this.addRibbonIcon("link","Combiner les fichiers Markdown",()=>{this.combineMarkdownFiles()}),this.appView=new ft({target:document.body,props:{plugin:this}})}async combineMarkdownFiles(){this.appView&&await this.appView.combineFiles()}onunload(){this.appView?.$destroy(),this.appView=null}};

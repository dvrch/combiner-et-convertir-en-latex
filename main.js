/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

"use strict";var pt=Object.defineProperty;var Jt=Object.getOwnPropertyDescriptor;var Xt=Object.getOwnPropertyNames;var Kt=Object.prototype.hasOwnProperty;var Yt=(e,t)=>{for(var r in t)pt(e,r,{get:t[r],enumerable:!0})},Qt=(e,t,r,o)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of Xt(t))!Kt.call(e,n)&&n!==r&&pt(e,n,{get:()=>t[n],enumerable:!(o=Jt(t,n))||o.enumerable});return e};var Zt=e=>Qt(pt({},"__esModule",{value:!0}),e);var Fe={};Yt(Fe,{default:()=>it});module.exports=Zt(Fe);var Ht=require("obsidian");function W(){}function dt(e){return e()}function tt(){return Object.create(null)}function I(e){e.forEach(dt)}function et(e){return typeof e=="function"}function B(e,t){return e!=e?t==t:e!==t||e&&typeof e=="object"||typeof e=="function"}function Ct(e){return Object.keys(e).length===0}var ht=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;var nt=class e{_listeners="WeakMap"in ht?new WeakMap:void 0;_observer=void 0;options;constructor(t){this.options=t}observe(t,r){return this._listeners.set(t,r),this._getObserver().observe(t,this.options),()=>{this._listeners.delete(t),this._observer.unobserve(t)}}_getObserver(){return this._observer??(this._observer=new ResizeObserver(t=>{for(let r of t)e.entries.set(r.target,r),this._listeners.get(r.target)?.(r)}))}};nt.entries="WeakMap"in ht?new WeakMap:void 0;var St=!1;function Mt(){St=!0}function Lt(){St=!1}function mt(e,t,r){e.insertBefore(t,r||null)}function K(e){e.parentNode&&e.parentNode.removeChild(e)}function At(e){return document.createElement(e)}function _t(e,t,r){r==null?e.removeAttribute(t):e.getAttribute(t)!==r&&e.setAttribute(t,r)}function Dt(e){return Array.from(e.childNodes)}function Ot(e){let t={};return e.childNodes.forEach(r=>{t[r.slot||"default"]=!0}),t}var V;function j(e){V=e}var G=[];var Pt=[],U=[],Tt=[],ce=Promise.resolve(),xt=!1;function It(){xt||(xt=!0,ce.then(rt))}function Y(e){U.push(e)}var gt=new Set,H=0;function rt(){if(H!==0)return;let e=V;do{try{for(;H<G.length;){let t=G[H];H++,j(t),le(t.$$)}}catch(t){throw G.length=0,H=0,t}for(j(null),G.length=0,H=0;Pt.length;)Pt.pop()();for(let t=0;t<U.length;t+=1){let r=U[t];gt.has(r)||(gt.add(r),r())}U.length=0}while(G.length);for(;Tt.length;)Tt.pop()();xt=!1,gt.clear(),j(e)}function le(e){if(e.fragment!==null){e.update(),I(e.before_update);let t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(Y)}}function jt(e){let t=[],r=[];U.forEach(o=>e.indexOf(o)===-1?t.push(o):r.push(o)),r.forEach(o=>o()),U=t}var ae=new Set;function ot(e,t){e&&e.i&&(ae.delete(e),e.i(t))}var fe=["allowfullscreen","allowpaymentrequest","async","autofocus","autoplay","checked","controls","default","defer","disabled","formnovalidate","hidden","inert","ismap","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","selected"],pe=new Set([...fe]);function me(e,t,r){let{fragment:o,after_update:n}=e.$$;o&&o.m(t,r),Y(()=>{let i=e.$$.on_mount.map(dt).filter(et);e.$$.on_destroy?e.$$.on_destroy.push(...i):I(i),e.$$.on_mount=[]}),n.forEach(Y)}function _e(e,t){let r=e.$$;r.fragment!==null&&(jt(r.after_update),I(r.on_destroy),r.fragment&&r.fragment.d(t),r.on_destroy=r.fragment=null,r.ctx=[])}function ge(e,t){e.$$.dirty[0]===-1&&(G.push(e),It(),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function q(e,t,r,o,n,i,_=null,m=[-1]){let h=V;j(e);let a=e.$$={fragment:null,ctx:[],props:i,update:W,not_equal:n,bound:tt(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(h?h.$$.context:[])),callbacks:tt(),dirty:m,skip_bound:!1,root:t.target||h.$$.root};_&&_(a.root);let S=!1;if(a.ctx=r?r(e,t.props||{},(x,w,...$)=>{let g=$.length?$[0]:w;return a.ctx&&n(a.ctx[x],a.ctx[x]=g)&&(!a.skip_bound&&a.bound[x]&&a.bound[x](g),S&&ge(e,x)),w}):[],a.update(),S=!0,I(a.before_update),a.fragment=o?o(a.ctx):!1,t.target){if(t.hydrate){Mt();let x=Dt(t.target);a.fragment&&a.fragment.l(x),x.forEach(K)}else a.fragment&&a.fragment.c();t.intro&&ot(e.$$.fragment),me(e,t.target,t.anchor),Lt(),rt()}j(h)}var xe;typeof HTMLElement=="function"&&(xe=class extends HTMLElement{$$ctor;$$s;$$c;$$cn=!1;$$d={};$$r=!1;$$p_d={};$$l={};$$l_u=new Map;constructor(e,t,r){super(),this.$$ctor=e,this.$$s=t,r&&this.attachShadow({mode:"open"})}addEventListener(e,t,r){if(this.$$l[e]=this.$$l[e]||[],this.$$l[e].push(t),this.$$c){let o=this.$$c.$on(e,t);this.$$l_u.set(t,o)}super.addEventListener(e,t,r)}removeEventListener(e,t,r){if(super.removeEventListener(e,t,r),this.$$c){let o=this.$$l_u.get(t);o&&(o(),this.$$l_u.delete(t))}if(this.$$l[e]){let o=this.$$l[e].indexOf(t);o>=0&&this.$$l[e].splice(o,1)}}async connectedCallback(){if(this.$$cn=!0,!this.$$c){let e=function(n){return()=>{let i;return{c:function(){i=At("slot"),n!=="default"&&_t(i,"name",n)},m:function(h,a){mt(h,i,a)},d:function(h){h&&K(i)}}}};if(await Promise.resolve(),!this.$$cn||this.$$c)return;let t={},r=Ot(this);for(let n of this.$$s)n in r&&(t[n]=[e(n)]);for(let n of this.attributes){let i=this.$$g_p(n.name);i in this.$$d||(this.$$d[i]=$t(i,n.value,this.$$p_d,"toProp"))}for(let n in this.$$p_d)!(n in this.$$d)&&this[n]!==void 0&&(this.$$d[n]=this[n],delete this[n]);this.$$c=new this.$$ctor({target:this.shadowRoot||this,props:{...this.$$d,$$slots:t,$$scope:{ctx:[]}}});let o=()=>{this.$$r=!0;for(let n in this.$$p_d)if(this.$$d[n]=this.$$c.$$.ctx[this.$$c.$$.props[n]],this.$$p_d[n].reflect){let i=$t(n,this.$$d[n],this.$$p_d,"toAttribute");i==null?this.removeAttribute(this.$$p_d[n].attribute||n):this.setAttribute(this.$$p_d[n].attribute||n,i)}this.$$r=!1};this.$$c.$$.after_update.push(o),o();for(let n in this.$$l)for(let i of this.$$l[n]){let _=this.$$c.$on(n,i);this.$$l_u.set(i,_)}this.$$l={}}}attributeChangedCallback(e,t,r){this.$$r||(e=this.$$g_p(e),this.$$d[e]=$t(e,r,this.$$p_d,"toProp"),this.$$c?.$set({[e]:this.$$d[e]}))}disconnectedCallback(){this.$$cn=!1,Promise.resolve().then(()=>{!this.$$cn&&this.$$c&&(this.$$c.$destroy(),this.$$c=void 0)})}$$g_p(e){return Object.keys(this.$$p_d).find(t=>this.$$p_d[t].attribute===e||!this.$$p_d[t].attribute&&t.toLowerCase()===e)||e}});function $t(e,t,r,o){let n=r[e]?.type;if(t=n==="Boolean"&&typeof t!="boolean"?t!=null:t,!o||!r[e])return t;if(o==="toAttribute")switch(n){case"Object":case"Array":return t==null?null:JSON.stringify(t);case"Boolean":return t?"":null;case"Number":return t??null;default:return t}else switch(n){case"Object":case"Array":return t&&JSON.parse(t);case"Boolean":return t;case"Number":return t!=null?+t:t;default:return t}}var M=class{$$=void 0;$$set=void 0;$destroy(){_e(this,1),this.$destroy=W}$on(t,r){if(!et(r))return W;let o=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return o.push(r),()=>{let n=o.indexOf(r);n!==-1&&o.splice(n,1)}}$set(t){this.$$set&&!Ct(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}};var Rt="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(Rt);var Cr=require("obsidian");var mr=require("obsidian");function $e(e,t,r){let{app:o}=t,{basePath:n}=t,{config:i=null}=t,{combinedFileName:_=""}=t,m=new Set,h="",a=new Set,S={},x=new Set;function w(p,F){let u=[],b=[],v=F.split(`
`);for(let c of v){let P=c.match(/^(#+)\s*(.*)$/);if(P){let R=P[2].trim().replace(/_/g,"-").replace(/\s+/g,"-").toLowerCase();u.push(R)}let T=c.match(/\^([\w-]+)$/);T&&b.push(T[1])}S[p.toLowerCase()]={file:p,sections:u,blocks:b}}async function $(p){let F=/!\[\[([^\]#|^]+)(?:(#)([^\]|]+))?(?:(\^)([^\]|]+))?(?:\|([^\]]+))?\]\]/g,u=p,b;for(;(b=F.exec(p))!==null;){let v=b[0],c=b[1].trim(),P=b[2],T=b[3],R=b[4],J=b[5];if(/\.(png|jpg|jpeg|gif|svg|bmp|webp)$/i.test(c)){let k=`%% EMBED IMAGE: ${c} %%
`;u=u.replace(v,k+v);continue}if(!m.has(c)){m.add(c),a.add(c.toLowerCase());try{let k=o.metadataCache.getFirstLinkpathDest(c,"");if(k){let A=await o.vault.read(k);(!A||A.trim()==="")&&(A=`<!-- Contenu vide ou non trouv\xE9 pour '${c}' -->`);let s=A;w(c,s),s=await f(s,k.parent?.path||"");let D=`^${c.replace(/_/g,"-")}`,st=`%% EMBED START: [${c}] %% ${D}
`,O=`
%% EMBED END: ${c} %%`;u=u.replace(v,st+s+O)}else u=u.replace(v,`![[${c}]]`)}catch{u=u.replace(v,`![[${c}]]`)}finally{m.delete(c)}}}return u}async function g(p){let F=/\[\[([^\]#|^/]+)(?:(#)([^\]|]+))?(?:(\^)([^\]|]+))?(?:\|([^\]]+))?\]\]/g,u=p,b,v=[],c=u.split(`
`),P=!1,T=-1,R=[],J=!1,k=[];for(let s=0;s<c.length;s++){let D=c[s].trim();/^(```|~~~)/.test(D)&&(P?(P=!1,R.push({start:T,end:s})):(P=!0,T=s)),/^%%/.test(D)&&(J?(J=!1,k[k.length-1].end=s):(J=!0,k.push({start:s,end:-1})))}for(let s=0;s<c.length;s++){let D=!1;for(let C of R)if(s>=C.start&&s<=C.end){D=!0;break}for(let C of k)if(C.end!==-1&&s>=C.start&&s<=C.end){D=!0;break}if(D)continue;let st=c[s],O;for(;(O=F.exec(st))!==null;){let C=O[0],y=O[1].trim(),vt=O[2],ct=O[3],kt=O[4],Q=O[5],X=O[6],lt=S[y.toLowerCase()];if(lt){if(!vt&&!kt){let E=`^${y.replace(/_/g,"-")}`,N=X||y;c[s]=c[s].replace(C,`[[#${E}|${N}]]`);continue}if(vt&&ct){let E=ct.replace(/_/g,"-").replace(/\s+/g,"-").toLowerCase();if(lt.sections.includes(E)){let N=X||ct;c[s]=c[s].replace(C,`[[#${E}|${N}]]`);continue}}if(kt&&Q){let E="^"+Q.replace(/_/g,"-");if(lt.blocks.includes(Q.replace(/_/g,"-"))){let N=X||Q;c[s]=c[s].replace(C,`[[#${E}|${N}]]`);continue}}}if(!a.has(y.toLowerCase())&&!x.has(y.toLowerCase()))try{let E=o.metadataCache.getFirstLinkpathDest(y,"");if(E){if(/\.(png|jpg|jpeg|gif|svg|bmp|webp)$/i.test(y)){let Z=`
%%
%% EMBED HIDDEN: image: ${y} %%
%% (image non ins\xE9r\xE9e, voir le lien ![[${y}]] dans le texte) %%
%%
`,z=0;if(s===0)z=0;else{let Et=0;for(let ft=0;ft<s;ft++)Et+=c[ft].length+1;z=Et}v.push({index:z,content:Z}),x.add(y.toLowerCase());continue}let N=await o.vault.read(E);(!N||N.trim()==="")&&(N=`<!-- Contenu vide ou non trouv\xE9 pour '${y}' -->`);let Ut=`
%%
%% EMBED HIDDEN: ${y} %%
${N}
%% END EMBED HIDDEN %%
%%
`,ut=0;if(s===0)ut=0;else{let Z=0;for(let z=0;z<s;z++)Z+=c[z].length+1;ut=Z}v.push({index:ut,content:Ut}),x.add(y.toLowerCase())}}catch{}let at=o.metadataCache.getFirstLinkpathDest(y,"");if(at&&!at.path.startsWith("http")&&!at.path.startsWith("/")){let E=X||y;c[s]=c[s].replace(C,`[[${y}|${E}]]`)}else{let E=X||y;c[s]=c[s].replace(C,`[[${y}|${E}]]`)}}}v.sort((s,D)=>D.index-s.index);let A=c.join(`
`);for(let s of v)A=A.slice(0,s.index)+s.content+A.slice(s.index);return A}async function l(p){let F=/!\[\[([^\]#|^]+)(?:(#)([^\]|]+))?(?:\|([^\]]+))?\]\]/g,u=p,b;for(;(b=F.exec(p))!==null;){let v=b[0],c=b[1].trim(),P=b[2],T=b[3],R=b[4];/\.(png|jpg|jpeg|gif|svg|bmp|webp)$/i.test(c)&&(c=c.replace(/\.md$/i,""));try{let k=o.metadataCache.getFirstLinkpathDest(c,"");if(k){let s=`![[${k.path.replace(/\\/g,"/")}`;P&&T&&(s+=`#${T}`),R&&(s+=`|${R}`),s+="]]",u=u.replace(v,s)}else u=u.replace(v,`![[${c}]]`)}catch{u=u.replace(v,`![[${c}]]`)}}return u}async function f(p,F){let u=p;return u=await $(u),u=await g(u),u=await l(u),u=u,u}async function d(p){h="Traitement des liens...",m.clear();try{let F=await f(p,n);return h="Traitement termin\xE9",F}catch(F){throw h="Erreur lors du traitement",F}}function L(){m.clear(),h=""}return e.$$set=p=>{"app"in p&&r(0,o=p.app),"basePath"in p&&r(1,n=p.basePath),"config"in p&&r(2,i=p.config),"combinedFileName"in p&&r(3,_=p.combinedFileName)},[o,n,i,_,d,L]}var bt=class extends M{constructor(t){super(),q(this,t,$e,null,B,{app:0,basePath:1,config:2,combinedFileName:3,processMarkdown:4,resetState:5})}get processMarkdown(){return this.$$.ctx[4]}get resetState(){return this.$$.ctx[5]}},Bt=bt;var qt=require("obsidian");function be(e,t,r){let{app:o}=t,{config:n=null}=t,i="";async function _(l,f){let d=1,L=n?.combinedFilePrefix||"",p=n?.combinedFileSuffix||"-combined",F=`${L}${l}${p}.md`;for(;await o.vault.adapter.exists(`${f}/${F}`);)F=`${L}${l}${p}-${d}.md`,d++;return F}function m(){let l=o.workspace.getActiveFile();return!l||l.extension!=="md"||!l.parent?(o.workspace.trigger("notice","Aucun fichier Markdown valide s\xE9lectionn\xE9."),null):l}async function h(l){let f=l.parent?.path||"",d=l.basename,L=await _(d,f),p=`${f}/${L}`;return{originalFile:l,newFileName:L,parentPath:f,fullPath:p}}async function a(l,f){i="Cr\xE9ation du fichier...";try{await o.vault.create(l.fullPath,f),i="Fichier cr\xE9\xE9 avec succ\xE8s";let d=o.vault.getAbstractFileByPath(l.fullPath);if(d&&d instanceof qt.TFile)return d;throw new Error("Impossible de r\xE9cup\xE9rer le fichier cr\xE9\xE9")}catch(d){throw i="Erreur lors de la cr\xE9ation du fichier",d}}async function S(l){if(!(n&&n.openFileAfterCreation===!1))try{await o.workspace.getLeaf("split","vertical").openFile(l),o.workspace.trigger("notice",`Fichier combin\xE9 ouvert : ${l.name}`)}catch(f){o.workspace.trigger("notice",`Erreur lors de l'ouverture du fichier : ${f}`)}}async function x(l){i="Lecture du fichier original...";try{let f=await o.vault.read(l);return i="Fichier lu avec succ\xE8s",f}catch(f){throw i="Erreur lors de la lecture du fichier",f}}async function w(){i="D\xE9but du processus...";let l=m();if(!l)return null;try{let f=await x(l),d=await h(l);return{originalContent:f,fileInfo:d,activeFile:l}}catch(f){let d=f instanceof Error?f.message:String(f);throw o.workspace.trigger("notice",`Erreur : ${d}`),i="Erreur : "+d,f}}async function $(l,f){try{let d=await a(l,f);return await S(d),d}catch(d){let L=d instanceof Error?d.message:String(d);throw o.workspace.trigger("notice",`Erreur lors de la cr\xE9ation du fichier combin\xE9 : ${L}`),d}}function g(){i=""}return e.$$set=l=>{"app"in l&&r(0,o=l.app),"config"in l&&r(1,n=l.config)},[o,n,w,$,g]}var yt=class extends M{constructor(t){super(),q(this,t,be,null,B,{app:0,config:1,handleFileCombination:2,finalizeFileCreation:3,resetFileStatus:4})}get handleFileCombination(){return this.$$.ctx[2]}get finalizeFileCreation(){return this.$$.ctx[3]}get resetFileStatus(){return this.$$.ctx[4]}},zt=yt;function Wt(e){let t=[];return(e.maxRecursionDepth<1||e.maxRecursionDepth>50)&&t.push("La profondeur de r\xE9cursion doit \xEAtre entre 1 et 50"),e.combinedFileSuffix.length>50&&t.push("Le suffixe du fichier ne peut pas d\xE9passer 50 caract\xE8res"),{isValid:t.length===0,errors:t}}function ye(e,t,r){let o={processEmbeddedLinks:!0,processInternalLinks:!0,processImages:!0,processExternalLinks:!1,combinedFilePrefix:"",combinedFileSuffix:"-combined",showNotifications:!0,openFileAfterCreation:!0,maxRecursionDepth:10,preserveOriginalLinks:!0},n={...o},i="";async function _(w){i="Chargement de la configuration...";try{let $=await w.loadData();return $?n={...o,...$}:n={...o},i="Configuration charg\xE9e",n}catch($){return i="Erreur lors du chargement de la configuration",console.error("Erreur de chargement de configuration:",$),o}}async function m(w,$){i="Sauvegarde de la configuration...";try{await w.saveData($),n={...$},i="Configuration sauvegard\xE9e"}catch(g){throw i="Erreur lors de la sauvegarde de la configuration",console.error("Erreur de sauvegarde de configuration:",g),g}}async function h(w,$){let g={...n,...$};await m(w,g)}async function a(w){await m(w,o)}function S(){return{...n}}function x(){i=""}return[_,m,h,a,S,Wt,x]}var wt=class extends M{constructor(t){super(),q(this,t,ye,null,B,{loadConfig:0,saveConfig:1,updateConfig:2,resetConfig:3,getCurrentConfig:4,validateConfig:5,resetConfigStatus:6})}get loadConfig(){return this.$$.ctx[0]}get saveConfig(){return this.$$.ctx[1]}get updateConfig(){return this.$$.ctx[2]}get resetConfig(){return this.$$.ctx[3]}get getCurrentConfig(){return this.$$.ctx[4]}get validateConfig(){return Wt}get resetConfigStatus(){return this.$$.ctx[6]}},Gt=wt;function we(e,t,r){let{plugin:o}=t,n,i,_,m=!1,h="Pr\xEAt",a=null;async function S(){_=new Gt({target:document.createElement("div"),props:{}}),a=await _.loadConfig(o)}async function x(){if(m)return;let{app:g}=o;m=!0,h="Initialisation...";try{await S(),n=new Bt({target:document.createElement("div"),props:{app:g,basePath:"",config:a}}),i=new zt({target:document.createElement("div"),props:{app:g,config:a}});let l=await i.handleFileCombination();if(!l){h="Aucun fichier valide s\xE9lectionn\xE9";return}let{originalContent:f,fileInfo:d,activeFile:L}=l;n.$set({basePath:d.parentPath}),h="Traitement du contenu...";let p=await n.processMarkdown(f);h="Cr\xE9ation du fichier final...",await i.finalizeFileCreation(d,p),h="Termin\xE9 avec succ\xE8s !",a.showNotifications&&g.workspace.trigger("notice",`Fichier combin\xE9 cr\xE9\xE9 : ${d.newFileName}`)}catch(l){let f=l instanceof Error?l.message:String(l);a?.showNotifications&&g.workspace.trigger("notice",`Erreur lors de la combinaison : ${f}`),h="Erreur : "+f}finally{m=!1,n&&n.$destroy(),i&&i.$destroy(),_&&_.$destroy()}}function w(){m=!1,h="Pr\xEAt",n&&n.resetState(),i&&i.resetFileStatus(),_&&_.resetConfigStatus()}function $(){return a}return e.$$set=g=>{"plugin"in g&&r(0,o=g.plugin)},[o,x,w,$]}var Ft=class extends M{constructor(t){super(),q(this,t,we,null,B,{plugin:0,combineFiles:1,resetState:2,getConfig:3})}get combineFiles(){return this.$$.ctx[1]}get resetState(){return this.$$.ctx[2]}get getConfig(){return this.$$.ctx[3]}},Vt=Ft;var it=class extends Ht.Plugin{appView=null;async onload(){this.addCommand({id:"combine-markdown-files",name:"Combiner les fichiers Markdown avec les embeds",callback:()=>this.combineMarkdownFiles()}),this.addRibbonIcon("link","Combiner les fichiers Markdown",()=>{this.combineMarkdownFiles()}),this.appView=new Vt({target:document.createElement("div"),props:{plugin:this}})}async combineMarkdownFiles(){this.appView&&await this.appView.combineFiles()}onunload(){this.appView?.$destroy(),this.appView=null}};
